import{C as e,D as a,E as s,r as t,w as r,F as i,j as o,G as n}from"./vendor-CePkgVYi.js";import{a as l,e as c,g as d,r as m,A as u,s as h,I as p,t as g}from"./index-BFc3BmsD.js";import{am as x,q as w,M as j,r as f,W as v}from"./vendor-icons-D3bVgkGi.js";import{A as b,m as N}from"./vendor-animation-Cs3gejBo.js";import"./vendor-ui-BwPMR9gB.js";import"./vendor-lottie-Cgk9p7OH.js";const S=e=>s().min(6,e("ui.auth.passwordMinLength"));e({oldPassword:s().optional(),password:s().optional(),confirmPassword:s().optional()});const y={hidden:{opacity:0,y:5},visible:{opacity:1,y:0,transition:{duration:.3,ease:"easeOut"}},exit:{opacity:0,y:-5,transition:{duration:.2}}};function k({onSuccess:k,registerIsEnable:P=!0}){const{t:I}=r(),{isLoading:L,login:C,registerUser:T}=function(){const[e,a]=t.useState(!1);return{isLoading:e,login:async e=>{a(!0);try{const a=await fetch(l(c.API_URL+"/api/user/login"),{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json",Domain:window.location.origin,Lang:d()}});if(!a.ok)throw new Error("Network response was not ok");const s=await a.json();return s.code<100&&s.code>0?(localStorage.setItem("token",s.data.token),localStorage.setItem("username",s.data.username),localStorage.setItem("uid",s.data.uid),localStorage.setItem("avatar",s.data.avatar),localStorage.setItem("email",s.data.email),{success:!0,message:s.data.message}):{success:!1,error:s.details?`${s.message}: ${s.details}`:s.message}}catch(s){return{success:!1,error:"接口请求失败,请检查网络状态"}}finally{a(!1)}},registerUser:async e=>{a(!0);try{const a=await fetch(l(c.API_URL+"/api/user/register"),{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json",Domain:window.location.origin,Lang:d()}});if(!a.ok)throw new Error("Network response was not ok");const s=await a.json();return s.code<100&&s.code>0?(localStorage.setItem("token",s.data.token),localStorage.setItem("username",s.data.username),localStorage.setItem("uid",s.data.uid),localStorage.setItem("avatar",s.data.avatar),localStorage.setItem("email",s.data.email),{success:!0}):{success:!1,error:s.details?`${s.message}: ${s.details}`:s.message}}catch(s){return{success:!1,error:"注册失败，请重试"}}finally{a(!1)}}}}(),{theme:z,setTheme:M,resolvedTheme:A}=m(),[O,$]=t.useState("login"),_=(D=I,e({credentials:s().min(1,D("ui.auth.credentialsRequired")),password:S(D),remember:a.boolean().optional().default(!1)}));var D;const E=(a=>e({username:s().min(3,a("ui.auth.usernameMinLength")),email:s().email(a("ui.auth.emailInvalid")),password:S(a),confirmPassword:s().min(6,a("ui.auth.passwordMinLength"))}).refine(e=>e.password===e.confirmPassword,{message:a("ui.auth.passwordMismatch"),path:["confirmPassword"]}))(I),U=i({resolver:n(_)}),R=i({resolver:n(E)}),q=e=>{e!==O&&("register"!==e||P?$(e):g.info(I("ui.auth.registerClosed")))};return o.jsxs("div",{className:`auth-page-container ${A}`,children:[o.jsx("div",{className:"auth-background-layer",children:o.jsx(u,{})}),o.jsxs("div",{className:"auth-floating-actions",children:[o.jsx("button",{onClick:()=>{window.open("https://github.com/haierkeys/fast-note-sync-service","_blank","noopener,noreferrer")},className:"auth-floating-switcher",title:"Source Code",children:o.jsx(x,{size:18})}),o.jsx("button",{onClick:()=>{M("light"===z?"dark":"dark"===z?"auto":"light")},className:"auth-floating-switcher",title:I("auto"===z?"ui.settings.themeAuto":"dark"===A?"ui.settings.themeDark":"ui.settings.themeLight"),children:"auto"===z?o.jsx(w,{size:18}):"dark"===A?o.jsx(j,{size:18}):o.jsx(f,{size:18})}),o.jsx(h,{showText:!1,className:"auth-floating-switcher"})]}),o.jsxs("main",{className:"relative z-50 w-full px-6 py-12 flex flex-col items-center",children:[o.jsxs("div",{className:"auth-logo-wrapper",children:[o.jsx("div",{className:"auth-logo-box",children:o.jsx(v,{size:40,className:"auth-logo-icon"})}),o.jsx("h1",{className:"auth-title",children:"Fast Note Sync"}),o.jsx("p",{className:"auth-subtitle",children:I("ui.common.subtitle")})]}),o.jsxs("div",{className:"auth-card",children:[o.jsx("div",{className:"auth-tabs-container",children:o.jsxs("div",{className:"auth-tabs",children:[o.jsx("button",{onClick:()=>q("login"),className:"auth-tab "+("login"===O?"active":""),children:I("ui.auth.login")}),o.jsx("button",{onClick:()=>q("register"),className:"auth-tab "+("register"===O?"active":""),children:I("ui.auth.registerButton")})]})}),o.jsx(b,{mode:"wait",children:"login"===O?o.jsxs(N.form,{variants:y,initial:"hidden",animate:"visible",exit:"exit",onSubmit:U.handleSubmit(async e=>{const a=await C(e);a.success?k():g.error(a.error)}),children:[o.jsxs("div",{children:[o.jsxs("div",{className:"relative group",children:[o.jsx(p,{placeholder:I("ui.auth.credentialsPlaceholder"),...U.register("credentials"),className:"auth-input"}),U.formState.errors.credentials&&o.jsx("p",{className:"text-[10px] text-destructive/80 font-bold uppercase tracking-wider mt-1 ml-1 mb-2",children:U.formState.errors.credentials.message})]}),o.jsxs("div",{className:"relative group",children:[o.jsx(p,{type:"password",placeholder:I("ui.auth.passwordPlaceholder"),...U.register("password"),className:"auth-input"}),U.formState.errors.password&&o.jsx("p",{className:"text-[10px] text-destructive/80 font-bold uppercase tracking-wider mt-1 ml-1 mb-2",children:U.formState.errors.password.message})]})]}),o.jsx("button",{type:"submit",disabled:L,className:"auth-button-primary",children:L?o.jsx(N.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full"}):I("ui.auth.login")})]},"login"):o.jsxs(N.form,{variants:y,initial:"hidden",animate:"visible",exit:"exit",onSubmit:R.handleSubmit(async e=>{const a=await T(e);a.success?k():g.error(a.error)}),children:[o.jsxs("div",{className:"space-y-0",children:[o.jsxs("div",{className:"relative group",children:[o.jsx(p,{placeholder:I("ui.auth.usernamePlaceholder"),...R.register("username"),className:"auth-input"}),R.formState.errors.username&&o.jsx("p",{className:"text-[10px] text-destructive/80 font-bold uppercase tracking-wider mt-1 ml-1 mb-2",children:R.formState.errors.username.message})]}),o.jsxs("div",{className:"relative group",children:[o.jsx(p,{type:"email",placeholder:I("ui.auth.emailPlaceholder"),...R.register("email"),className:"auth-input"}),R.formState.errors.email&&o.jsx("p",{className:"text-[10px] text-destructive/80 font-bold uppercase tracking-wider mt-1 ml-1 mb-2",children:R.formState.errors.email.message})]}),o.jsxs("div",{className:"relative group",children:[o.jsx(p,{type:"password",placeholder:I("ui.auth.passwordPlaceholder"),...R.register("password"),className:"auth-input"}),R.formState.errors.password&&o.jsx("p",{className:"text-[10px] text-destructive/80 font-bold uppercase tracking-wider mt-1 ml-1 mb-2",children:R.formState.errors.password.message})]}),o.jsxs("div",{className:"relative group",children:[o.jsx(p,{type:"password",placeholder:I("ui.auth.confirmPasswordPlaceholder"),...R.register("confirmPassword"),className:"auth-input"}),R.formState.errors.confirmPassword&&o.jsx("p",{className:"text-[10px] text-destructive/80 font-bold uppercase tracking-wider mt-1 ml-1 mb-2",children:R.formState.errors.confirmPassword.message})]})]}),o.jsx("button",{type:"submit",disabled:L,className:"auth-button-primary",children:L?o.jsx(N.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full"}):I("ui.auth.registerButton")})]},"register")})]}),o.jsx("div",{className:"auth-footer-wrapper",children:o.jsx("footer",{className:"auth-brand-footer",dangerouslySetInnerHTML:{__html:I("ui.common.footerTitle")}})})]})]})}export{k as AuthForm};
