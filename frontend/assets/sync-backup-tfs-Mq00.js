import{w as e,r as s,j as t,C as a,H as r,E as o,I as n,J as i,K as c,F as l,G as d}from"./vendor-CePkgVYi.js";import{T as m,a as u,b as x,c as p,d as h,e as g}from"./table-DDMWTBJ_.js";import{u as b,a as f,e as j,g as y,t as N,D as v,d as k,f as w,h as S,c as C,B as E,L as P,I,o as T}from"./index-Bp05TOe4.js";import{I as D,L as B,E as L,g as U,h as $,_ as z,$ as A,at as F,H as R,au as K,z as _,a4 as O,c as V,ac as q,a as J,a0 as M,e as G,aq as H,ai as W,U as Q,j as X,av as Y}from"./vendor-icons-krzRIBpi.js";import{S as Z,a as ee,b as se,c as te,d as ae}from"./select-DsAv7yql.js";import{C as re}from"./checkbox-Cf75JRRn.js";import"./vendor-ui-BwPMR9gB.js";import"./vendor-lottie-Cgk9p7OH.js";import"./vendor-animation-Cs3gejBo.js";function oe(){const{t:t}=e(),{openConfirmDialog:a}=b(),r=localStorage.getItem("token");return{handleStorageList:s.useCallback(async e=>{try{const s=await fetch(f(j.API_URL+"/api/storage?limit=100"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`,Domain:window.location.origin,Lang:y()}});if(!s.ok)throw new Error("Network response was not ok");const t=await s.json();t.code<100&&t.code>0?e(t.data||[]):a(t.message+": "+t.details,"error")}catch(s){a(t("api.storage.list.error")+": "+s,"error")}},[r,a,t]),handleStorageDelete:async e=>{try{const s=await fetch(f(j.API_URL+"/api/storage"),{method:"DELETE",body:JSON.stringify({id:e}),headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`,Domain:window.location.origin,Lang:y()}});if(!s.ok)throw new Error("Network response was not ok");const o=await s.json();o.code<100&&o.code>0?a(o.message||t("api.storage.delete.success"),"success"):a(o.message+": "+o.details,"error")}catch(s){a(t("api.storage.delete.error")+": "+s,"error")}},handleStorageUpdate:async(e,s)=>{try{const t={...e,isEnabled:e.isEnabled?1:0},o=await fetch(f(j.API_URL+"/api/storage"),{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`,Domain:window.location.origin,Lang:y()}});if(!o.ok)throw new Error("Network response was not ok");const n=await o.json();n.code<100&&n.code>0?(a(n.message,"success"),e.id=n.data,s(e)):a(n.message+": "+n.details,"error")}catch(o){a(t("api.storage.save.error")+": "+o,"error")}},handleStorageTypes:async e=>{try{const s=await fetch(f(j.API_URL+"/api/storage/enabled_types"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`,Domain:window.location.origin,Lang:y()}});if(!s.ok)throw new Error("Network response was not ok");const t=await s.json();t.code<100&&t.code>0?e(t.data||[]):a(t.message+": "+t.details,"error")}catch(s){a(t("api.storage.types.error")+": "+s,"error")}}}}function ne(){const{t:t}=e(),{openConfirmDialog:a}=b(),r=localStorage.getItem("token"),o=s.useCallback(async e=>{try{const s=await fetch(f(j.API_URL+"/api/backup/configs"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`,Domain:window.location.origin,Lang:y()}});if(!s.ok)throw new Error("Network response was not ok");const t=await s.json();t.code<100&&t.code>0?e(t.data||[]):a(t.message+": "+t.details,"error")}catch(s){a(t("api.backup.configList.error")+": "+s,"error")}},[r,a,t]),n=s.useCallback(async e=>{try{const s=await fetch(f(j.API_URL+`/api/backup/config?id=${e}`),{method:"DELETE",headers:{Authorization:`Bearer ${r}`,Domain:window.location.origin,Lang:y()}});if(!s.ok)throw new Error("Network response was not ok");const o=await s.json();o.code<100&&o.code>0?N.success(o.message||t("api.backup.delete.success")):a(o.message+": "+o.details,"error")}catch(s){a(t("api.backup.delete.error")+": "+s,"error")}},[r,a,t]),i=s.useCallback(async(e,s)=>{try{const o=await fetch(f(j.API_URL+"/api/backup/config"),{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`,Domain:window.location.origin,Lang:y()}});if(!o.ok)throw new Error("Network response was not ok");const n=await o.json();n.code<100&&n.code>0?(N.success(n.message||t("api.backup.save.success")),s(n.data)):a(n.message+": "+n.details,"error")}catch(o){a(t("api.backup.save.error")+": "+o,"error")}},[r,a,t]),c=s.useCallback(async e=>{try{const s=await fetch(f(j.API_URL+"/api/backup/execute"),{method:"POST",body:JSON.stringify({id:e}),headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`,Domain:window.location.origin,Lang:y()}});if(!s.ok)throw new Error("Network response was not ok");const o=await s.json();o.code<100&&o.code>0?N.success(o.message||t("api.backup.execute.success")):a(o.message+": "+o.details,"error")}catch(s){a(t("api.backup.execute.error")+": "+s,"error")}},[r,a,t]),l=s.useCallback(async(e,s,o,n)=>{var i;try{const t=j.API_URL+`/api/backup/historys?page=${e}&pageSize=${s}&configId=${o}`,c=await fetch(f(t),{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`,Domain:window.location.origin,Lang:y()}});if(!c.ok)throw new Error("Network response was not ok");const l=await c.json();if(l.code<100&&l.code>0){if(n)if(l.data&&Array.isArray(l.data))n({list:l.data,total:l.total??-1});else if(l.data&&l.data.list){const e=(null==(i=l.data.pager)?void 0:i.totalRows)??l.data.total??0;n({list:l.data.list,total:e})}else n({list:[],total:0})}else a(l.message+": "+l.details,"error")}catch(c){a(t("api.backup.history.error")+": "+c,"error")}},[r,a,t]);return s.useMemo(()=>({handleBackupConfigList:o,handleBackupConfigDelete:n,handleBackupConfigUpdate:i,handleBackupExecute:c,handleBackupHistory:l}),[o,n,i,c,l])}function ie({configId:a,configType:r,open:o,onOpenChange:n}){const{t:i}=e(),{handleBackupHistory:c}=ne(),{handleStorageList:l}=oe(),[d,b]=s.useState([]),[f,j]=s.useState([]),[y,N]=s.useState(0),[P,I]=s.useState(1),[T,z]=s.useState(!1),A=s.useCallback(async e=>{z(!0),await c(e,5,a,e=>{b(e.list),N(e.total)}),z(!1)},[a,c]);s.useEffect(()=>{o&&(l(j),I(1),A(1))},[o,A,l]);const F=e=>{const s=f.find(s=>Number(s.id)===e);return s?s.type:"-"},R=e=>{if(!e)return"0 B";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["B","KB","MB","GB","TB"][s]},K=Math.ceil(y/5);return t.jsx(v,{open:o,onOpenChange:n,children:t.jsxs(k,{className:"max-w-5xl max-h-[85vh] flex flex-col p-6",children:[t.jsx(w,{className:"mb-4",children:t.jsxs(S,{className:"flex items-center gap-2",children:[t.jsx(D,{className:"h-5 w-5 text-primary"}),i("ui.backup.history.title")]})}),t.jsx("div",{className:"flex-1 overflow-auto border rounded-xl bg-card/50",children:t.jsxs(m,{children:[t.jsx(u,{className:"bg-muted/50 sticky top-0 z-10",children:t.jsxs(x,{children:[t.jsx(p,{className:"w-[180px]",children:i("ui.backup.history.startTime")}),t.jsx(p,{children:i("ui.backup.history.storage")}),t.jsx(p,{children:i("ui.backup.history.status")}),t.jsx(p,{children:i("sync"===r?"ui.backup.history.syncStats":"ui.backup.history.backupStats")}),t.jsx(p,{children:i("ui.backup.history.backupFile")}),t.jsx(p,{className:"max-w-[200px]",children:i("ui.backup.history.message")})]})}),t.jsx(h,{children:T?t.jsx(x,{children:t.jsx(g,{colSpan:6,className:"h-48",children:t.jsxs("div",{className:"flex flex-col items-center justify-center text-muted-foreground gap-2",children:[t.jsx(B,{className:"h-8 w-8 animate-spin opacity-50"}),t.jsx("span",{className:"text-xs",children:i("ui.common.loading")})]})})}):d.length>0?d.map(e=>t.jsxs(x,{className:"text-xs hover:bg-muted/30 transition-colors",children:[t.jsx(g,{className:"font-mono text-muted-foreground",children:e.startTime}),t.jsx(g,{children:"-"!==F(e.storageId)?`#${e.storageId} ${i(`ui.storage.storageType.${F(e.storageId)}`)}`:"-"}),t.jsx(g,{children:t.jsx("span",{className:C("px-2 py-0.5 rounded-full font-medium inline-block",2===e.status?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":3===e.status?"bg-destructive/10 text-destructive dark:bg-destructive/20":5===e.status?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400":"bg-muted text-muted-foreground"),children:i(`ui.backup.status.${e.status}`)})}),t.jsx(g,{children:t.jsxs("div",{className:"flex flex-col gap-0.5",children:[t.jsx("span",{children:R(e.fileSize)}),t.jsxs("span",{className:"text-muted-foreground opacity-70 text-[10px]",children:[e.fileCount||0," ",i("ui.backup.fileCountUnit")]})]})}),t.jsx(g,{className:"max-w-[150px] truncate",children:"sync"!==e.type&&e.filePath?(()=>{const s=((e,s)=>{const t=f.find(s=>Number(s.id)===e);if(!t||!t.accessUrlPrefix)return null;let a=t.accessUrlPrefix.endsWith("/")?t.accessUrlPrefix.slice(0,-1):t.accessUrlPrefix;if(t.customPath){let e=t.customPath.startsWith("/")?t.customPath.substring(1):t.customPath;e=e.endsWith("/")?e.slice(0,-1):e,e&&(a+="/"+e)}return a+="/"+(s.startsWith("/")?s.substring(1):s),a})(e.storageId,e.filePath),a=e.filePath.split("/").pop()||e.filePath;return s?t.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-blue-500 hover:underline flex items-center gap-1 transition-colors",title:e.filePath,children:[t.jsx("span",{className:"truncate",children:a}),t.jsx(L,{className:"h-3 w-3 shrink-0 opacity-50"})]}):t.jsx("span",{title:e.filePath,className:"truncate inline-block max-w-full",children:a})})():t.jsx("span",{className:"text-muted-foreground",children:"-"})}),t.jsx(g,{className:"max-w-[200px] truncate opacity-70",title:e.message,children:e.message||"-"})]},e.id)):t.jsx(x,{children:t.jsx(g,{colSpan:6,className:"h-48 text-center text-muted-foreground",children:i("ui.backup.history.noData")})})})]})}),(K>1||-1===y&&(5===d.length||P>1))&&t.jsxs("div",{className:"flex items-center justify-between mt-4 px-1",children:[t.jsx("div",{className:"text-xs text-muted-foreground",children:-1!==y&&`${i("ui.common.total")} ${y} ${i("ui.common.items")}`}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(E,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",onClick:()=>{const e=P-1;I(e),A(e)},disabled:P<=1||T,children:t.jsx(U,{className:"h-4 w-4"})}),t.jsx("span",{className:"text-xs font-medium px-2",children:-1!==y?`${P} / ${K}`:`${i("ui.common.page")} ${P}`}),t.jsx(E,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",onClick:()=>{const e=P+1;I(e),A(e)},disabled:(-1!==y?P>=K:d.length<5)||T,children:t.jsx($,{className:"h-4 w-4"})})]})]})]})})}const ce=["oss","s3","r2","minio","localfs","webdav"];function le({config:m,types:u,onSubmit:x,onCancel:p}){const{t:h}=e(),[g,b]=s.useState(null==m?void 0:m.type),{handleStorageUpdate:f}=oe(),j=s.useMemo(()=>{return a({type:n(ce,{required_error:(e=h)("ui.validation.storage.typeRequired")}),endpoint:o().optional(),region:o().optional(),accountId:o().optional(),bucketName:o().optional(),accessKeyId:o().optional(),accessKeySecret:o().optional(),user:o().optional(),password:o().optional(),customPath:o().optional(),accessUrlPrefix:o().min(1,e("ui.validation.storage.accessUrlPrefixRequired")),isEnabled:r([i(),c()]).transform(e=>Boolean(e)).default(!1).optional()});var e},[h]),{register:y,handleSubmit:N,formState:{errors:v},setValue:k}=l({resolver:d(j),defaultValues:m||{isEnabled:!0}});s.useEffect(()=>{const e=e=>{"Escape"===e.key&&p&&(e.preventDefault(),p())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[p]);return t.jsxs("form",{onSubmit:N(e=>{m&&(e.id=m.id),f(e,()=>{x()})}),className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-3",children:[t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(P,{htmlFor:"type",className:"text-xs font-semibold text-muted-foreground ml-1",children:h("ui.storage.type")}),t.jsxs(Z,{name:"type",onValueChange:e=>{k("type",e),b(e)},defaultValue:null==m?void 0:m.type,children:[t.jsx(ee,{id:"type",className:"bg-background border-input focus:ring-primary/20",children:t.jsx(se,{placeholder:h("ui.storage.selectType")})}),t.jsx(te,{children:u.map((e,s)=>t.jsx(ae,{value:e,children:h(`ui.storage.storageType.${e}`)},s))})]}),v.type&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:v.type.message})]}),"oss"===g&&t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(P,{htmlFor:"endpoint",className:"text-xs font-semibold text-muted-foreground ml-1",children:h("ui.storage.endpoint")}),t.jsx(I,{id:"endpoint",autoComplete:"off",className:"bg-background border-input",...y("endpoint")}),v.endpoint&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:v.endpoint.message})]}),"s3"===g&&t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(P,{htmlFor:"region",className:"text-xs font-semibold text-muted-foreground ml-1",children:h("ui.storage.region")}),t.jsx(I,{id:"region",autoComplete:"off",className:"bg-background border-input",...y("region")}),v.region&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:v.region.message})]}),"r2"===g&&t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(P,{htmlFor:"accountId",className:"text-xs font-semibold text-muted-foreground ml-1",children:h("ui.storage.accountId")}),t.jsx(I,{id:"accountId",autoComplete:"off",className:"bg-background border-input",...y("accountId")}),v.accountId&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:v.accountId.message})]}),"webdav"===g&&t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(P,{htmlFor:"endpoint",className:"text-xs font-semibold text-muted-foreground ml-1",children:h("ui.storage.webdavUrl")}),t.jsx(I,{id:"endpoint",autoComplete:"off",className:"bg-background border-input",...y("endpoint")}),v.endpoint&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:v.endpoint.message})]}),"webdav"===g&&t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(P,{htmlFor:"user",className:"text-xs font-semibold text-muted-foreground ml-1",children:h("ui.storage.webdavUser")}),t.jsx(I,{id:"user",autoComplete:"off",className:"bg-background border-input",...y("user")}),v.user&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:v.user.message})]}),"webdav"===g&&t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(P,{htmlFor:"password",className:"text-xs font-semibold text-muted-foreground ml-1",children:h("ui.storage.webdavPassword")}),t.jsx(I,{id:"password",type:"text",className:"bg-background border-input no-password-prompt",...y("password")}),v.password&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:v.password.message})]}),"minio"===g&&t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(P,{htmlFor:"endpoint",className:"text-xs font-semibold text-muted-foreground ml-1",children:h("ui.storage.endpoint")}),t.jsx(I,{id:"endpoint",autoComplete:"off",className:"bg-background border-input",...y("endpoint")}),v.endpoint&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:v.endpoint.message})]}),"localfs"!==g&&"webdav"!==g&&void 0!==g&&t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(P,{htmlFor:"bucketName",className:"text-xs font-semibold text-muted-foreground ml-1",children:h("ui.storage.bucketName")}),t.jsx(I,{id:"bucketName",autoComplete:"off",className:"bg-background border-input",...y("bucketName")}),v.bucketName&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:v.bucketName.message})]}),"localfs"!==g&&"webdav"!==g&&t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(P,{htmlFor:"accessKeyId",className:"text-xs font-semibold text-muted-foreground ml-1",children:h("ui.storage.accessKeyId")}),t.jsx(I,{id:"accessKeyId",autoComplete:"off",className:"bg-background border-input",...y("accessKeyId")}),v.accessKeyId&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:v.accessKeyId.message})]}),"localfs"!==g&&"webdav"!==g&&t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(P,{htmlFor:"accessKeySecret",className:"text-xs font-semibold text-muted-foreground ml-1",children:h("ui.storage.accessKeySecret")}),t.jsx(I,{id:"accessKeySecret",type:"text",className:"bg-background border-input no-password-prompt",...y("accessKeySecret")}),v.accessKeySecret&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:v.accessKeySecret.message})]}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(P,{htmlFor:"customPath",className:"text-xs font-semibold text-muted-foreground ml-1",children:h("ui.storage.customPath")}),t.jsx(I,{id:"customPath",autoComplete:"off",className:"bg-background border-input",...y("customPath")}),v.customPath&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:v.customPath.message})]}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(P,{htmlFor:"accessUrlPrefix",className:"text-xs font-semibold text-muted-foreground ml-1",children:h("ui.storage.accessUrlPrefix")}),t.jsx(I,{id:"accessUrlPrefix",autoComplete:"off",className:"bg-background border-input",...y("accessUrlPrefix")}),v.accessUrlPrefix&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:v.accessUrlPrefix.message})]})]}),t.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-border",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(re,{id:"isEnabled",name:"isEnabled",defaultChecked:!m||!!m.isEnabled,onCheckedChange:e=>k("isEnabled",Boolean(e)),className:"border-input data-[state=checked]:bg-primary data-[state=checked]:border-primary"}),t.jsx(P,{htmlFor:"isEnabled",className:"text-sm font-medium text-foreground",children:h("ui.common.isEnabled")})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[p&&t.jsx(E,{type:"button",variant:"ghost",onClick:p,children:h("ui.common.cancel")}),t.jsx(E,{type:"submit",size:"sm",className:"px-8 rounded-lg shadow-sm",children:h(m?"ui.common.save":"ui.common.add")})]})]})]})}function de({config:r,storages:m,onSubmit:u,onCancel:x}){const{t:p}=e(),{handleBackupConfigUpdate:h}=ne(),{handleVaultList:g}=T(),[b,f]=s.useState([]),j=m.filter(e=>e.isEnabled),y=(null==r?void 0:r.storageIds)?JSON.parse(r.storageIds).filter(e=>j.some(s=>Number(s.id)===e)):[],[N,v]=s.useState(y);s.useEffect(()=>{g(f)},[g]),s.useEffect(()=>{const e=e=>{"Escape"===e.key&&x&&(e.preventDefault(),x())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[x]);const k=(w=p,a({vault:o().min(1,w("ui.backup.validation.vaultRequired")),type:n(["full","incremental","sync"],{required_error:w("ui.backup.validation.typeRequired")}),cronStrategy:n(["daily","weekly","monthly","custom"],{required_error:w("ui.backup.validation.strategyRequired")}),cronExpression:o().optional(),storageIds:o().refine(e=>{try{const s=JSON.parse(e);return Array.isArray(s)&&s.length>0}catch{return!1}},w("ui.backup.validation.storageRequired")),isEnabled:i().default(!0),retentionDays:c().int().min(-1,w("ui.backup.validation.retentionDaysMin")).optional()}).refine(e=>!("custom"===e.cronStrategy&&!e.cronExpression),{message:w("ui.backup.validation.cronExpressionRequired"),path:["cronExpression"]}));var w;const{register:S,handleSubmit:D,formState:{errors:B},setValue:L,watch:U}=l({resolver:d(k),defaultValues:{vault:(null==r?void 0:r.vault)||"",type:null==r?void 0:r.type,cronStrategy:(null==r?void 0:r.cronStrategy)||"daily",cronExpression:(null==r?void 0:r.cronExpression)||"0 0 * * *",storageIds:JSON.stringify(y),isEnabled:(null==r?void 0:r.isEnabled)??!0,retentionDays:(null==r?void 0:r.retentionDays)??30}}),$=U("cronStrategy");return t.jsxs("form",{onSubmit:D(e=>{h({...e,id:null==r?void 0:r.id},()=>{u()})}),className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-3",children:[t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(P,{className:"text-xs font-semibold text-muted-foreground ml-1",children:p("ui.backup.vault")}),t.jsxs(Z,{onValueChange:e=>L("vault",e),defaultValue:null==r?void 0:r.vault,children:[t.jsx(ee,{className:"bg-background border-input",children:t.jsx(se,{placeholder:p("ui.backup.selectVault")})}),t.jsx(te,{children:b.map(e=>t.jsx(ae,{value:e.vault,children:e.vault},e.id))})]}),B.vault&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:B.vault.message})]}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(P,{className:"text-xs font-semibold text-muted-foreground ml-1",children:p("ui.backup.type")}),t.jsxs(Z,{onValueChange:e=>L("type",e),defaultValue:null==r?void 0:r.type,children:[t.jsx(ee,{className:"bg-background border-input",children:t.jsx(se,{placeholder:p("ui.backup.selectType")})}),t.jsxs(te,{children:[t.jsx(ae,{value:"full",children:p("ui.backup.backupType.full")}),t.jsx(ae,{value:"incremental",children:p("ui.backup.backupType.incremental")}),t.jsx(ae,{value:"sync",children:p("ui.backup.backupType.sync")})]})]}),B.type&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:B.type.message})]}),("full"===U("type")||"incremental"===U("type"))&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(P,{className:"text-xs font-semibold text-muted-foreground ml-1",children:p("ui.backup.cronStrategy")}),t.jsxs(Z,{onValueChange:e=>L("cronStrategy",e),defaultValue:(null==r?void 0:r.cronStrategy)||"daily",children:[t.jsx(ee,{className:"bg-background border-input",children:t.jsx(se,{})}),t.jsxs(te,{children:[t.jsx(ae,{value:"daily",children:p("ui.backup.strategy.daily")}),t.jsx(ae,{value:"weekly",children:p("ui.backup.strategy.weekly")}),t.jsx(ae,{value:"monthly",children:p("ui.backup.strategy.monthly")}),t.jsx(ae,{value:"custom",children:p("ui.backup.strategy.custom")})]})]}),B.cronStrategy&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:B.cronStrategy.message})]}),t.jsxs("div",{className:C("space-y-1.5","custom"!==$&&"opacity-50 pointer-events-none"),children:[t.jsx(P,{className:"text-xs font-semibold text-muted-foreground ml-1",children:p("ui.backup.cronExpression")}),t.jsx(I,{...S("cronExpression"),placeholder:"0 0 * * *",className:"bg-background border-input",disabled:"custom"!==$}),B.cronExpression&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:B.cronExpression.message})]})]}),("full"===U("type")||"incremental"===U("type")||"sync"===U("type"))&&t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(P,{className:"text-xs font-semibold text-muted-foreground ml-1",children:"sync"===U("type")?p("ui.backup.retentionDays.sync"):"full"===U("type")||"incremental"===U("type")?p("ui.backup.retentionDays.backup"):p("ui.backup.retentionDays")}),t.jsx(I,{type:"number",...S("retentionDays",{valueAsNumber:!0}),placeholder:"30",className:"bg-background border-input"}),B.retentionDays&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:B.retentionDays.message})]}),t.jsxs("div",{className:"space-y-1.5 md:col-span-2",children:[t.jsx(P,{className:"text-xs font-semibold text-muted-foreground ml-1",children:p("ui.backup.storages")}),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 border border-input rounded-md p-3 bg-background/50",children:0===j.length?t.jsxs("div",{className:"col-span-full flex flex-col items-center justify-center p-4 text-center text-muted-foreground bg-muted/30 rounded-md border border-dashed",children:[t.jsx("span",{className:"text-sm mb-2",children:p("ui.backup.noAvailableStorage")}),t.jsx("p",{className:"text-xs opacity-70 mb-2",children:p("ui.backup.addStorageTip")})]}):j.map(e=>t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(re,{id:`storage-${e.id}`,checked:N.includes(Number(e.id)),onCheckedChange:()=>(e=>{const s=N.includes(e)?N.filter(s=>s!==e):[...N,e];v(s),L("storageIds",JSON.stringify(s))})(Number(e.id))}),t.jsxs(P,{htmlFor:`storage-${e.id}`,className:"text-sm font-normal cursor-pointer truncate",children:[p(`ui.storage.storageType.${e.type}`)," (",e.id,")"]})]},e.id))}),B.storageIds&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:B.storageIds.message})]})]}),t.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-border",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(re,{id:"isEnabledBackup",checked:U("isEnabled"),onCheckedChange:e=>L("isEnabled",Boolean(e))}),t.jsx(P,{htmlFor:"isEnabledBackup",className:"text-sm font-medium text-foreground",children:p("ui.common.isEnabled")})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[x&&t.jsx(E,{type:"button",variant:"ghost",onClick:x,children:p("ui.common.cancel")}),t.jsx(E,{type:"submit",size:"sm",className:"px-8 rounded-lg shadow-sm",children:p(r?"ui.common.save":"ui.common.add")})]})]})]})}function me(){const{t:a}=e(),{openConfirmDialog:r}=b(),[o,n]=s.useState([]),[i,c]=s.useState(null),[l,d]=s.useState(!1),[m,u]=s.useState(ce),[x,p]=s.useState([]),[h,g]=s.useState(null),[f,j]=s.useState(!1),[y,N]=s.useState(null),[v,k]=s.useState(void 0),[w,S]=s.useState(!1),{handleStorageList:P,handleStorageDelete:I,handleStorageTypes:T}=oe(),{handleBackupConfigList:D,handleBackupConfigDelete:L,handleBackupExecute:U}=ne();s.useEffect(()=>{$()},[]);const $=async()=>{T(u),P(n),D(p)};return t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pb-24 md:pb-4 items-start",children:[t.jsx("div",{className:"rounded-xl border border-border bg-card p-6 custom-shadow",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-2xl font-bold",children:a("ui.backup.management")}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(E,{variant:"ghost",size:"icon",onClick:$,className:"rounded-xl shrink-0 h-10 w-10 text-muted-foreground hover:text-primary",title:a("ui.common.refresh"),children:t.jsx(z,{className:"h-4 w-4"})}),t.jsxs(E,{onClick:()=>j(!0),className:"rounded-xl shrink-0",children:[t.jsx(A,{className:"h-4 w-4 mr-2"}),a("ui.common.add")]})]})]}),f&&t.jsxs("div",{className:"p-4 md:p-5 border border-primary/10 rounded-xl bg-primary/5 custom-shadow-sm mb-4 animate-in fade-in slide-in-from-top-4 duration-300",children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx("div",{className:"h-6 w-1 bg-primary rounded-full mr-3"}),t.jsx("h3",{className:"text-base font-bold text-foreground",children:a("ui.backup.add")})]}),t.jsx(de,{storages:o,onSubmit:async()=>{await $(),j(!1)},onCancel:()=>j(!1)})]}),null!==h&&t.jsxs("div",{className:"p-4 md:p-5 border border-primary/10 rounded-xl bg-primary/5 custom-shadow-sm mb-4 animate-in fade-in slide-in-from-top-4 duration-300",children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx("div",{className:"h-6 w-1 bg-primary rounded-full mr-3"}),t.jsx("h3",{className:"text-base font-bold text-foreground",children:a("ui.backup.edit")})]}),t.jsx(de,{storages:o,config:x.find(e=>e.id===h),onSubmit:async()=>{await $(),g(null)},onCancel:()=>g(null)})]}),t.jsx("div",{className:"flex flex-col gap-2",children:x&&x.length>0?x.map(e=>t.jsxs("div",{className:C("group relative flex flex-col p-3 transition-all duration-200 hover:shadow-sm border rounded-lg bg-background hover:bg-accent/50",e.isEnabled?"border-l-4 border-l-blue-600 dark:border-l-blue-500 shadow-sm":"border-l-4 border-l-muted border-y-border border-r-border"),children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(F,{className:C("h-4 w-4",e.isEnabled?"text-blue-500":"text-muted-foreground")}),t.jsxs("span",{className:"text-sm tabular-nums text-muted-foreground font-mono font-bold",children:["#",e.id]}),t.jsx("span",{className:"font-bold text-sm",children:e.vault}),t.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-accent rounded text-accent-foreground uppercase",children:a(`ui.backup.backupType.${e.type}`)})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(E,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground hover:text-primary rounded-md",onClick:()=>{N(e.id),k(e.type),S(!0)},title:a("ui.backup.history.title"),children:t.jsx(R,{className:"h-3 w-3"})}),t.jsx(E,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground hover:text-blue-600 rounded-md",onClick:()=>(async e=>{await U(e),setTimeout(()=>D(p),1e3)})(e.id),title:a("ui.backup.executeNow"),children:t.jsx(K,{className:"h-3 w-3"})}),t.jsx(E,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground hover:text-primary rounded-md",onClick:()=>{return s=e.id,g(null),void setTimeout(()=>g(s),0);var s},children:t.jsx(_,{className:"h-3 w-3"})}),t.jsx(E,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground hover:text-destructive rounded-md",onClick:()=>(async e=>{r(a("ui.backup.confirmDelete"),"confirm",async()=>{await L(e),await $()})})(e.id),children:t.jsx(O,{className:"h-3 w-3"})})]})]}),t.jsx("div",{className:"flex flex-col gap-y-1 text-[11px] text-muted-foreground",children:t.jsxs("div",{className:"mt-1 pt-1 border-t border-border/50 opacity-70 flex items-center justify-between",children:[t.jsx("div",{className:"flex items-center gap-1.5",children:e.lastRunTime?t.jsxs("span",{children:[a("ui.backup.lastRunTime"),": ",e.lastRunTime]}):t.jsx("span",{children:a("ui.backup.noBackup")})}),t.jsxs("div",{className:"flex items-center gap-1.5 min-w-[3.5rem] justify-end",children:[1===e.lastStatus?t.jsx(B,{className:"h-3 w-3 animate-spin text-blue-500"}):2===e.lastStatus?t.jsx(V,{className:"h-3 w-3 text-green-500"}):3===e.lastStatus?t.jsx(q,{className:"h-3 w-3 text-destructive"}):4===e.lastStatus?t.jsx(J,{className:"h-3 w-3 text-muted-foreground"}):5===e.lastStatus?t.jsx(V,{className:"h-3 w-3 text-blue-400"}):t.jsx(M,{className:"h-3 w-3 opacity-50"}),t.jsx("span",{className:C("font-medium",2===e.lastStatus?"text-green-500":3===e.lastStatus?"text-destructive":5===e.lastStatus?"text-blue-400 dark:text-blue-300":""),children:void 0!==e.lastStatus?a(`ui.backup.status.${e.lastStatus}`):a("ui.common.unknown")})]})]})})]},e.id)):t.jsxs("div",{className:"py-12 flex flex-col items-center justify-center text-muted-foreground border-2 border-dashed border-border/50 rounded-xl bg-muted/20 mt-4",children:[t.jsx(G,{className:"h-12 w-12 mb-3 opacity-20"}),t.jsx("p",{className:"text-sm opacity-70 font-medium",children:a("ui.backup.noBackup")})]})})]})}),t.jsx("div",{className:"rounded-xl border border-border bg-card p-6 custom-shadow",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-2xl font-bold",children:a("ui.storage.management")}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(E,{variant:"ghost",size:"icon",onClick:$,className:"rounded-xl shrink-0 h-10 w-10 text-muted-foreground hover:text-primary",title:a("ui.common.refresh"),children:t.jsx(z,{className:"h-4 w-4"})}),t.jsxs(E,{onClick:()=>d(!0),className:"rounded-xl shrink-0",children:[t.jsx(A,{className:"h-4 w-4 mr-2"}),a("ui.common.add")]})]})]}),l&&t.jsxs("div",{className:"p-4 md:p-5 border border-primary/10 rounded-xl bg-primary/5 custom-shadow-sm mb-4 animate-in fade-in slide-in-from-top-4 duration-300",children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx("div",{className:"h-6 w-1 bg-primary rounded-full mr-3"}),t.jsx("h3",{className:"text-base font-bold text-foreground",children:a("ui.storage.add")})]}),t.jsx(le,{types:m,onSubmit:async()=>{await $(),d(!1)},onCancel:()=>d(!1)})]}),i&&t.jsxs("div",{className:"p-4 md:p-5 border border-primary/10 rounded-xl bg-primary/5 custom-shadow-sm mb-4 animate-in fade-in slide-in-from-top-4 duration-300",children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx("div",{className:"h-6 w-1 bg-primary rounded-full mr-3"}),t.jsx("h3",{className:"text-base font-bold text-foreground",children:a("ui.storage.edit")})]}),t.jsx(le,{types:m,config:o.find(e=>e.id===i),onSubmit:async()=>{await $(),c(null)},onCancel:()=>c(null)})]}),t.jsx("div",{className:"flex flex-col gap-2",children:o&&o.length>0?o.map(e=>{const s="localfs"===e.type?H:"webdav"===e.type?W:Q;return t.jsxs("div",{className:C("group relative flex items-center p-2 px-3 transition-all duration-200 hover:shadow-sm border rounded-lg bg-background hover:bg-accent/50",e.isEnabled?"border-l-4 border-l-green-600 dark:border-l-green-500 shadow-sm":"border-l-4 border-l-muted border-y-border border-r-border"),children:[t.jsx("div",{className:C("flex items-center justify-center w-8 h-8 rounded-md mr-3 shrink-0 transition-colors",e.isEnabled?"bg-green-100 text-green-600 dark:bg-green-500/20 dark:text-green-400":"bg-muted text-muted-foreground"),children:t.jsx(s,{className:"h-4.5 w-4.5"})}),t.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"text-lg tabular-nums text-muted-foreground font-mono font-bold",children:["#",e.id]}),t.jsx("span",{className:"text-sm font-semibold truncate min-w-20 text-foreground",children:a(`ui.storage.storageType.${e.type}`)})]}),t.jsxs("span",{className:C("inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-medium transition-colors",e.isEnabled?"bg-green-100 text-green-700 dark:bg-green-500/20 dark:text-green-400":"bg-muted text-muted-foreground"),children:[e.isEnabled?t.jsx(X,{className:"h-2.5 w-2.5"}):null,e.isEnabled?a("ui.common.isEnabled"):a("ui.common.isDisabled")]})]}),e.accessUrlPrefix&&t.jsxs("div",{className:"hidden lg:flex items-center ml-6 text-xs text-muted-foreground truncate max-w-75 shrink overflow-hidden",children:[t.jsx(Y,{className:"h-3 w-3 mr-1 opacity-50"}),t.jsx("span",{className:"truncate opacity-70 hover:opacity-100 transition-opacity",title:e.accessUrlPrefix,children:e.accessUrlPrefix})]})]}),t.jsxs("div",{className:"flex items-center pl-2 ml-2 border-l border-border space-x-0.5",children:[t.jsx(E,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-primary hover:bg-primary/10 rounded-md transition-all",onClick:()=>{return s=e.id,c(null),void setTimeout(()=>c(s),0);var s},children:t.jsx(_,{className:"h-3.5 w-3.5"})}),t.jsx(E,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive hover:bg-destructive/10 rounded-md transition-all",onClick:()=>(async e=>{r(a("ui.storage.confirmDelete"),"confirm",async()=>{await I(e),await $()})})(e.id),children:t.jsx(O,{className:"h-3.5 w-3.5"})})]})]},e.id)}):t.jsxs("div",{className:"py-12 flex flex-col items-center justify-center text-muted-foreground border-2 border-dashed border-border/50 rounded-xl bg-muted/20 mt-4",children:[t.jsx(G,{className:"h-12 w-12 mb-3 opacity-20"}),t.jsx("p",{className:"text-sm opacity-70 font-medium",children:a("ui.storage.noStorage")})]})})]})}),y&&t.jsx(ie,{configId:y,configType:v,open:w,onOpenChange:S})]})}export{me as SyncBackup};
