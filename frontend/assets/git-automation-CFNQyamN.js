import{w as e,r as s,j as t,C as a,J as r,K as i,E as n,F as l,G as o}from"./vendor-CePkgVYi.js";import{g as d,a as c,e as m,t as x,D as u,d as h,f as g,h as p,c as f,B as j,L as b,I as N,u as v,o as y}from"./index-Bp05TOe4.js";import{T as w,a as k,b as S,c as C,d as E,e as $}from"./table-DDMWTBJ_.js";import{aw as D,L as U,g as T,h as G,a0 as z,c as I,ac as L,ax as P,J as R,at as M,G as A,_ as F,$ as O,au as V,H as _,ay as J,z as H,a4 as q,aa as B}from"./vendor-icons-krzRIBpi.js";import{S as K,a as Q,b as W,c as X,d as Y}from"./select-DsAv7yql.js";import{C as Z}from"./checkbox-Cf75JRRn.js";import"./vendor-ui-BwPMR9gB.js";import"./vendor-lottie-Cgk9p7OH.js";import"./vendor-animation-Cs3gejBo.js";function ee(){const{t:t}=e(),a=localStorage.getItem("token"),r=s.useCallback((e=!0)=>{const s={Authorization:`Bearer ${a}`,Domain:window.location.origin,Lang:d()};return e&&(s["Content-Type"]="application/json"),s},[a]),i=s.useCallback(async e=>{try{const s=await fetch(c(`${m.API_URL}/api/git-sync/configs`),{method:"GET",headers:r()});if(!s.ok)throw new Error(t("api.git.list.error"));const a=await s.json();a.code>0&&a.code<=200?e(a.data||[]):x.error(a.message||t("api.git.list.error"))}catch(s){x.error(s instanceof Error?s.message:t("api.git.list.error"))}},[r,t]),n=s.useCallback(async(e,s)=>{try{const a=await fetch(c(`${m.API_URL}/api/git-sync/config`),{method:"POST",headers:r(),body:JSON.stringify(e)});if(!a.ok)throw new Error(t("api.git.save.error"));const i=await a.json();i.code>0&&i.code<=200?(x.success(i.message||t("api.git.save.success")),s(i.data)):x.error(i.message||t("api.git.save.error"))}catch(a){x.error(a instanceof Error?a.message:t("api.git.save.error"))}},[r,t]),l=s.useCallback(async(e,s)=>{try{const a=await fetch(c(`${m.API_URL}/api/git-sync/config?id=${e}`),{method:"DELETE",headers:r(!1)});if(!a.ok)throw new Error(t("api.git.delete.error"));const i=await a.json();i.code>0&&i.code<=200?(x.success(i.message||t("api.git.delete.success")),s()):x.error(i.message||t("api.git.delete.error"))}catch(a){x.error(a instanceof Error?a.message:t("api.git.delete.error"))}},[r,t]),o=s.useCallback(async(e,s)=>{try{const a=await fetch(c(`${m.API_URL}/api/git-sync/config/execute`),{method:"POST",headers:r(),body:JSON.stringify({id:e})});if(!a.ok)throw new Error(t("api.git.execute.error"));const i=await a.json();i.code>0&&i.code<=200?(x.success(i.message||t("api.git.execute.success")),s()):x.error(i.message||t("api.git.execute.error"))}catch(a){x.error(a instanceof Error?a.message:t("api.git.execute.error"))}},[r,t]),u=s.useCallback(async(e,s)=>{try{const a=await fetch(c(`${m.API_URL}/api/git-sync/config/clean?configId=${e}`),{method:"DELETE",headers:r(!1)});if(!a.ok)throw new Error(t("api.git.clean.error"));const i=await a.json();i.code>0&&i.code<=200?(x.success(i.message||t("api.git.clean.success")),s()):x.error(i.message||t("api.git.clean.error"))}catch(a){x.error(a instanceof Error?a.message:t("api.git.clean.error"))}},[r,t]),h=s.useCallback(async(e,s,a,i)=>{var n,l;try{const o=new URLSearchParams({page:String(e),pageSize:String(s)});void 0!==a&&o.set("configId",String(a));const d=await fetch(c(`${m.API_URL}/api/git-sync/histories?${o.toString()}`),{method:"GET",headers:r(!1)});if(!d.ok)throw new Error(t("api.git.history.error"));const u=await d.json();u.code>0&&u.code<=200?i({list:(null==(n=u.data)?void 0:n.list)||[],total:(null==(l=u.data)?void 0:l.total)??-1}):x.error(u.message||t("api.git.history.error"))}catch(o){x.error(o instanceof Error?o.message:t("api.git.history.error"))}},[r,t]),g=s.useCallback(async(e,s)=>{try{const a=await fetch(c(`${m.API_URL}/api/git-sync/validate`),{method:"POST",headers:r(),body:JSON.stringify(e)});if(!a.ok)throw new Error(t("api.git.validate.error"));const i=await a.json();if(i.code>0&&i.code<=200)x.success(t("api.git.validate.success")),s();else{const e=i.details||i.message||"";x.error(e?`${t("api.git.validate.error")}: ${e}`:t("api.git.validate.error"))}}catch(a){x.error(a instanceof Error?a.message:t("api.git.validate.error"))}},[r,t]);return s.useMemo(()=>({handleGitSyncList:i,handleGitSyncUpdate:n,handleGitSyncDelete:l,handleGitSyncExecute:o,handleGitSyncClean:u,handleGitSyncHistories:h,handleGitSyncValidate:g}),[i,n,l,o,u,h,g])}function se({configId:a,open:r,onOpenChange:i}){const{t:n}=e(),{handleGitSyncHistories:l}=ee(),[o,d]=s.useState([]),[c,m]=s.useState(0),[x,b]=s.useState(1),[N,v]=s.useState(!1),y=s.useCallback(async e=>{v(!0),await l(e,10,a,e=>{d(e.list),m(e.total)}),v(!1)},[a,l]);s.useEffect(()=>{r&&(b(1),y(1))},[r,y]);const P=c>0?Math.ceil(c/10):1,R=(e,s)=>{if(!e||!s)return"-";const t=new Date(s).getTime()-new Date(e).getTime();if(isNaN(t)||t<0)return"-";const a=Math.round(t/1e3);return a<60?`${a}s`:`${Math.floor(a/60)}m ${a%60}s`};return t.jsx(u,{open:r,onOpenChange:i,children:t.jsxs(h,{className:"max-w-3xl max-h-[85vh] flex flex-col p-6",children:[t.jsx(g,{className:"mb-4",children:t.jsxs(p,{className:"flex items-center gap-2",children:[t.jsx(D,{className:"h-5 w-5 text-primary"}),void 0!==a?`${n("ui.git.history.title")} #${a}`:n("ui.git.history.title")]})}),t.jsx("div",{className:"flex-1 overflow-auto border rounded-xl bg-card/50",children:t.jsxs(w,{children:[t.jsx(k,{className:"bg-muted/50 sticky top-0 z-10",children:t.jsxs(S,{children:[t.jsx(C,{className:"w-12",children:"ID"}),void 0===a&&t.jsx(C,{className:"w-16",children:n("ui.git.history.configId")}),t.jsx(C,{className:"w-40",children:n("ui.git.history.startTime")}),t.jsx(C,{className:"w-24",children:n("ui.git.history.duration")}),t.jsx(C,{className:"w-24",children:n("ui.git.history.status")}),t.jsx(C,{children:n("ui.git.history.message")})]})}),t.jsx(E,{children:N?t.jsx(S,{children:t.jsx($,{colSpan:void 0===a?6:5,className:"h-48",children:t.jsxs("div",{className:"flex flex-col items-center justify-center text-muted-foreground gap-2",children:[t.jsx(U,{className:"h-8 w-8 animate-spin opacity-50"}),t.jsx("span",{className:"text-xs",children:n("ui.common.loading")})]})})}):o.length>0?o.map(e=>{return t.jsxs(S,{className:"text-xs hover:bg-muted/30 transition-colors",children:[t.jsx($,{className:"font-mono text-muted-foreground",children:e.id}),void 0===a&&t.jsxs($,{className:"font-mono text-muted-foreground",children:["#",e.configId]}),t.jsx($,{className:"font-mono text-muted-foreground",children:e.startTime||"-"}),t.jsx($,{className:"font-mono text-muted-foreground",children:R(e.startTime,e.endTime)}),t.jsx($,{children:t.jsxs("span",{className:f("inline-flex items-center gap-1 px-2 py-0.5 rounded-full font-medium",2===e.status?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":3===e.status?"bg-destructive/10 text-destructive dark:bg-destructive/20":1===e.status?"bg-orange-100 text-orange-600 dark:bg-orange-900/30 dark:text-orange-400":"bg-muted text-muted-foreground"),children:[(s=e.status,1===s?t.jsx(z,{className:"h-3 w-3 animate-pulse text-orange-500"}):2===s?t.jsx(I,{className:"h-3 w-3 text-green-500"}):3===s?t.jsx(L,{className:"h-3 w-3 text-destructive"}):t.jsx(z,{className:"h-3 w-3 opacity-40"})),n(`ui.git.status.${e.status}`)]})}),t.jsx($,{className:"max-w-65 truncate opacity-80",title:e.message,children:e.message||"-"})]},e.id);var s}):t.jsx(S,{children:t.jsx($,{colSpan:void 0===a?6:5,className:"h-48 text-center text-muted-foreground",children:n("ui.git.history.noData")})})})]})}),(P>1||-1===c&&(10===o.length||x>1))&&t.jsxs("div",{className:"flex items-center justify-between mt-4 px-1",children:[t.jsx("div",{className:"text-xs text-muted-foreground",children:c>0&&`${n("ui.common.total")} ${c} ${n("ui.common.items")}`}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(j,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",onClick:()=>{const e=x-1;b(e),y(e)},disabled:x<=1||N,children:t.jsx(T,{className:"h-4 w-4"})}),t.jsx("span",{className:"text-xs font-medium px-2",children:c>0?`${x} / ${P}`:`${n("ui.common.page")} ${x}`}),t.jsx(j,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",onClick:()=>{const e=x+1;b(e),y(e)},disabled:(c>0?x>=P:o.length<10)||N,children:t.jsx(G,{className:"h-4 w-4"})})]})]})]})})}function te({config:d,vaults:c,onSubmit:m,onCancel:x}){const{t:u}=e(),{handleGitSyncUpdate:h,handleGitSyncValidate:g}=ee(),[p,f]=s.useState(!1),[v,y]=s.useState(!1);s.useEffect(()=>{const e=e=>{"Escape"===e.key&&x&&(e.preventDefault(),x())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[x]);const w=s.useMemo(()=>{return e=u,a({id:i().optional(),vault:n().min(1,e("ui.validation.git.vaultRequired")),repoUrl:n().min(1,e("ui.validation.git.repoUrlRequired")).url(e("ui.validation.git.repoUrlInvalid")),branch:n().min(1,e("ui.validation.git.branchRequired")),username:n().optional(),password:n().optional(),delay:i().min(0,e("ui.validation.git.delayMin")),retentionDays:i().min(-1,e("ui.validation.git.retentionDaysMin")).default(0),isEnabled:r().default(!0)});var e},[u]),{register:k,handleSubmit:S,formState:{errors:C,isSubmitting:E},setValue:$,getValues:D}=l({resolver:o(w),defaultValues:d?{id:d.id,vault:d.vault,repoUrl:d.repoUrl,branch:d.branch,username:d.username,password:d.password,delay:d.delay,retentionDays:d.retentionDays??30,isEnabled:d.isEnabled}:{isEnabled:!0,branch:"main",delay:10,retentionDays:30}});return t.jsxs("form",{onSubmit:S(async e=>{await h(e,()=>{m()})}),className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-3",children:[t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(b,{htmlFor:"vault",className:"text-xs font-semibold text-muted-foreground ml-1",children:u("ui.backup.vault")}),t.jsxs(K,{name:"vault",onValueChange:e=>$("vault",e),defaultValue:null==d?void 0:d.vault,children:[t.jsx(Q,{id:"vault",className:"bg-background border-input focus:ring-primary/20",children:t.jsx(W,{placeholder:u("ui.backup.selectVault")})}),t.jsx(X,{children:c.map(e=>t.jsx(Y,{value:e.vault,children:e.vault},e.id))})]}),C.vault&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:C.vault.message})]}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(b,{htmlFor:"branch",className:"text-xs font-semibold text-muted-foreground ml-1",children:u("ui.git.form.branch")}),t.jsx(N,{id:"branch",autoComplete:"off",className:"bg-background border-input",...k("branch")}),C.branch&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:C.branch.message})]}),t.jsxs("div",{className:"md:col-span-2 space-y-1.5",children:[t.jsx(b,{htmlFor:"repoUrl",className:"text-xs font-semibold text-muted-foreground ml-1",children:u("ui.git.repoUrl")}),t.jsx(N,{id:"repoUrl",placeholder:"https://github.com/user/repo.git",autoComplete:"off",className:"bg-background border-input",...k("repoUrl")}),C.repoUrl&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:C.repoUrl.message})]}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(b,{htmlFor:"username",className:"text-xs font-semibold text-muted-foreground ml-1",children:u("ui.auth.username")}),t.jsx(N,{id:"username",autoComplete:"off",className:"bg-background border-input",...k("username")}),C.username&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:C.username.message})]}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsxs(b,{htmlFor:"password",className:"text-xs font-semibold text-muted-foreground ml-1",children:[u("ui.auth.password")," / Token"]}),t.jsxs("div",{className:"relative",children:[t.jsx(N,{id:"password",type:p?"text":"password",className:"bg-background border-input pr-10",...k("password")}),t.jsx(j,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent text-muted-foreground hover:text-foreground",onClick:()=>f(!p),children:p?t.jsx(P,{className:"h-4 w-4"}):t.jsx(R,{className:"h-4 w-4"})})]}),C.password&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:C.password.message})]}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(b,{htmlFor:"delay",className:"text-xs font-semibold text-muted-foreground ml-1",children:u("ui.git.form.delay")}),t.jsx(N,{id:"delay",type:"number",className:"bg-background border-input",...k("delay",{valueAsNumber:!0})}),C.delay&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:C.delay.message})]}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsx(b,{htmlFor:"retentionDays",className:"text-xs font-semibold text-muted-foreground ml-1",children:u("ui.git.retentionDays")}),t.jsx(N,{id:"retentionDays",type:"number",className:"bg-background border-input",...k("retentionDays",{valueAsNumber:!0})}),t.jsx("p",{className:"text-[10px] text-muted-foreground ml-1",children:u("ui.git.retentionDaysDesc")}),C.retentionDays&&t.jsx("p",{className:"text-[11px] text-destructive mt-1 ml-1",children:C.retentionDays.message})]})]}),t.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-border",children:[t.jsxs("div",{className:"flex items-center space-x-2 whitespace-nowrap shrink-0",children:[t.jsx(Z,{id:"isEnabled",name:"isEnabled",defaultChecked:!d||!!d.isEnabled,onCheckedChange:e=>$("isEnabled",Boolean(e)),className:"border-input data-[state=checked]:bg-primary data-[state=checked]:border-primary"}),t.jsx(b,{htmlFor:"isEnabled",className:"text-sm font-medium text-foreground",children:u("ui.common.isEnabled")})]}),t.jsxs("div",{className:"flex items-center gap-3 flex-wrap justify-end",children:[x&&t.jsx(j,{type:"button",variant:"ghost",onClick:x,disabled:E||v,children:u("ui.common.cancel")}),t.jsxs(j,{type:"button",variant:"outline",size:"sm",className:"px-6 rounded-lg",disabled:E||v,onClick:async()=>{const e=D();e.repoUrl&&(y(!0),await g({repoUrl:e.repoUrl,branch:e.branch,username:e.username,password:e.password},()=>{}),y(!1))},children:[t.jsx(M,{className:"h-4 w-4 mr-1.5"}),u(v?"ui.git.validate.loading":"ui.git.validate.title")]}),t.jsx(j,{type:"submit",size:"sm",className:"px-8 rounded-lg shadow-sm",disabled:E||v,children:u(d?"ui.common.save":"ui.common.add")})]})]})]})}function ae(){const{t:a}=e(),{openConfirmDialog:r}=v(),{handleGitSyncList:i,handleGitSyncDelete:n,handleGitSyncExecute:l,handleGitSyncClean:o,handleGitSyncHistories:d}=ee(),{handleVaultList:c}=y(),[m,x]=s.useState([]),[u,h]=s.useState([]),[g,p]=s.useState(!0),[b,N]=s.useState(!1),[w,k]=s.useState(null),[S,C]=s.useState([]),[E,$]=s.useState(0),[D,P]=s.useState(1),[R,K]=s.useState(!1),[Q,W]=s.useState(void 0),[X,Y]=s.useState(!1),Z=async()=>{p(!0);try{await Promise.all([new Promise(e=>i(s=>{x(s),e()})),new Promise(e=>c(s=>{h(s),e()}))])}finally{p(!1)}},ae=s.useCallback(async e=>{K(!0),await d(e,10,void 0,e=>{C(e.list),$(e.total)}),K(!1)},[d]);s.useEffect(()=>{Z(),ae(1)},[]);const re=E>0?Math.ceil(E/10):1,ie=(e,s)=>{if(!e||!s)return"-";const t=new Date(s).getTime()-new Date(e).getTime();if(isNaN(t)||t<0)return"-";const a=Math.round(t/1e3);return a<60?`${a}s`:`${Math.floor(a/60)}m ${a%60}s`};return t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pb-24 md:pb-4 items-start",children:[t.jsx("div",{className:"flex flex-col gap-4",children:t.jsxs("div",{className:"rounded-xl border border-border bg-card p-6 custom-shadow",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:t.jsx(A,{className:"h-5 w-5 text-primary"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold",children:a("ui.git.config")}),t.jsx("p",{className:"text-xs text-muted-foreground",children:a("ui.git.configDesc")})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(j,{variant:"ghost",size:"icon",onClick:Z,disabled:g,className:"rounded-xl h-10 w-10 text-muted-foreground hover:text-primary",children:t.jsx(F,{className:f("h-4 w-4",g&&"animate-spin")})}),t.jsxs(j,{onClick:()=>N(!0),className:"rounded-xl",children:[t.jsx(O,{className:"h-4 w-4 mr-2"}),a("ui.common.add")]})]})]}),b&&t.jsxs("div",{className:"p-4 border border-primary/20 rounded-xl bg-primary/5 mb-6 animate-in fade-in slide-in-from-top-4 duration-300",children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx("div",{className:"h-6 w-1 bg-primary rounded-full mr-3"}),t.jsx("h3",{className:"text-base font-bold text-foreground",children:a("ui.git.addConfig")})]}),t.jsx(te,{vaults:u,onSubmit:()=>{N(!1),Z()},onCancel:()=>N(!1)})]}),null!==w&&t.jsxs("div",{className:"p-4 border border-primary/20 rounded-xl bg-primary/5 mb-6 animate-in fade-in slide-in-from-top-4 duration-300",children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx("div",{className:"h-6 w-1 bg-primary rounded-full mr-3"}),t.jsx("h3",{className:"text-base font-bold text-foreground",children:a("ui.git.editConfig")})]}),t.jsx(te,{vaults:u,config:m.find(e=>e.id===w),onSubmit:()=>{k(null),Z()},onCancel:()=>k(null)})]}),t.jsx("div",{className:"flex flex-col gap-3",children:g&&0===m.length?t.jsxs("div",{className:"h-[220px] flex flex-col items-center justify-center text-muted-foreground border-2 border-dashed border-border/50 rounded-xl bg-muted/20",children:[t.jsx(U,{className:"h-8 w-8 animate-spin mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:a("ui.git.loading")})]}):m.length>0?m.map(e=>t.jsxs("div",{className:f("group flex flex-col p-4 transition-all duration-200 border rounded-xl bg-background hover:bg-accent/30",e.isEnabled?"border-l-4 border-l-orange-500 shadow-sm":"border-l-4 border-l-muted border-y-border border-r-border"),children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-3",children:[t.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[t.jsx(M,{className:f("h-5 w-5 shrink-0",e.isEnabled?"text-orange-500":"text-muted-foreground")}),t.jsxs("div",{className:"min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t.jsxs("span",{className:"text-[12px] px-1.5 py-0.5 bg-muted rounded font-mono text-muted-foreground",children:["#",e.id]}),t.jsx("span",{className:"font-bold",children:e.vault}),t.jsx("span",{className:"text-[12px] px-1.5 py-0.5 bg-accent rounded font-mono text-muted-foreground",children:e.branch})]}),t.jsx("a",{href:e.repoUrl,target:"_blank",rel:"noopener noreferrer",className:"text-[10px] text-muted-foreground hover:text-primary font-mono truncate max-w-[200px] sm:max-w-[300px] block hover:underline",children:e.repoUrl})]})]}),t.jsxs("div",{className:"flex items-center gap-1 flex-wrap shrink-0",children:[t.jsx(j,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-green-600 rounded-lg",onClick:()=>(async e=>{await l(e,()=>{setTimeout(()=>{Z(),ae(1)},1e3)})})(e.id),title:a("ui.git.execute.title"),children:t.jsx(V,{className:"h-4 w-4"})}),t.jsx(j,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-primary rounded-lg",onClick:()=>{return s=e.id,W(s),void Y(!0);var s},title:a("ui.git.history.title"),children:t.jsx(_,{className:"h-4 w-4"})}),t.jsx(j,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-orange-500 rounded-lg",onClick:()=>{return s=e.id,void r(a("ui.git.clean.confirm"),"confirm",async()=>{await o(s,Z)});var s},title:a("ui.git.clean.title"),children:t.jsx(J,{className:"h-4 w-4"})}),t.jsx(j,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-orange-500 rounded-lg",onClick:()=>k(e.id),children:t.jsx(H,{className:"h-4 w-4"})}),t.jsx(j,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive rounded-lg",onClick:()=>{return s=e.id,void r(a("ui.git.delete.confirm"),"confirm",async()=>{await n(s,Z)});var s},children:t.jsx(q,{className:"h-4 w-4"})})]})]}),t.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border/50 text-[11px]",children:[t.jsxs("div",{className:"flex items-center gap-x-2 gap-y-1 text-muted-foreground flex-wrap",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(z,{className:"h-3 w-3"}),a("ui.git.lastCommit"),": ",e.lastSyncTime||a("ui.git.neverRun")]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(F,{className:"h-3 w-3"}),a("ui.git.checkTime"),": ",e.updatedAt||a("ui.git.neverRun")]})]}),t.jsxs("div",{className:"flex items-center gap-1.5 font-medium whitespace-nowrap shrink-0",children:[1===e.lastStatus?t.jsx(U,{className:"h-3 w-3 animate-spin text-orange-500"}):2===e.lastStatus?t.jsx(I,{className:"h-3 w-3 text-green-500"}):3===e.lastStatus?t.jsx(L,{className:"h-3 w-3 text-destructive"}):t.jsx(z,{className:"h-3 w-3 opacity-30"}),t.jsx("span",{className:f(2===e.lastStatus&&"text-green-600",3===e.lastStatus&&"text-destructive"),children:a(`ui.git.status.${e.lastStatus??0}`)})]})]}),e.lastMessage&&3===e.lastStatus&&t.jsx("p",{className:"mt-2 p-2 bg-destructive/5 text-destructive border border-destructive/10 rounded-md text-[10px] leading-relaxed",children:e.lastMessage})]},e.id)):t.jsxs("div",{className:"h-[220px] flex flex-col items-center justify-center text-muted-foreground border-2 border-dashed border-border/50 rounded-xl bg-muted/20",children:[t.jsx(B,{className:"h-12 w-12 mb-3 opacity-20"}),t.jsx("p",{className:"text-sm opacity-70 font-medium",children:a("ui.git.noConfig")}),t.jsx(j,{variant:"link",size:"sm",onClick:()=>N(!0),className:"mt-2",children:a("ui.git.addFirst")})]})})]})}),t.jsx("div",{className:"flex flex-col gap-4",children:t.jsxs("div",{className:"rounded-xl border border-border bg-card p-6 custom-shadow",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-green-500/10 rounded-lg",children:t.jsx(_,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold",children:a("ui.git.history")}),t.jsx("p",{className:"text-xs text-muted-foreground",children:a("ui.git.historyDesc")})]})]}),t.jsx(j,{variant:"ghost",size:"icon",onClick:()=>{P(1),ae(1)},disabled:R,className:"rounded-xl h-10 w-10 text-muted-foreground hover:text-primary",children:t.jsx(F,{className:f("h-4 w-4",R&&"animate-spin")})})]}),t.jsx("div",{className:"flex flex-col gap-2",children:R&&0===S.length?t.jsxs("div",{className:"h-[220px] flex flex-col items-center justify-center text-muted-foreground border-2 border-dashed border-border/50 rounded-xl bg-muted/20",children:[t.jsx(U,{className:"h-8 w-8 animate-spin mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:a("ui.common.loading")})]}):S.length>0?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"space-y-1.5",children:S.map(e=>{return t.jsxs("div",{className:"flex items-center justify-between px-3 py-2.5 rounded-lg border border-border/60 bg-background hover:bg-accent/30 transition-colors text-sm",children:[t.jsxs("div",{className:"flex items-center gap-2.5 min-w-0",children:[1===e.status?t.jsx(U,{className:"h-4 w-4 animate-spin text-orange-500 shrink-0"}):2===e.status?t.jsx(I,{className:"h-4 w-4 text-green-500 shrink-0"}):3===e.status?t.jsx(L,{className:"h-4 w-4 text-destructive shrink-0"}):t.jsx(z,{className:"h-4 w-4 opacity-30 shrink-0"}),t.jsxs("div",{className:"min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"font-mono text-muted-foreground text-xs",children:["#",e.configId]}),t.jsx("span",{className:"font-medium text-foreground/80",children:(s=e.configId,(null==(r=m.find(e=>e.id===s))?void 0:r.vault)??`#${s}`)}),t.jsx("span",{className:f("font-medium",2===e.status&&"text-green-600 dark:text-green-400",3===e.status&&"text-destructive"),children:a(`ui.git.status.${e.status}`)})]}),e.message&&t.jsx("p",{className:"text-xs text-muted-foreground truncate max-w-65",title:e.message,children:e.message})]})]}),t.jsxs("div",{className:"flex flex-col items-end shrink-0 ml-2 gap-0.5",children:[t.jsx("span",{className:"text-xs text-muted-foreground font-mono",children:e.startTime}),t.jsx("span",{className:"text-xs text-primary/70 font-mono",children:ie(e.startTime,e.endTime)})]})]},e.id);var s,r})}),(re>1||-1===E&&(10===S.length||D>1))&&t.jsxs("div",{className:"flex items-center justify-between mt-2 px-1",children:[t.jsx("span",{className:"text-[10px] text-muted-foreground",children:E>0&&`${a("ui.common.total")} ${E} ${a("ui.common.items")}`}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(j,{variant:"outline",size:"sm",className:"h-6 w-6 p-0",onClick:()=>{const e=D-1;P(e),ae(e)},disabled:D<=1||R,children:t.jsx(T,{className:"h-3 w-3"})}),t.jsx("span",{className:"text-xs font-medium px-1",children:E>0?`${D} / ${re}`:`P${D}`}),t.jsx(j,{variant:"outline",size:"sm",className:"h-6 w-6 p-0",onClick:()=>{const e=D+1;P(e),ae(e)},disabled:(E>0?D>=re:S.length<10)||R,children:t.jsx(G,{className:"h-3 w-3"})})]})]})]}):t.jsxs("div",{className:"h-[220px] flex flex-col items-center justify-center text-muted-foreground border-2 border-dashed border-border/50 rounded-xl bg-muted/20",children:[t.jsx(_,{className:"h-12 w-12 mb-3 opacity-10"}),t.jsx("p",{className:"text-sm font-medium opacity-60",children:a("ui.git.history.noData")})]})})]})}),t.jsx(se,{configId:Q,open:X,onOpenChange:Y})]})}export{ae as GitAutomation};
