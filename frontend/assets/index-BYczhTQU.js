const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-react-DvTO2YHG.js","assets/vendor-common-DuP53R9B.js","assets/vendor-editor-BmvHPu9v.js","assets/vendor-ui-DG083FVs.js","assets/vendor-react-C1o_9YX2.css"])))=>i.map(i=>d[i]);
import{r as e,j as s,S as a,u as t,Q as r,a as n,z as o,M as l,R as i,b as c,L as d,t as m,A as u,F as h,c as g,P as x,T as f,I as p,C as w,d as v,e as N,f as b,g as j,i as y,V as S,k as P,l as k,m as C,n as L,o as R,p as I,q as A,s as z,v as E,w as V,x as D,y as T,B as M,E as O,D as F,G as U,H as _,J as $,O as B,K as H,N as q,U as Z,X as G,W,Y as J,Z as K,_ as Y,$ as Q,a0 as X,a1 as ee,a2 as se,a3 as ae}from"./vendor-react-DvTO2YHG.js";import{ad as te,ae as re,af as ne}from"./vendor-common-DuP53R9B.js";import{i as oe}from"./vendor-i18n-CyLnY-h5.js";import{o as le,s as ie,c as ce}from"./vendor-utils-zod-BAxAHqfV.js";import{f as de}from"./vendor-utils-date-DeoDo8KP.js";import"./vendor-ui-DG083FVs.js";import"./vendor-editor-BmvHPu9v.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)}).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();const me=e.createContext(void 0),ue=({children:a})=>{const[t,r]=e.useState(()=>null!==localStorage.getItem("user"));return s.jsx(me.Provider,{value:{isLoggedIn:t,login:()=>{r(!0),localStorage.setItem("user","true")},logout:()=>{r(!1),localStorage.removeItem("user"),localStorage.removeItem("token"),localStorage.removeItem("username"),localStorage.removeItem("avatar"),localStorage.removeItem("uid")}},children:a})};function he(...e){return te(re(e))}const ge=ne("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),xe=e.forwardRef(({className:e,variant:t,size:r,asChild:n=!1,...o},l)=>{const i=n?a:"button";return s.jsx(i,{className:he(ge({variant:t,size:r,className:e})),ref:l,...o})});xe.displayName="Button";const fe=({isOpen:e,onCancel:a,onConfirm:i,message:c,type:d="error",children:m})=>{const{t:u}=t();let h,g;return"success"==d?h=s.jsxs(r,{className:"text-lg font-semibold flex items-center text-green-500 gap-1",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"size-6 w-6 h-6",children:s.jsx("path",{fillRule:"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z",clipRule:"evenodd"})}),u("success")]}):"error"==d?h=s.jsxs(r,{className:"text-lg font-semibold flex items-center text-red-500 gap-1",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"size-6 w-6 h-6",children:s.jsx("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-1.72 6.97a.75.75 0 1 0-1.06 1.06L10.94 12l-1.72 1.72a.75.75 0 1 0 1.06 1.06L12 13.06l1.72 1.72a.75.75 0 1 0 1.06-1.06L13.06 12l1.72-1.72a.75.75 0 1 0-1.06-1.06L12 10.94l-1.72-1.72Z",clipRule:"evenodd"})}),u("error")]}):"warning"==d?h=s.jsxs(r,{className:"text-lg font-semibold flex items-center text-yellow-500 gap-1",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"size-6 w-6 h-6",children:s.jsx("path",{fillRule:"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z",clipRule:"evenodd"})}),u("warning")]}):"info"==d?h=s.jsxs(r,{className:"text-lg font-semibold flex items-center text-blue-500 gap-1",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"size-6 w-6 h-6",children:s.jsx("path",{fillRule:"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm8.706-1.442c1.146-.573 2.437.463 2.126 1.706l-.709 2.836.042-.02a.75.75 0 0 1 .67 1.34l-.04.022c-1.147.573-2.438-.463-2.127-1.706l.71-2.836-.042.02a.75.75 0 1 1-.671-1.34l.041-.022ZM12 9a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z",clipRule:"evenodd"})}),u("info")]}):"confirm"==d&&(h=s.jsxs(r,{className:"text-lg font-semibold flex items-center text-blue-500 gap-1",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"size-6 w-6 h-6",children:s.jsx("path",{fillRule:"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm11.378-3.917c-.89-.777-2.366-.777-3.255 0a.75.75 0 0 1-.988-1.129c1.454-1.272 3.776-1.272 5.23 0 1.513 1.324 1.513 3.518 0 4.842a3.75 3.75 0 0 1-.837.552c-.676.328-1.028.774-1.028 1.152v.75a.75.75 0 0 1-1.5 0v-.75c0-1.279 1.06-2.107 1.875-2.502.182-.088.351-.199.503-.331.83-.727.83-1.857 0-2.584ZM12 18a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z",clipRule:"evenodd"})}),u("confirm")]})),g="confirm"==d?s.jsxs("div",{className:"mt-4 flex justify-end",children:[s.jsx(xe,{size:"sm",variant:"outline",className:"mr-2",onClick:a,children:u("cancel")}),s.jsx(xe,{size:"sm",onClick:i,children:u("confirm")})]}):s.jsx("div",{className:"mt-4 flex justify-end",children:s.jsx(xe,{size:"sm",onClick:a,children:u("close")})}),s.jsx(n,{open:e,onClose:a,children:s.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:s.jsxs(o,{className:"w-1/3 bg-white rounded-lg shadow-lg p-6",children:[h,s.jsx(l,{className:"mt-2 text-sm text-muted-foreground",children:c}),m," ",g]})})})},pe=e.createContext(void 0),we=({children:a})=>{const[t,r]=e.useState(!1),[n,o]=e.useState(""),[l,i]=e.useState("error"),[c,d]=e.useState(),[m,u]=e.useState(),h=()=>{r(!1),o(""),i("error"),d(void 0),u(void 0)};return s.jsxs(pe.Provider,{value:{isDialogOpen:t,message:n,type:l,openConfirmDialog:(e,s,a,t)=>{o(e),i(s||"error"),d(()=>a),u(t),r(!0)},closeDialog:h},children:[a,s.jsx(fe,{isOpen:t,onCancel:h,onConfirm:()=>{c&&c(),h()},message:n,type:l,children:m})]})},ve=()=>{const s=e.useContext(pe);if(!s)throw new Error("useConfirmDialog must be used within a ConfirmDialogProvider");return s};function Ne(e){const s=e.includes("?")?"&":"?";return`${e}${s}_=${Date.now()}_${Math.random().toString(36).substring(2,15)}`}const be=ne("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),je=e.forwardRef(({className:e,...a},t)=>s.jsx(i,{ref:t,className:he(be(),e),...a}));je.displayName=i.displayName;const ye=e.forwardRef(({className:e,type:a,...t},r)=>s.jsx("input",{type:a,className:he("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:r,...t}));ye.displayName="Input";let Se=localStorage.getItem("API_URL");const Pe={API_URL:Se||window.location.origin,debug:!0};function ke({close:a}){const{t:r}=t(),{openConfirmDialog:n}=ve(),[o,l]=e.useState(""),[i,c]=e.useState(""),[d,m]=e.useState(""),[u,h]=e.useState(!1);return s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),i===d){h(!0);try{const e=localStorage.getItem("token"),s=new FormData;s.append("oldPassword",o),s.append("password",i),s.append("confirmPassword",d);const t=await fetch(Ne(Pe.API_URL+"/api/user/change_password"),{method:"POST",headers:{token:e||""},body:s}),l=await t.json();!0===l.status?(n(l.message||r("passwordChangedSuccess"),"success"),a()):n(l.details||l.message||r("passwordChangeFailed"),"error")}catch(s){n(r("passwordChangeFailed"),"error")}finally{h(!1)}}else n(r("passwordMismatch"),"error")},className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(je,{htmlFor:"oldPassword",children:r("currentPassword")}),s.jsx(ye,{id:"oldPassword",type:"password",value:o,onChange:e=>l(e.target.value),required:!0})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(je,{htmlFor:"newPassword",children:r("newPassword")}),s.jsx(ye,{id:"newPassword",type:"password",value:i,onChange:e=>c(e.target.value),required:!0})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(je,{htmlFor:"confirmPassword",children:r("confirmNewPassword")}),s.jsx(ye,{id:"confirmPassword",type:"password",value:d,onChange:e=>m(e.target.value),required:!0})]}),s.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[s.jsx(xe,{type:"button",variant:"outline",onClick:a,children:r("cancel")}),s.jsx(xe,{type:"submit",disabled:u,children:r(u?"submitting":"changePassword")})]})]})}const Ce=e=>{localStorage.setItem("lang",e),oe.changeLanguage(e)};function Le(){let e;return e=localStorage.getItem("lang")?localStorage.getItem("lang"):navigator.language.toLowerCase(),e.startsWith("zh")?"zh":"en"}function Re(){const[s,a]=e.useState(!1);return{isLoading:s,login:async e=>{a(!0);try{const s=await fetch(Ne(Pe.API_URL+"/api/user/login"),{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json",Domain:window.location.origin,Lang:Le()}});if(!s.ok)throw new Error("Network response was not ok");const a=await s.json();return a.code<100&&a.code>0?(localStorage.setItem("token",a.data.token),localStorage.setItem("username",a.data.username),localStorage.setItem("uid",a.data.uid),localStorage.setItem("avatar",a.data.avatar),localStorage.setItem("email",a.data.email),{success:!0,message:a.data.message}):{success:!1,error:a.message+": "+a.details}}catch(s){return{success:!1,error:"接口请求失败,请检查网络状态"}}finally{a(!1)}},registerUser:async e=>{a(!0);try{const s=await fetch(Ne(Pe.API_URL+"/api/user/register"),{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json",Domain:window.location.origin,Lang:Le()}});if(!s.ok)throw new Error("Network response was not ok");const a=await s.json();return a.code<100&&a.code>0?(localStorage.setItem("token",a.data.token),localStorage.setItem("username",a.data.username),localStorage.setItem("uid",a.data.uid),localStorage.setItem("avatar",a.data.avatar),localStorage.setItem("email",a.data.email),{success:!0}):{success:!1,error:a.message+": "+a.details}}catch(s){return{success:!1,error:"注册失败，请重试"}}finally{a(!1)}}}}const Ie=e=>ie().min(6,e("passwordMinLength"));function Ae({onSuccess:e,onBackToLogin:a}){const{t:r,i18n:n}=t(),{isLoading:o,registerUser:l}=Re(),{openConfirmDialog:i}=ve(),u=(h=r,le({username:ie().min(3,h("usernameMinLength")),email:ie().email(h("emailInvalid")),password:Ie(h),confirmPassword:ie().min(6,h("passwordMinLength"))}).refine(e=>e.password===e.confirmPassword,{message:h("passwordMismatch"),path:["confirmPassword"]}));var h;const{handleSubmit:g,register:x,formState:{errors:f}}=c({resolver:m(u)});return s.jsxs("div",{className:"w-full max-w-4xl mx-auto p-5 space-y-4 relative",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h1",{className:"text-3xl font-bold",children:r("registerTitle")}),s.jsxs(xe,{variant:"outline",onClick:()=>Ce("en"===n.language?"zh":"en"),className:"text-sm font-medium hover:bg-slate-100 transition-colors",children:[s.jsx(d,{className:"mr-2 h-4 w-4"}),"en"===n.language?"中文":"English"]})]}),s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-gray-500",children:r("registerSubtitle")})}),s.jsxs("form",{onSubmit:g(async s=>{const a=await l(s);a.success?e():i(a.error)}),className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(je,{htmlFor:"credentials",children:r("username")}),s.jsx(ye,{id:"username",placeholder:r("usernamePlaceholder"),...x("username")}),f.username&&s.jsx("p",{className:"text-sm text-red-500",children:f.username.message})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(je,{htmlFor:"email",children:r("email")}),s.jsx(ye,{id:"email",type:"email",placeholder:r("emailPlaceholder"),...x("email")}),f.email&&s.jsx("p",{className:"text-sm text-red-500",children:f.email.message})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(je,{htmlFor:"password",children:r("password")}),s.jsx(ye,{id:"password",type:"password",placeholder:r("passwordPlaceholder"),...x("password")}),f.password&&s.jsx("p",{className:"text-sm text-red-500",children:f.password.message})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(je,{htmlFor:"confirmPassword",children:r("confirmPassword")}),s.jsx(ye,{id:"confirmPassword",type:"password",placeholder:r("confirmPasswordPlaceholder"),...x("confirmPassword")}),f.confirmPassword&&s.jsx("p",{className:"text-sm text-red-500",children:f.confirmPassword.message})]}),s.jsx(xe,{type:"submit",className:"w-full",disabled:o,children:r(o?"registering":"registerButton")}),s.jsx("div",{className:"text-center mt-4",children:s.jsxs(xe,{variant:"link",onClick:a,type:"button",children:[r("alreadyHaveAccount")," ",r("backToLogin")]})})]})]})}le({oldPassword:ie().optional(),password:ie().optional(),confirmPassword:ie().optional()});const ze=e.forwardRef(({className:e,...a},t)=>s.jsx("div",{ref:t,className:he("rounded-lg border bg-card text-card-foreground shadow-sm",e),...a}));ze.displayName="Card";const Ee=e.forwardRef(({className:e,...a},t)=>s.jsx("div",{ref:t,className:he("flex flex-col space-y-1.5 p-6",e),...a}));Ee.displayName="CardHeader";const Ve=e.forwardRef(({className:e,...a},t)=>s.jsx("div",{ref:t,className:he("text-2xl font-semibold leading-none tracking-tight",e),...a}));Ve.displayName="CardTitle";e.forwardRef(({className:e,...a},t)=>s.jsx("div",{ref:t,className:he("text-sm text-muted-foreground",e),...a})).displayName="CardDescription";const De=e.forwardRef(({className:e,...a},t)=>s.jsx("div",{ref:t,className:he("p-6 pt-0",e),...a}));De.displayName="CardContent";function Te(){const{openConfirmDialog:e}=ve(),s=localStorage.getItem("token");return{handleVaultList:async e=>{const a=await fetch(Ne(Pe.API_URL+"/api/vault?limit=100"),{method:"GET",headers:{"Content-Type":"application/json",Domain:window.location.origin,Token:s,Lang:Le()}});if(!a.ok)throw new Error("Network response was not ok");const t=await a.json();if(!(t.code<100&&t.code>0))return{success:!1,error:t.message+": "+t.details};e(t.data||[])},handleVaultDelete:async a=>{const t={id:a},r=await fetch(Ne(Pe.API_URL+"/api/vault"),{method:"DELETE",body:JSON.stringify(t),headers:{"Content-Type":"application/json",Domain:window.location.origin,Token:s,Lang:Le()}});if(!r.ok)throw new Error("Network response was not ok");const n=await r.json();n.code>100&&e(n.message+": "+n.details,"error")},handleVaultUpdate:async(a,t)=>{const r=await fetch(Ne(Pe.API_URL+"/api/vault"),{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json",Domain:window.location.origin,Token:s,Lang:Le()}});if(!r.ok)throw new Error("Network response was not ok");const n=await r.json();n.code<100&&n.code>0?(e(n.message,"success"),t(n.data)):e(n.message+": "+n.details,"error")}}}e.forwardRef(({className:e,...a},t)=>s.jsx("div",{ref:t,className:he("flex items-center p-6 pt-0",e),...a})).displayName="CardFooter";const Me={};function Oe(){const{openConfirmDialog:e}=ve(),s=localStorage.getItem("token"),a=()=>({"Content-Type":"application/json",Domain:window.location.origin,Token:s,Lang:Le()});return{handleNoteList:async(s,t,r,n)=>{try{const o=Math.floor(t).toString(),l=Math.floor(r).toString(),i=await fetch(Ne(`${Pe.API_URL}/api/notes?vault=${s}&page=${o}&pageSize=${l}`),{method:"GET",headers:a()});if(!i.ok)throw new Error("Network response was not ok");const c=await i.json();c.code>0&&c.code<=200?n(c.data||{list:[],pager:{page:1,pageSize:r,totalRows:0}}):e(c.message,"error")}catch(o){e(o.message,"error")}},handleGetNote:async(s,t,r)=>{try{const n=await fetch(Ne(`${Pe.API_URL}/api/note?vault=${s}&path=${encodeURIComponent(t)}`),{method:"GET",headers:a()});if(!n.ok)throw new Error("Network response was not ok");const o=await n.json();o.code>0&&o.code<=200?r(o.data):e(o.message,"error")}catch(n){e(n.message,"error")}},handleSaveNote:async(s,t,r,n={},o)=>{try{const l={vault:s,path:t,content:r,...n},i=await fetch(Ne(`${Pe.API_URL}/api/note`),{method:"POST",body:JSON.stringify(l),headers:a()});if(!i.ok)throw new Error("Network response was not ok");const c=await i.json();c.code>0&&c.code<=200?(e(c.message,"success"),o()):e(c.message+(c.details?": "+c.details.join(", "):""),"error")}catch(l){e(l.message,"error")}},handleDeleteNote:async(s,t,r,n)=>{try{const o={vault:s,path:t,pathHash:r},l=await fetch(Ne(`${Pe.API_URL}/api/note`),{method:"DELETE",body:JSON.stringify(o),headers:a()});if(!l.ok)throw new Error("Network response was not ok");const i=await l.json();i.code>0&&i.code<=200?(e(i.message,"success"),n()):e(i.message+(i.details?": "+i.details.join(", "):""),"error")}catch(o){e(o.message,"error")}}}}const Fe=e.lazy(()=>function(e,s){let a=Promise.resolve();if(s&&s.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),r=(null==t?void 0:t.nonce)||(null==t?void 0:t.getAttribute("nonce"));a=e(s.map(e=>{if((e=function(e){return"/"+e}(e))in Me)return;Me[e]=!0;const s=e.endsWith(".css"),a=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const t=document.createElement("link");return t.rel=s?"stylesheet":"modulepreload",s||(t.as="script"),t.crossOrigin="",t.href=e,r&&t.setAttribute("nonce",r),document.head.appendChild(t),s?new Promise((s,a)=>{t.addEventListener("load",s),t.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function t(e){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=e,window.dispatchEvent(s),!s.defaultPrevented)throw e}return a.then(s=>{for(const e of s||[])"rejected"===e.status&&t(e.reason);return e().catch(t)})}(()=>import("./vendor-react-DvTO2YHG.js").then(e=>e.a4),__vite__mapDeps([0,1,2,3,4])));function Ue({vault:a,note:r,mode:n,onBack:o,onSaveSuccess:l,onEdit:i}){const{t:c}=t(),{handleGetNote:d,handleSaveNote:m}=Oe(),[f,p]=e.useState(""),[w,v]=e.useState(""),[N,b]=e.useState(!1),[j,y]=e.useState(!1),[S,P]=e.useState(null);e.useEffect(()=>{r?(p(r.path.replace(/\.md$/,"")),b(!0),d(a,r.path,e=>{P(e),v(e.content),b(!1)})):(p(""),v(""),P(null))},[r,a]);const{folder:k,filename:C}=(e=>{const s=e.lastIndexOf("/");return-1===s?{folder:"",filename:e}:{folder:e.substring(0,s),filename:e.substring(s+1)}})(f);return s.jsxs(ze,{className:"w-full h-full flex flex-col",children:[s.jsxs(Ee,{className:"flex flex-row items-start justify-between space-y-0 pb-2 border-b gap-4",children:[s.jsxs("div",{className:"flex items-start space-x-2 flex-1 overflow-hidden",children:[s.jsx(xe,{variant:"ghost",size:"icon",onClick:o,className:"shrink-0 mt-0.5",children:s.jsx(u,{className:"h-5 w-5"})}),"view"===n?s.jsxs("div",{className:"flex items-start flex-wrap text-lg overflow-hidden break-all whitespace-normal pt-1.5",children:[k&&s.jsxs("div",{className:"flex items-center shrink-0",children:[s.jsx(h,{className:"h-4 w-4 mr-1 text-muted-foreground"}),s.jsx("span",{className:"text-muted-foreground",children:k}),s.jsx("span",{className:"text-muted-foreground mx-1",children:"/"})]}),s.jsx("span",{className:"font-bold",children:C})]}):s.jsx(ye,{value:f,onChange:e=>{const s=e.target.value.replace(/[<>:"\\|?*\x00-\x1f]/g,"").trim();p(s)},placeholder:c("noteTitlePlaceholder").replace(" (e.g., note.md)","").replace(" (例如: note.md)",""),className:"font-bold text-lg border-none shadow-none focus-visible:ring-0 px-0"})]}),"edit"===n?s.jsxs(xe,{onClick:()=>{if(!f)return;y(!0);const e=f.endsWith(".md")?f:f+".md",s={};S&&(e!==S.path?(s.srcPath=S.path,s.srcPathHash=S.pathHash,s.pathHash=S.pathHash):(s.pathHash=S.pathHash,s.contentHash=S.contentHash)),m(a,e,w,s,()=>{y(!1),l()})},disabled:j||N||!f,className:"shrink-0",children:[s.jsx(g,{className:"mr-2 h-4 w-4"}),c(j?"saving":"save")]}):s.jsxs(xe,{onClick:i,variant:"outline",className:"shrink-0",children:[s.jsx(x,{className:"mr-2 h-4 w-4"}),c("edit")]})]}),s.jsx(De,{className:"flex-1 p-4 flex flex-col",children:N?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):s.jsx("div",{className:"flex-1 min-h-[500px] overflow-hidden","data-color-mode":"light",children:s.jsx(e.Suspense,{fallback:s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}),children:s.jsx(Fe,{value:w,onChange:e=>v(e||""),height:"100%",preview:"view"===n?"preview":"live",hideToolbar:"view"===n,visibleDragbar:"edit"===n})})})})]})}const _e=A,$e=z,Be=e.forwardRef(({className:e,children:a,...t},r)=>s.jsxs(f,{ref:r,className:he("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...t,children:[a,s.jsx(p,{asChild:!0,children:s.jsx(w,{className:"h-4 w-4 opacity-50"})})]}));Be.displayName=f.displayName;const He=e.forwardRef(({className:e,...a},t)=>s.jsx(v,{ref:t,className:he("flex cursor-default items-center justify-center py-1",e),...a,children:s.jsx(N,{className:"h-4 w-4"})}));He.displayName=v.displayName;const qe=e.forwardRef(({className:e,...a},t)=>s.jsx(b,{ref:t,className:he("flex cursor-default items-center justify-center py-1",e),...a,children:s.jsx(w,{className:"h-4 w-4"})}));qe.displayName=b.displayName;const Ze=e.forwardRef(({className:e,children:a,position:t="popper",...r},n)=>s.jsx(j,{children:s.jsxs(y,{ref:n,className:he("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===t&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:t,...r,children:[s.jsx(He,{}),s.jsx(S,{className:he("p-1","popper"===t&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),s.jsx(qe,{})]})}));Ze.displayName=y.displayName;e.forwardRef(({className:e,...a},t)=>s.jsx(P,{ref:t,className:he("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...a})).displayName=P.displayName;const Ge=e.forwardRef(({className:e,children:a,...t},r)=>s.jsxs(k,{ref:r,className:he("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...t,children:[s.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:s.jsx(C,{children:s.jsx(L,{className:"h-4 w-4"})})}),s.jsx(R,{children:a})]}));Ge.displayName=k.displayName;function We({vault:a,vaults:r,onVaultChange:n,onSelectNote:o,onCreateNote:l,page:i,setPage:c,pageSize:d,setPageSize:m}){const{t:u}=t(),{handleNoteList:h,handleDeleteNote:g}=Oe(),[f,p]=e.useState([]),[w,v]=e.useState(!1),[N,b]=e.useState(0),j=(e=i,s=d)=>{v(!0),h(a,e,s,e=>{p(e.list),b(e.pager.totalRows),v(!1)})};e.useEffect(()=>{j(i,d)},[a,i,d]);const y=e=>{e>=1&&e<=Math.ceil(N/d)&&c(e)},S=Math.ceil(N/d);return s.jsxs(ze,{className:"w-full",children:[s.jsxs(Ee,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx("div",{className:"flex items-center space-x-4",children:r&&n?s.jsxs(_e,{value:a,onValueChange:n,children:[s.jsx(Be,{className:"w-auto min-w-[220px] font-medium",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"font-bold",children:s.jsx($e,{placeholder:"Select Vault"})}),s.jsx("span",{className:"text-muted-foreground",children:"/"}),s.jsx("span",{className:"font-bold",children:u("notes")})]})}),s.jsx(Ze,{children:r.map(e=>s.jsx(Ge,{value:e.vault,children:e.vault},e.id))})]}):s.jsxs(Ve,{className:"text-xl font-bold",children:[u("notes")," (",N,")"]})}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx(xe,{variant:"outline",size:"icon",onClick:()=>j(),disabled:w,children:s.jsx(E,{className:"h-4 w-4 "+(w?"animate-spin":"")})}),s.jsxs(xe,{onClick:l,children:[s.jsx(V,{className:"h-4 w-4 sm:mr-2"}),s.jsx("span",{className:"hidden sm:inline",children:u("newNote")})]})]})]}),s.jsx(De,{className:"p-0",children:s.jsx("div",{className:"pb-6 pt-2",children:f&&0!==f.length?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"border-t border-b border-gray-200 divide-y divide-gray-200",children:f.map((e,t)=>s.jsxs("div",{className:`flex items-start justify-between px-6 py-3 cursor-pointer transition-colors ${t%2==0?"bg-white":"bg-gray-50"} hover:bg-blue-50`,onClick:()=>o(e,"view"),children:[s.jsxs("div",{className:"flex items-start space-x-4 overflow-hidden",children:[s.jsx(D,{className:"h-5 w-5 text-blue-500 flex-shrink-0 mt-0.5"}),s.jsxs("div",{className:"flex flex-col overflow-hidden",children:[s.jsx("span",{className:"font-medium text-base break-all whitespace-normal",children:e.path.replace(/\.md$/,"")}),s.jsxs("div",{className:"flex items-center sm:space-x-3 text-xs text-gray-400 mt-1",children:[s.jsxs("span",{className:"hidden sm:flex items-center",title:u("createdAt"),children:[s.jsx(T,{className:"mr-1 h-3 w-3"}),de(new Date(e.ctime),"yyyy-MM-dd HH:mm")]}),s.jsxs("span",{className:"flex items-center",title:u("updatedAt"),children:[s.jsx(M,{className:"mr-1 h-3 w-3"}),de(new Date(e.mtime),"yyyy-MM-dd HH:mm")]})]})]})]}),s.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0 ml-2",children:[s.jsx(xe,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-500 hover:text-blue-600 hover:bg-blue-50 hidden sm:inline-flex",onClick:s=>{s.stopPropagation(),o(e,"view")},title:u("view"),children:s.jsx(O,{className:"h-4 w-4"})}),s.jsx(xe,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-500 hover:text-green-600 hover:bg-green-50 hidden sm:inline-flex",onClick:s=>{s.stopPropagation(),o(e,"edit")},title:u("edit"),children:s.jsx(x,{className:"h-4 w-4"})}),s.jsx(xe,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-500 hover:text-red-600 hover:bg-red-50",onClick:s=>((e,s)=>{e.stopPropagation(),g(a,s.path,s.pathHash,()=>{j()})})(s,e),children:s.jsx(F,{className:"h-4 w-4"})})]})]},e.id))}),s.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center sm:justify-between px-6 py-4 gap-4 sm:gap-0",children:[s.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[s.jsxs("span",{children:[u("of")," ",N," ",u("results")]}),s.jsxs(_e,{value:d.toString(),onValueChange:e=>{const s=parseInt(e);m(s),c(1)},children:[s.jsx(Be,{className:"h-8 w-[110px]",children:s.jsx($e,{placeholder:d.toString()})}),s.jsx(Ze,{children:[10,20,50,100].map(e=>s.jsxs(Ge,{value:e.toString(),children:[e," ",u("perPage")]},e))})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs(xe,{variant:"outline",size:"sm",onClick:()=>y(i-1),disabled:1===i||w,children:[s.jsx(U,{className:"h-4 w-4"}),u("previous")]}),s.jsxs("div",{className:"text-sm font-medium",children:[u("page")," ",i," ",u("of")," ",S]}),s.jsxs(xe,{variant:"outline",size:"sm",onClick:()=>y(i+1),disabled:i===S||w,children:[u("next"),s.jsx(_,{className:"h-4 w-4"})]})]})]})]}):s.jsx("div",{className:"text-center text-gray-500 py-8",children:u("noNotes")})})})]})}function Je({vault:a="defaultVault",onVaultChange:r,onNavigateToVaults:n}){const{t:o}=t(),[l,i]=e.useState("list"),[c,d]=e.useState("view"),[m,u]=e.useState(void 0),[h,g]=e.useState([]),[x,f]=e.useState(1),[p,w]=e.useState(10),{handleVaultList:v}=Te();e.useEffect(()=>{v(e=>{g(e)})},[]),e.useEffect(()=>{f(1)},[a]);const N=()=>{i("list"),u(void 0)},b=()=>{i("list"),u(void 0)},j=()=>{d("edit")};return 0===h.length?s.jsxs(ze,{className:"w-full",children:[s.jsx(Ee,{children:s.jsx(Ve,{className:"text-xl font-bold",children:o("menuNotes")})}),s.jsxs(De,{className:"flex flex-col items-center justify-center py-12",children:[s.jsx($,{className:"h-16 w-16 text-gray-300 mb-4"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:o("noVaultsForNotes")}),s.jsx("p",{className:"text-gray-500 mb-6 text-center",children:o("createVaultFirst")}),s.jsx(xe,{onClick:()=>{n&&n()},children:o("goToVaultManagement")})]})]}):"editor"===l?s.jsx(Ue,{vault:a,note:m,mode:c,onBack:N,onSaveSuccess:b,onEdit:j}):s.jsx(We,{vault:a,vaults:h,onVaultChange:r,onSelectNote:(e,s)=>{u(e),d(s),i("editor")},onCreateNote:()=>{u(void 0),d("edit"),i("editor")},page:x,setPage:f,pageSize:p,setPageSize:w})}e.forwardRef(({className:e,...a},t)=>s.jsx(I,{ref:t,className:he("-mx-1 my-1 h-px bg-muted",e),...a})).displayName=I.displayName;const Ke=K,Ye=H,Qe=e.forwardRef(({className:e,...a},t)=>s.jsx(B,{ref:t,className:he("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a}));Qe.displayName=B.displayName;const Xe=e.forwardRef(({className:e,children:a,...t},r)=>s.jsxs(Ye,{children:[s.jsx(Qe,{}),s.jsxs(q,{ref:r,className:he("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t,children:[a,s.jsxs(Z,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[s.jsx(G,{className:"h-4 w-4"}),s.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Xe.displayName=q.displayName;const es=({className:e,...a})=>s.jsx("div",{className:he("flex flex-col space-y-1.5 text-center sm:text-left",e),...a});es.displayName="DialogHeader";const ss=e.forwardRef(({className:e,...a},t)=>s.jsx(W,{ref:t,className:he("text-lg font-semibold leading-none tracking-tight",e),...a}));ss.displayName=W.displayName;e.forwardRef(({className:e,...a},t)=>s.jsx(J,{ref:t,className:he("text-sm text-muted-foreground",e),...a})).displayName=J.displayName;const as=le({vault:ie().min(1,"仓库名称不能为空")});function ts({config:e,onSubmit:a}){const{t:r}=t(),{handleVaultUpdate:n}=Te(),{register:o,handleSubmit:l,formState:{errors:i}}=c({resolver:m(as),defaultValues:e||{}});return s.jsxs("form",{onSubmit:l(s=>{e&&(s.id=e.id),n(s,()=>{a()})}),className:"space-y-4 border px-4 py-10  mb-6",children:[s.jsx("div",{className:"grid grid-cols-1 gap-4",children:s.jsxs("div",{className:"space-y-2",children:[s.jsx(je,{htmlFor:"vault",children:r("vaultName")}),s.jsx(ye,{id:"vault",autoComplete:"off",...o("vault")}),i.vault&&s.jsx("p",{className:"text-sm text-red-500",children:i.vault.message})]})}),s.jsx(xe,{type:"submit",className:"w-full",children:r(e?"save":"add")})]})}function rs({onNavigateToNotes:a}){const{t:r}=t(),[n,o]=e.useState([]),[l,i]=e.useState(!1),[c,d]=e.useState(void 0),{handleVaultList:m,handleVaultDelete:u}=Te(),{openConfirmDialog:h}=ve(),g=()=>{m(e=>{o(e)})};e.useEffect(()=>{g()},[]);const f=e=>{if(!e)return"0 MB";const s=parseInt(e);if(isNaN(s))return"0 MB";return`${(s/1048576).toFixed(2)} MB`};return s.jsxs("div",{className:"w-full",children:[s.jsxs(ze,{className:"w-full",children:[s.jsxs(Ee,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsxs(Ve,{className:"text-xl font-bold",children:[r("vaultManagement")," (",n.length,")"]}),s.jsxs(xe,{onClick:()=>{d(void 0),i(!0)},size:"sm",children:[s.jsx(V,{className:"mr-2 h-4 w-4"}),r("addVault")]})]}),s.jsx(De,{className:"p-0",children:s.jsx("div",{className:"pb-6 pt-2",children:0===n.length?s.jsx("div",{className:"text-center text-gray-500 py-8",children:r("noVaults")}):s.jsx("div",{className:"border-t border-b border-gray-200 divide-y divide-gray-200",children:n.map((e,t)=>s.jsxs("div",{className:`flex items-center justify-between px-6 py-3 transition-colors ${t%2==0?"bg-white":"bg-gray-50"} hover:bg-blue-50`,children:[s.jsxs("div",{className:"flex items-center space-x-4 overflow-hidden",children:[s.jsx($,{className:"h-5 w-5 text-blue-500 flex-shrink-0"}),s.jsxs("div",{className:"flex flex-col overflow-hidden",children:[s.jsx("span",{className:"font-medium truncate text-base cursor-pointer hover:text-blue-600 hover:underline",onClick:()=>a&&a(e.vault),children:e.vault}),s.jsxs("div",{className:"flex items-center sm:space-x-3 text-xs text-gray-400",children:[s.jsxs("span",{className:"font-mono hidden sm:inline",children:["ID: ",e.id]}),s.jsx("span",{className:"hidden sm:inline",children:"•"}),s.jsxs("span",{children:[e.noteCount," ",r("note")||"Notes"]}),s.jsx("span",{children:"•"}),s.jsx("span",{children:f(e.size)}),s.jsxs("span",{className:"hidden sm:inline-flex items-center ml-2",children:[s.jsx(M,{className:"mr-1 h-3 w-3"}),e.updatedAt]})]})]})]}),s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx(xe,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-500 hover:text-blue-600 hover:bg-blue-50",onClick:()=>a&&a(e.vault),title:r("viewNotes"),children:s.jsx(D,{className:"h-4 w-4"})}),s.jsx(xe,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-500 hover:text-purple-600 hover:bg-purple-50",onClick:()=>(e=>{const a={api:Pe.API_URL,apiToken:localStorage.getItem("token"),vault:e},t=JSON.stringify(a,null,2);navigator.clipboard?navigator.clipboard.writeText(t).then(()=>{h(r("copyConfigSuccess"),"success",void 0,s.jsx("textarea",{readOnly:!0,className:"mt-1 block w-full p-2.5 text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 resize-none h-52",children:t}))}).catch(e=>{h(r("error")+e)}):h(r("error")+r("copyConfigError"),"error",void 0,s.jsx("textarea",{readOnly:!0,className:"mt-1 block w-full p-2.5 text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 resize-none h-52",children:t}))})(e.vault),title:r("copyConfig").includes("Copy")?`Copy ${e.vault} Config`:`复制仓库 ${e.vault} 配置`,children:s.jsx(Y,{className:"h-4 w-4"})}),s.jsx(xe,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-500 hover:text-green-600 hover:bg-green-50",onClick:()=>{d(e),i(!0)},children:s.jsx(x,{className:"h-4 w-4"})}),s.jsx(xe,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-500 hover:text-red-600 hover:bg-red-50",onClick:()=>(async e=>{h(r("confirmDelete"),"confirm",async()=>{await u(e),o(n.filter(s=>s.id!==e))})})(e.id),children:s.jsx(F,{className:"h-4 w-4"})})]})]},e.id))})})})]}),s.jsx(Ke,{open:l,onOpenChange:i,children:s.jsxs(Xe,{className:"w-[95vw] max-w-md",children:[s.jsx(es,{children:s.jsx(ss,{children:r(c?"editVault":"addVault")})}),s.jsx(ts,{config:c,onSubmit:()=>{i(!1),g()}})]})})]})}function ns({onSuccess:e,onRegister:a}){const{t:r,i18n:n}=t(),{isLoading:o,login:l}=Re(),{openConfirmDialog:i}=ve(),u=(h=r,le({credentials:ie().min(1,h("credentialsRequired")),password:Ie(h),remember:ce.boolean().optional().default(!1)}));var h;const{handleSubmit:g,register:x,formState:{errors:f}}=c({resolver:m(u)});return s.jsxs("div",{className:"w-full max-w-4xl mx-auto p-5 space-y-4 relative",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h1",{className:"text-3xl font-bold",children:r("title")}),s.jsxs(xe,{variant:"outline",onClick:()=>Ce("en"===n.language?"zh":"en"),className:"text-sm font-medium hover:bg-slate-100 transition-colors",children:[s.jsx(d,{className:"mr-2 h-4 w-4"}),"en"===n.language?"中文":"English"]})]}),s.jsx("div",{className:"space-y-2",children:s.jsxs("div",{className:"text-gray-500",children:[s.jsx(xe,{variant:"link",onClick:()=>{window.open("https://github.com/haierkeys/fast-note-sync-service","_blank","noopener,noreferrer")},type:"button",className:"text-gray-500 p-0 pr-2",children:"Obsidian Fast Note Sync Service"}),s.jsxs("p",{className:"text-gray-400 text-xs italic ",children:[r("subtitlePrefix")," ",s.jsx("a",{href:"https://github.com/haierkeys/obsidian-fast-note-sync",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-600 underline",children:r("subtitlePluginName")}),"zh"===n.language&&` ${r("subtitleSuffix")}`]})]})}),s.jsxs("form",{onSubmit:g(async s=>{const a=await l(s);a.success?e():i(a.error)}),className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(je,{htmlFor:"credentials",children:r("credentials")}),s.jsx(ye,{id:"credentials",placeholder:r("credentialsPlaceholder"),...x("credentials")}),f.credentials&&s.jsx("p",{className:"text-sm text-red-500",children:f.credentials.message})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(je,{htmlFor:"password",children:r("password")}),s.jsx(ye,{id:"password",type:"password",placeholder:r("passwordPlaceholder"),...x("password")}),f.password&&s.jsx("p",{className:"text-sm text-red-500",children:f.password.message})]}),s.jsx(xe,{type:"submit",className:"w-full",disabled:o,children:r(o?"loading":"login")}),s.jsx("div",{className:"text-center mt-4",children:s.jsxs(xe,{variant:"link",onClick:a,type:"button",children:[r("noAccount")," ",r("register")]})})]}),s.jsx("div",{className:"absolute bottom-4 "})]})}function os(){const{t:a}=t(),{isLoggedIn:r,login:n,logout:o}=(()=>{const s=e.useContext(me);if(!s)throw new Error("useAuth must be used within an AuthProvider");return s})(),{versionInfo:l}=function(){const[s,a]=e.useState(null),[t,r]=e.useState(!1),[n,o]=e.useState(null);return e.useEffect(()=>{(async()=>{r(!0),o(null);try{const e=await fetch(Ne(Pe.API_URL+"/api/version"),{method:"GET",headers:{"Content-Type":"application/json",Domain:window.location.origin,Lang:Le()}});if(!e.ok)throw new Error("Network response was not ok");const s=await e.json();s.code<100&&s.code>0&&s.data?a(s.data):o(s.message||"Failed to fetch version info")}catch(e){o("Failed to fetch version info")}finally{r(!1)}})()},[]),{versionInfo:s,isLoading:t,error:n}}(),{handleVaultList:i}=Te(),[c,d]=e.useState(!1),[m,u]=e.useState("vaults"),[h,g]=e.useState("defaultVault"),[x,f]=e.useState(!1),[p,w]=e.useState(!1),[v,N]=e.useState(!1);e.useEffect(()=>{"notes"===m&&r&&i(e=>{if(e.length>0){e.some(e=>e.vault===h)&&"defaultVault"!==h||g(e[0].vault)}})},[m,r,i]);const b=[{id:"vaults",label:a("menuVaults")},{id:"notes",label:a("menuNotes")},{id:"sync",label:a("menuSync")}],{openConfirmDialog:j}=ve();return s.jsx("div",{className:"flex justify-center w-full min-h-screen bg-gray-100",children:s.jsxs("div",{className:"flex flex-col rounded-lg border text-card-foreground shadow-sm w-full max-w-[1400px] m-2 sm:m-4 md:m-10 bg-gray-50 overflow-hidden",children:[s.jsxs("div",{className:"border-b px-3 sm:px-6 py-3 flex items-center justify-between bg-gray-50 rounded-t-lg",children:[s.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[r&&s.jsx("button",{onClick:()=>N(!v),className:"md:hidden p-2 hover:bg-gray-100 rounded-md",children:v?s.jsx(G,{className:"h-5 w-5"}):s.jsx(Q,{className:"h-5 w-5"})}),s.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-blue-600 rounded-lg flex items-center justify-center",children:s.jsx("span",{className:"text-white font-bold text-xs sm:text-base",children:"OS"})}),s.jsx("span",{className:"text-sm sm:text-xl font-semibold",children:"Obsidian Fast Note Sync"})]}),r&&s.jsxs("div",{className:"relative",children:[s.jsx("button",{onClick:()=>f(!x),className:"flex items-center space-x-2 hover:bg-gray-100 rounded-full p-2",children:s.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-gray-200 rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-gray-600 text-xs sm:text-base",children:"U"})})}),x&&s.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 border z-10",children:[s.jsx("button",{onClick:()=>{w(!0),f(!1)},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:a("changePassword")}),s.jsxs("button",{onClick:()=>{o(),f(!1)},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[a("logout"),s.jsx(X,{className:"h-4 w-4 inline-block ml-2"})]})]})]})]}),s.jsxs("div",{className:"flex flex-1 relative",children:[r&&s.jsxs(s.Fragment,{children:[v&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-10 md:hidden",onClick:()=>N(!1)}),s.jsx("div",{className:`\n                  fixed md:relative inset-y-0 left-0 z-20 md:z-0\n                  w-48 border-r p-4 bg-gray-50\n                  transform transition-transform duration-200 ease-in-out\n                  ${v?"translate-x-0":"-translate-x-full"}\n                  md:translate-x-0\n                `,children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("h2",{className:"text-lg font-semibold mb-4",children:a("navigation")}),s.jsx("nav",{className:"space-y-2",children:b.map(e=>s.jsx("button",{onClick:()=>{"sync"!==e.id?(u(e.id),N(!1)):j(a("underConstruction"),"info")},className:"w-full text-left px-3 py-2 rounded-md transition-colors whitespace-nowrap "+(m===e.id?"bg-blue-100 text-blue-700":"hover:bg-gray-100"),children:e.label},e.id))}),s.jsx("div",{className:"mt-4 pt-4 border-t",children:s.jsxs("button",{onClick:()=>{const e={api:Pe.API_URL,apiToken:localStorage.getItem("token"),vault:"defaultVault"},t=JSON.stringify(e,null,2);navigator.clipboard?navigator.clipboard.writeText(t).then(()=>{j(a("copyConfigSuccess"),"success",void 0,s.jsx("textarea",{readOnly:!0,className:"mt-1 block w-full p-2.5 text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 resize-none h-52",children:t}))}).catch(e=>{j(a("error")+e)}):j(a("error")+a("copyConfigError"),"error",void 0,s.jsx("textarea",{readOnly:!0,className:"mt-1 block w-full p-2.5 text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 resize-none h-52",children:t}))},className:"w-full flex items-center justify-center px-3 py-2 text-sm bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:[s.jsx(Y,{className:"mr-2 h-4 w-4"}),a("copyConfig")]})})]})})]}),s.jsx("div",{className:"flex-1 py-6 sm:py-8 px-2 sm:px-4 md:px-6 lg:px-8 "+(r?"":"w-full"),children:r?p?s.jsxs("div",{className:"max-w-md mx-auto bg-white p-4 sm:p-6 rounded-lg shadow-md",children:[s.jsx("h2",{className:"text-xl font-bold mb-4",children:a("changePassword")}),s.jsx(ke,{close:()=>w(!1)})]}):"notes"===m?s.jsx(Je,{vault:h,onVaultChange:g,onNavigateToVaults:()=>u("vaults")}):s.jsx(rs,{onNavigateToNotes:e=>{g(e),u("notes")}}):c?s.jsx(Ae,{onSuccess:()=>{n(),d(!1)},onBackToLogin:()=>d(!1)}):s.jsx(ns,{onSuccess:()=>{n()},onRegister:()=>d(!0)})})]}),s.jsx("div",{className:"border-t px-4 py-3 bg-gray-50 text-center text-sm text-gray-600 rounded-b-lg",children:s.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-2",children:[s.jsx("span",{children:"© 2024 Obsidian Fast Note Sync Service"}),s.jsx("span",{className:"hidden sm:inline",children:"•"}),s.jsx("a",{href:"https://github.com/haierkeys/fast-note-sync-service",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 hover:underline",children:"GitHub"}),l&&s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"hidden sm:inline",children:"•"}),s.jsxs("span",{className:"text-gray-500",children:["v",l.version,l.gitTag&&` ( ${l.gitTag} / ${l.buildTime} )`]})]})]})})]})})}const ls={en:{title:"User Login",subtitle:"A high-performance, low-latency note synchronization service built with Golang + Websocket + Sqlite + React, requires Obsidian Fast Note Sync Plugin",subtitlePrefix:"A high-performance, low-latency note synchronization service built with Golang + Websocket + Sqlite + React, requires",subtitlePluginName:"Obsidian Fast Note Sync Plugin",credentials:"Username (or Email)",username:"Username",password:"Password",remember:"Remember Me",forgotPassword:"Forgot Password?",login:"Login",loading:"Logging in...",credentialsPlaceholder:"Please enter username (or email)",usernamePlaceholder:"Please enter username",passwordPlaceholder:"Please enter password",register:"Register",registerTitle:"User Registration",registerSubtitle:"Create Your Account",confirmPassword:"Confirm Password",email:"Email",emailPlaceholder:"Please enter email",confirmPasswordPlaceholder:"Please confirm password",alreadyHaveAccount:"Already have an account?",registerButton:"Register",registering:"Registering...",backToLogin:"Back to Login",noAccount:"Don't have an account yet?",VaultListName:"Cloud Storage Settings Management",addStorage:"Add Cloud Storage",editStorage:"Edit Storage",name:"Name",type:"Type",region:"Region Region (S3)",bucket:"Bucket",endpoint:"Endpoint Endpoint (OSS)",endpointMinio:"Endpoint Endpoint (MinIO)",isDefault:"Default",actions:"Actions",setAsDefault:"Set as Default",selectStorageType:"Select Storage Type",save:"Save",add:"Add",confirmDelete:"Are you sure you want to delete this vault?",vaultManagement:"Vault Management",addVault:"Add Vault",vaultName:"Vault Name",noteCount:"Note Count",size:"Size",updatedAt:"Updated At",createdAt:"Created At",editVault:"Edit Vault",noVaults:"No vaults found",ossName:"Aliyun OSS",s3Name:"Amazon S3",r2Name:"Cloudflare R2",minioName:"MinIO",localfsName:"Server Local Storage",webdavName:"WebDAV",accountId:"Account ID Account ID (R2)",bucketName:"Bucket Name",accessKeyId:"AccessKey ID",accessKeySecret:"AccessKey Secret",customPath:"Custom Save Path",accessUrlPrefix:"Access URL Prefix",webUser:"WebDAV Username",webPassword:"WebDAV Password",webUrl:"WebDAV Address",isEnabled:"Enabled",logout:"Logout",close:"Close",cancel:"Cancel",confirm:"Confirm",success:"Success",error:"Error",warning:"Warning",info:"Info",tableScrollsShowMore:"Hint: Scroll left and right in the table to show more, up to 100 items",copyConfig:"Copy API Configuration",copyConfigSuccess:"API configuration information has been copied to the clipboard. Please return to the Obsidian plugin to paste the configuration",copyConfigError:"Clipboard API is not available. Please copy manually and return to the Obsidian plugin to paste the configuration",credentialsRequired:"Username (or email) cannot be empty",passwordMinLength:"Password must be at least 6 characters long",usernameMinLength:"Username must be at least 3 characters long",emailInvalid:"Please enter a valid email address",passwordMismatch:"Passwords do not match",oss:"OSS",s3:"S3",r2:"R2",minio:"MinIO",localfs:"Local",ossDesc:"Aliyun OSS cloud storage",s3Desc:"Amazon S3 cloud storage",r2Desc:"Cloudflare R2 cloud storage",minioDesc:"MinIO cloud storage",localfsDesc:"Server local storage",changePassword:"Change Password",currentPassword:"Current Password",newPassword:"New Password",confirmNewPassword:"Confirm New Password",passwordChangedSuccess:"Password changed successfully",passwordChangeFailed:"Failed to change password",submitting:"Submitting...",menuVaults:"Vault Management",menuNotes:"Note Management",menuSync:"Remote Sync",navigation:"Navigation",note:"Note",notes:"Notes",newNote:"New Note",noNotes:"No notes found",noteTitlePlaceholder:"Note Title (e.g., note.md)",noteContentPlaceholder:"Enter note content...",saving:"Saving...",view:"View",edit:"Edit",viewNotes:"View Notes",showing:"Showing",to:"to",of:"of",results:"results",page:"Page",previous:"Previous",next:"Next",rowsPerPage:"Rows per page",perPage:"/ page",underConstruction:"Feature under development...",noVaultsForNotes:"No vaults available",createVaultFirst:"Please create a vault first to manage notes",goToVaultManagement:"Go to Vault Management"},zh:{title:"用户登录",subtitle:"基于 Golang + Websocket + Sqlite + React 构建的高性能 低延迟 笔记同步服务, 需要 Obsidian Fast Note Sync Plugin 配合使用",subtitlePrefix:"基于 Golang + Websocket + Sqlite + React 构建的高性能 低延迟 笔记同步服务, 需要和",subtitlePluginName:"Obsidian Fast Note Sync Plugin",subtitleSuffix:"配合使用",credentials:"用户名 ( 或 邮箱 )",username:"用户名",password:"密码",remember:"记住我",forgotPassword:"忘记密码？",login:"登录",loading:"登录中...",credentialsPlaceholder:"请输入用户名 ( 或 邮箱 )",usernamePlaceholder:"请输入用户名",passwordPlaceholder:"请输入密码",register:"注册",registerTitle:"用户注册",registerSubtitle:"创建您的账户",confirmPassword:"确认密码",email:"邮箱",emailPlaceholder:"请输入邮箱",confirmPasswordPlaceholder:"请确认密码",alreadyHaveAccount:"已有账户？",registerButton:"注册",registering:"注册中...",backToLogin:"返回登录",noAccount:"还没有账户？",VaultListName:"笔记仓库列表",isDefault:"默认",actions:"操作",setAsDefault:"设为默认",selectStorageType:"选择存储类型",save:"保存",add:"新增",confirmDelete:"确定要删除这个仓库吗？",vaultManagement:"笔记仓库",addVault:"新建仓库",vaultName:"仓库名称",noteCount:"笔记数量",size:"占用空间",updatedAt:"更新时间",createdAt:"创建时间",editVault:"编辑仓库",noVaults:"暂无仓库",isEnabled:"已启用",logout:"退出登录",close:"关闭",cancel:"取消",confirm:"确定",success:"成功",error:"错误",warning:"警告",info:"信息",tableScrollsShowMore:"提示：左右滚动表格显示更多, 最多100条",copyConfig:"复制默认配置",copyConfigSuccess:"API 配置信息 已复制 到剪贴板, 请返回 obsidian 插件粘贴配置",copyConfigError:"剪贴板 API 不可用, 请手动复制并返回 obsidian 插件粘贴配置",credentialsRequired:"用户名（或邮箱）不能为空",passwordMinLength:"密码至少需要6个字符",usernameMinLength:"用户名至少3个字符",emailInvalid:"请输入有效的邮箱地址",passwordMismatch:"两次输入的密码不一致",changePassword:"修改密码",currentPassword:"当前密码",newPassword:"新密码",confirmNewPassword:"确认新密码",passwordChangedSuccess:"密码修改成功",passwordChangeFailed:"密码修改失败",submitting:"提交中...",menuVaults:"笔记仓库",menuNotes:"笔记管理",menuSync:"远端同步",navigation:"功能导航",note:"笔记",notes:"笔记列表",newNote:"新建笔记",noNotes:"暂无笔记",noteTitlePlaceholder:"笔记标题 (例如: note.md)",noteContentPlaceholder:"请输入笔记内容...",saving:"保存中...",view:"查看",edit:"编辑",viewNotes:"查看笔记",showing:"显示",to:"到",of:"共",results:"条笔记",page:"第",previous:"上一页",next:"下一页",rowsPerPage:"每页显示",perPage:"每页",underConstruction:"功能正在开发中...",noVaultsForNotes:"还没有任何笔记仓库",createVaultFirst:"请先创建一个笔记仓库,然后再管理笔记",goToVaultManagement:"前往仓库管理"}};oe.use(ee).init({resources:{en:{translation:ls.en},zh:{translation:ls.zh}},lng:Le(),fallbackLng:"zh",interpolation:{escapeValue:!1}}),se.createRoot(document.getElementById("root")).render(s.jsx(ae.StrictMode,{children:s.jsx(ue,{children:s.jsx(we,{children:s.jsx(os,{})})})}));
