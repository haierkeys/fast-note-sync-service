import{r as e,w as s,j as t,R as a,B as r}from"./vendor-CePkgVYi.js";import{g as o,e as n,a as l,t as i,B as c,u as d,j as m,I as h,o as x}from"./index-BEFD5UPy.js";import{S as u,a as p,b as f,c as g,d as j}from"./select-CD4PBcda.js";import{C as b}from"./checkbox-Bypjlmit.js";import{T as w}from"./tooltip-BULUqi89.js";import{A as v,m as N}from"./vendor-animation-Cs3gejBo.js";import{E as y,X as k,L as C,F as S,a5 as R,P,a6 as I,V as H,_ as A,h as U,a0 as L,a1 as $,a2 as z,a3 as E,R as M,Q as F,a4 as _,g as B,a7 as V,a8 as T,a9 as D,D as W}from"./vendor-icons-JH9TotLT.js";import"./vendor-ui-BwPMR9gB.js";import"./vendor-lottie-Cgk9p7OH.js";function G({file:a,url:r,onClose:o}){var n;const{t:l}=s(),i=(null==(n=a.path.split(".").pop())?void 0:n.toLowerCase())||"",d=["jpg","jpeg","png","gif","svg","webp","bmp"].includes(i),m=["mp3","wav","flac","ogg","m4a"].includes(i),h=["mp4","webm","mkv","avi","mov"].includes(i),x="pdf"===i,u=["js","ts","jsx","tsx","py","sh","bat","go","css","html","json","c","cpp","rs","php"].includes(i),p=a.path.split("/").pop()||a.path,f=e.useRef(null),[g,j]=e.useState(!0);e.useEffect(()=>{j(!0)},[r]),e.useEffect(()=>{const e=localStorage.getItem("preview-volume");e&&f.current&&(f.current.volume=parseFloat(e))},[r]);const b=e=>{localStorage.setItem("preview-volume",e.currentTarget.volume.toString())},w=()=>{j(!1)};return t.jsx(v,{children:t.jsxs(N.div,{initial:{opacity:0,y:50,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:50,scale:.9},className:"fixed bottom-6 right-6 z-100 w-[320px] sm:w-100 bg-card border border-border rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[80vh]",children:[t.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-border bg-muted/50",children:[t.jsxs("div",{className:"flex flex-col min-w-0",children:[t.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:l(d?"ui.file.imagePreview":m?"ui.file.audioPreview":h?"ui.file.videoPreview":x?"ui.file.pdfPreview":u?"ui.file.codePreview":"ui.file.detail")}),t.jsx("h3",{className:"text-sm font-semibold truncate pr-2",title:p,children:p})]}),t.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[t.jsx(c,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-xl",onClick:()=>window.open(r,"_blank"),children:t.jsx(y,{className:"h-4 w-4"})}),t.jsx(c,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-xl hover:bg-destructive/10 hover:text-destructive",onClick:o,children:t.jsx(k,{className:"h-4 w-4"})})]})]}),t.jsxs("div",{className:"relative p-4 flex items-center justify-center bg-black/5 min-h-50 overflow-hidden text-center",children:[t.jsx(v,{children:g&&t.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-10 flex flex-col items-center justify-center bg-card/80 backdrop-blur-sm pointer-events-none",children:t.jsx(C,{className:"h-8 w-8 animate-spin text-primary mb-2"})})}),d&&t.jsx("img",{src:r,alt:p,className:"max-w-full max-h-100 object-contain rounded-lg shadow-sm transition-opacity duration-300 "+(g?"opacity-0":"opacity-100"),onLoad:w,onError:w},r),m&&t.jsxs("div",{className:"w-full py-8",children:[t.jsx("div",{className:"mb-4 flex justify-center",children:t.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center text-primary animate-pulse",children:t.jsx("svg",{className:"w-8 h-8",fill:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"})})})}),t.jsx("audio",{ref:f,src:r,controls:!0,autoPlay:!0,className:"w-full",onVolumeChange:b,onLoadedMetadata:w,onCanPlay:w,onError:w})]},r),h&&t.jsx("video",{ref:f,src:r,controls:!0,autoPlay:!0,className:"max-w-full max-h-100 rounded-lg shadow-sm transition-opacity duration-300 "+(g?"opacity-0":"opacity-100"),onVolumeChange:b,onLoadedMetadata:w,onCanPlay:w,onError:w},r),!d&&!m&&!h&&t.jsxs("div",{className:"flex flex-col items-center gap-4 py-6",children:[t.jsx("div",{className:"w-20 h-20 rounded-2xl bg-primary/5 flex items-center justify-center text-primary/60 border border-primary/10",children:x?t.jsx(S,{className:"w-10 h-10"}):u?t.jsx(R,{className:"w-10 h-10"}):t.jsx(P,{className:"w-10 h-10"})}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:l("ui.file.unsupportedPreview")}),t.jsx(c,{variant:"link",className:"text-primary mt-1 h-auto p-0",onClick:()=>window.open(r,"_blank"),children:l("ui.file.openInNewWindow")})]})]})]}),t.jsx("div",{className:"p-3 border-t border-border bg-muted/30 flex justify-end",children:t.jsxs(c,{variant:"default",size:"sm",className:"rounded-xl gap-2 text-xs",onClick:()=>window.open(r,"_blank"),children:[t.jsx(I,{className:"h-3.5 w-3.5"}),l("ui.file.browserDownload")]})})]})})}function K(e){if(0===e)return"0 B";const s=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,s)*100)/100+" "+["B","KB","MB","GB"][s]}function O({vault:x,vaults:v,onVaultChange:N,isRecycle:y=!1,page:C,setPage:I,pageSize:W,setPageSize:O,searchKeyword:J,setSearchKeyword:Q}){const{t:q}=s(),{handleFileList:X,handleDeleteFile:Y,handleRestoreFile:Z,getRawFileUrl:ee,handleFolderFiles:se,handleFolderList:te}=function(){const s=e.useCallback(()=>({"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`,Domain:window.location.origin,Lang:o()}),[]),t=e.useCallback(async(e,t,a,r=!1,o="",c="mtime",d="desc",m)=>{try{const h=n.API_URL.endsWith("/")?n.API_URL.slice(0,-1):n.API_URL,x=Math.floor(t).toString(),u=Math.floor(a).toString();let p=`${h}/api/files?vault=${encodeURIComponent(e)}&page=${x}&pageSize=${u}`;r&&(p+="&isRecycle=1"),o&&(p+=`&keyword=${encodeURIComponent(o)}`),c&&"mtime"!==c&&(p+=`&sortBy=${c}`),d&&"desc"!==d&&(p+=`&sortOrder=${d}`);const f=await fetch(l(p),{method:"GET",headers:s()});if(!f.ok)throw new Error("Network response was not ok");const g=await f.json();g.code>0&&g.code<=200?m(g.data||{list:[],pager:{page:1,pageSize:a,totalRows:0,totalPages:0}}):i.error(g.message)}catch(h){i.error(h instanceof Error?h.message:String(h))}},[s]),a=e.useCallback(async(e,t,a,r)=>{try{const o={vault:e,path:t,pathHash:a},c=n.API_URL.endsWith("/")?n.API_URL.slice(0,-1):n.API_URL,d=await fetch(l(`${c}/api/file`),{method:"DELETE",body:JSON.stringify(o),headers:s()});if(!d.ok)throw new Error("Network response was not ok");const m=await d.json();m.code>0&&m.code<=200?(i.success(m.message),r()):i.error(m.message+(m.details?": "+m.details.join(", "):""))}catch(o){i.error(o instanceof Error?o.message:String(o))}},[s]),r=e.useCallback(async(e,t,a,r)=>{try{const o={vault:e,path:t,pathHash:a},c=n.API_URL.endsWith("/")?n.API_URL.slice(0,-1):n.API_URL,d=await fetch(l(`${c}/api/file/restore`),{method:"PUT",body:JSON.stringify(o),headers:s()});if(!d.ok)throw new Error("Network response was not ok");const m=await d.json();m.code>0&&m.code<=200?(i.success(m.message),r()):i.error(m.message+(m.details?": "+m.details.join(", "):""))}catch(o){i.error(o instanceof Error?o.message:String(o))}},[s]),c=e.useCallback((e,s,t)=>{const a=n.API_URL.endsWith("/")?n.API_URL.slice(0,-1):n.API_URL,r=localStorage.getItem("token")||"",l=o();let i=`${a}/api/file?vault=${encodeURIComponent(e)}&path=${encodeURIComponent(s)}&token=${encodeURIComponent(r)}&lang=${l}`;return t&&(i+=`&pathHash=${t}`),i},[]),d=e.useCallback(async(e,t="",a="",r)=>{try{let o=`${n.API_URL.endsWith("/")?n.API_URL.slice(0,-1):n.API_URL}/api/folders?vault=${encodeURIComponent(e)}`;t&&(o+=`&path=${encodeURIComponent(t)}`),a&&(o+=`&path_hash=${encodeURIComponent(a)}`);const c=await fetch(l(o),{method:"GET",headers:s()});if(!c.ok)throw new Error("Network response was not ok");const d=await c.json();d.code>0&&d.code<=200?r(d.data||[]):i.error(d.message)}catch(o){i.error(o instanceof Error?o.message:String(o))}},[s]),m=e.useCallback(async(e,t="",a="",r,o,c="mtime",d="desc",m)=>{try{const h=n.API_URL.endsWith("/")?n.API_URL.slice(0,-1):n.API_URL,x=Math.floor(r).toString(),u=Math.floor(o).toString();let p=`${h}/api/folder/files?vault=${encodeURIComponent(e)}&page=${x}&pageSize=${u}`;t&&(p+=`&path=${encodeURIComponent(t)}`),a&&(p+=`&path_hash=${encodeURIComponent(a)}`),c&&(p+=`&sortBy=${c}`),d&&(p+=`&sortOrder=${d}`);const f=await fetch(l(p),{method:"GET",headers:s()});if(!f.ok)throw new Error("Network response was not ok");const g=await f.json();if(g.code>0&&g.code<=200){const e=g.data||{list:[],pager:{page:r,pageSize:o,totalRows:0,totalPages:0}};e.list||(e.list=[]),m(e)}else i.error(g.message)}catch(h){i.error(h instanceof Error?h.message:String(h))}},[s]);return e.useMemo(()=>({handleFileList:t,handleDeleteFile:a,handleRestoreFile:r,getRawFileUrl:c,handleFolderList:d,handleFolderFiles:m}),[t,a,r,c,d,m])}(),{openConfirmDialog:ae}=d(),[re,oe]=e.useState([]),[ne,le]=e.useState(!1),[ie,ce]=e.useState(0),[de,me]=e.useState(J),[he,xe]=e.useState("mtime"),[ue,pe]=e.useState("desc"),[fe,ge]=e.useState(new Set),[je,be]=e.useState("folder"),[we,ve]=e.useState(""),[Ne,ye]=e.useState(""),[ke,Ce]=e.useState([]),{trashType:Se,setModule:Re}=m(),[Pe,Ie]=e.useState(null),[He,Ae]=e.useState("");e.useEffect(()=>{const e=setTimeout(()=>{me(J)},500);return()=>clearTimeout(e)},[J]);const Ue=(e=C,s=W,t=de)=>{le(!0),"folder"!==je||y?X(x,e,s,y,t,he,ue,e=>{var s;oe(e.list||[]),ce((null==(s=e.pager)?void 0:s.totalRows)||0),le(!1)}):te(x,we,Ne,t=>{Ce(t||[]),se(x,we,Ne,e,s,he,ue,e=>{var s;oe(e.list||[]),ce((null==(s=e.pager)?void 0:s.totalRows)||0),le(!1)})})};e.useEffect(()=>{Ue(C,W,de),ge(new Set)},[x,C,W,de,y,he,ue,je,we]),e.useEffect(()=>{de&&be("flat")},[de,we,je,I]);const Le=e=>{e>=1&&e<=Math.ceil(ie/W)&&I(e)},$e=(e,s)=>{if(e.stopPropagation(),!s.contentHash)return;const t=new Set(fe);t.has(s.pathHash)?t.delete(s.pathHash):t.add(s.pathHash),ge(t)},ze=e=>{var s;const a=(null==(s=e.split(".").pop())?void 0:s.toLowerCase())||"";return["jpg","jpeg","png","gif","svg","webp","bmp"].includes(a)?t.jsx(V,{className:"h-5 w-5"}):"pdf"===a?t.jsx(S,{className:"h-5 w-5"}):["mp3","wav","flac","ogg","m4a"].includes(a)?t.jsx(T,{className:"h-5 w-5"}):["mp4","webm","mkv","avi","mov"].includes(a)?t.jsx(D,{className:"h-5 w-5"}):["js","ts","jsx","tsx","py","sh","bat","go","css","html","json","c","cpp","rs","php"].includes(a)?t.jsx(R,{className:"h-5 w-5"}):t.jsx(P,{className:"h-5 w-5"})},Ee=Math.ceil(ie/W);return t.jsxs("div",{className:"w-full flex flex-col space-y-4",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 py-1",children:[t.jsx("div",{className:"flex items-center gap-3",children:v&&N&&t.jsxs(u,{value:x,onValueChange:N,children:[t.jsx(p,{className:"w-auto min-w-45 rounded-xl",children:t.jsx(f,{placeholder:"Select Vault"})}),t.jsx(g,{className:"rounded-xl",children:v.map(e=>t.jsx(j,{value:e.vault,className:"rounded-xl",children:e.vault},e.id))})]})}),t.jsx("div",{className:"flex flex-col gap-2 w-full sm:w-auto",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"relative flex-1 sm:w-64",children:[t.jsx(H,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none"}),t.jsx(h,{type:"text",placeholder:q("ui.file.searchPlaceholder"),className:"pl-9 pr-8 rounded-xl",value:J,onChange:e=>Q(e.target.value)}),J&&t.jsx("button",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",onClick:()=>Q(""),children:t.jsx(k,{className:"h-4 w-4"})})]}),t.jsx(c,{variant:"outline",size:"icon",onClick:()=>Ue(),disabled:ne,className:"rounded-xl shrink-0",children:t.jsx(A,{className:"h-4 w-4 "+(ne?"animate-spin":"")})})]})})]}),"folder"===je&&!y&&we&&t.jsxs("div",{className:"flex items-center gap-2 px-1 text-sm text-muted-foreground overflow-x-auto whitespace-nowrap scrollbar-hide",children:[t.jsx("button",{className:"hover:text-primary transition-colors flex items-center",onClick:()=>{ve(""),ye(""),I(1)},children:x}),we.split("/").filter(Boolean).map((e,s,r)=>t.jsxs(a.Fragment,{children:[t.jsx(U,{className:"h-4 w-4 shrink-0"}),t.jsx("button",{className:"transition-colors "+(s===r.length-1?"text-foreground font-medium pointer-events-none":"hover:text-primary"),onClick:()=>{const e=r.slice(0,s+1).join("/");ve(e),ye(""),I(1)},children:e})]},`breadcrumb-${s}`))]}),!y&&t.jsxs("div",{className:"flex flex-wrap items-center gap-4 py-2 px-2 bg-muted/30 rounded-xl border border-border/50",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"flex items-center h-8 rounded-lg border border-border overflow-hidden bg-background shadow-sm",children:[t.jsx("button",{className:"px-4 h-full text-xs font-medium transition-colors "+("folder"===je?"bg-primary text-primary-foreground":"hover:bg-muted"),onClick:()=>{Q(""),me(""),be("folder")},children:q("ui.note.viewFolder")}),t.jsx("button",{className:"px-4 h-full text-xs font-medium transition-colors border-l border-border "+("flat"===je?"bg-primary text-primary-foreground":"hover:bg-muted"),onClick:()=>be("flat"),children:q("ui.note.viewFlat")})]}),t.jsxs("span",{className:"text-sm font-medium text-muted-foreground mr-2",children:[ie," ",q("ui.file.file")]})]}),t.jsxs("div",{className:"flex items-center h-8 rounded-xl border border-border overflow-hidden bg-background shadow-sm ml-auto",children:[t.jsxs("button",{className:"px-3 h-full text-xs flex items-center gap-1.5 transition-colors "+("mtime"===he?"bg-accent text-accent-foreground":"hover:bg-muted"),onClick:()=>xe("mtime"),children:[t.jsx(L,{className:"h-3.5 w-3.5"}),q("ui.note.sortByMtime")]}),t.jsxs("button",{className:"px-3 h-full text-xs flex items-center gap-1.5 transition-colors border-l border-border "+("ctime"===he?"bg-accent text-accent-foreground":"hover:bg-muted"),onClick:()=>xe("ctime"),children:[t.jsx($,{className:"h-3.5 w-3.5"}),q("ui.note.sortByCtime")]}),t.jsxs("button",{className:"px-3 h-full text-xs flex items-center gap-1.5 transition-colors border-l border-border "+("path"===he?"bg-accent text-accent-foreground":"hover:bg-muted"),onClick:()=>xe("path"),children:[t.jsx(S,{className:"h-3.5 w-3.5"}),q("ui.note.sortByPath")]}),t.jsx(w,{content:q("desc"===ue?"ui.note.sortDesc":"ui.note.sortAsc"),side:"top",delay:200,children:t.jsx("button",{className:"px-2.5 h-full text-xs flex items-center transition-colors border-l border-border hover:bg-muted",onClick:()=>pe("desc"===ue?"asc":"desc"),children:"desc"===ue?t.jsx(z,{className:"h-3.5 w-3.5"}):t.jsx(E,{className:"h-3.5 w-3.5"})})})]})]}),y&&t.jsxs("div",{className:"flex flex-wrap items-center gap-4 py-2 px-2 bg-muted/30 rounded-xl border border-border/50",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"flex items-center h-8 rounded-lg border border-border overflow-hidden bg-background shadow-sm",children:[t.jsx("button",{className:"px-4 h-full text-xs font-medium transition-colors "+("notes"===Se?"bg-primary text-primary-foreground":"hover:bg-muted"),onClick:()=>Re("trash","notes"),children:q("ui.note.note")}),t.jsx("button",{className:"px-4 h-full text-xs font-medium transition-colors border-l border-border "+("files"===Se?"bg-primary text-primary-foreground":"hover:bg-muted"),onClick:()=>Re("trash","files"),children:q("ui.file.file")})]}),t.jsxs("span",{className:"text-sm font-medium text-muted-foreground mr-2",children:[ie," ",q("ui.nav.menuTrash"),q("ui.file.file")]})]}),re.length>0&&t.jsxs("div",{className:"flex items-center gap-3 pl-4 border-l border-border/60",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(b,{id:"select-all",checked:re.filter(e=>e.contentHash).length>0&&fe.size===re.filter(e=>e.contentHash).length,onCheckedChange:()=>{const e=re.filter(e=>e.contentHash);fe.size===e.length&&e.length>0?ge(new Set):ge(new Set(e.map(e=>e.pathHash)))},className:"rounded-md"}),t.jsx("label",{htmlFor:"select-all",className:"text-xs font-medium cursor-pointer text-muted-foreground hover:text-foreground transition-colors",children:q("ui.common.selectAll")})]}),fe.size>0&&t.jsxs("div",{className:"flex items-center gap-3 animate-in fade-in slide-in-from-left-2 duration-200",children:[t.jsx("span",{className:"text-xs text-primary font-semibold bg-primary/10 px-2 py-0.5 rounded-full",children:q("ui.file.selectedCount",{count:fe.size})}),t.jsxs(c,{variant:"outline",size:"sm",onClick:()=>{if(0===fe.size)return;const e=re.filter(e=>fe.has(e.pathHash)&&e.contentHash);0!==e.length&&ae(q("ui.file.batchRestoreConfirm",{count:e.length}),"confirm",async()=>{le(!0);for(const s of e)await new Promise(e=>{Z(x,s.path,s.pathHash,()=>{e()})});ge(new Set),Ue()})},disabled:!re.some(e=>fe.has(e.pathHash)&&e.contentHash),className:"h-8 rounded-lg text-green-600 border-green-200 hover:bg-green-50 hover:text-green-700 hover:border-green-300 shadow-sm",children:[t.jsx(M,{className:"h-3.5 w-3.5 mr-1.5"}),q("ui.file.batchRestore")]})]})]}),t.jsxs("div",{className:"flex items-center h-8 rounded-xl border border-border overflow-hidden bg-background shadow-sm ml-auto",children:[t.jsxs("button",{className:"px-3 h-full text-xs flex items-center gap-1.5 transition-colors "+("mtime"===he?"bg-accent text-accent-foreground":"hover:bg-muted"),onClick:()=>xe("mtime"),children:[t.jsx(L,{className:"h-3.5 w-3.5"}),q("ui.note.sortByMtime")]}),t.jsxs("button",{className:"px-3 h-full text-xs flex items-center gap-1.5 transition-colors border-l border-border "+("ctime"===he?"bg-accent text-accent-foreground":"hover:bg-muted"),onClick:()=>xe("ctime"),children:[t.jsx($,{className:"h-3.5 w-3.5"}),q("ui.note.sortByCtime")]}),t.jsxs("button",{className:"px-3 h-full text-xs flex items-center gap-1.5 transition-colors border-l border-border "+("path"===he?"bg-accent text-accent-foreground":"hover:bg-muted"),onClick:()=>xe("path"),children:[t.jsx(S,{className:"h-3.5 w-3.5"}),q("ui.note.sortByPath")]}),t.jsx(w,{content:q("desc"===ue?"ui.note.sortDesc":"ui.note.sortAsc"),side:"top",delay:200,children:t.jsx("button",{className:"px-2.5 h-full text-xs flex items-center transition-colors border-l border-border hover:bg-muted",onClick:()=>pe("desc"===ue?"asc":"desc"),children:"desc"===ue?t.jsx(z,{className:"h-3.5 w-3.5"}):t.jsx(E,{className:"h-3.5 w-3.5"})})})]})]}),ne?t.jsxs("div",{className:"rounded-xl border border-border bg-card p-12 text-center text-muted-foreground",children:[t.jsx(A,{className:"h-6 w-6 animate-spin mx-auto mb-2"}),q("ui.common.loading")]}):Array.isArray(re)&&0!==re.length||Array.isArray(ke)&&0!==ke.length&&"flat"!==je?t.jsx("div",{className:"-mx-2 px-2",children:t.jsxs("div",{className:"grid grid-cols-1 gap-3 py-1",children:["folder"===je&&!y&&Array.isArray(ke)&&ke.map(e=>t.jsx("article",{className:"rounded-xl border border-border bg-card p-4 cursor-pointer transition-all duration-200 hover:shadow-md hover:border-primary/30",onClick:()=>{ve(e.path),ye(e.pathHash),I(1)},children:t.jsxs("div",{className:"flex items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex items-start gap-3 min-w-0 flex-1",children:[t.jsx("span",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-blue-500/10 text-blue-500 shrink-0",children:t.jsx(F,{className:"h-5 w-5 fill-current opacity-70"})}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("h3",{className:"font-semibold text-card-foreground truncate",children:e.path.split("/").pop()}),t.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 mt-1.5 text-xs text-muted-foreground",children:[t.jsx(w,{content:q("ui.common.createdAt"),side:"top",delay:300,children:t.jsxs("span",{className:"hidden sm:flex items-center gap-1",children:[t.jsx($,{className:"h-3.5 w-3.5"}),r(new Date(e.ctime),"yyyy-MM-dd HH:mm")]})}),t.jsx(w,{content:q("ui.common.updatedAt"),side:"top",delay:300,children:t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(L,{className:"h-3.5 w-3.5"}),r(new Date(e.mtime),"yyyy-MM-dd HH:mm")]})})]})]})]}),t.jsx("div",{className:"shrink-0",children:t.jsx(U,{className:"h-5 w-5 text-muted-foreground"})})]})},`folder-${e.pathHash}`)),Array.isArray(re)&&re.map(e=>t.jsx("article",{className:"rounded-xl border border-border bg-card p-4 transition-all duration-200 hover:shadow-md hover:border-primary/30 cursor-pointer",onClick:()=>(e=>{var s;let t=ee(x,e.path,null==(s=e.pathHash)?void 0:s.toString());y&&(t+=(t.includes("?")?"&":"?")+"isRecycle=1"),Ie(e),Ae(t)})(e),children:t.jsxs("div",{className:"flex items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex items-start gap-3 min-w-0 flex-1",children:[y&&t.jsx("div",{className:"flex items-center self-center "+(e.contentHash?"":"opacity-30"),onClick:s=>$e(s,e),children:t.jsx(b,{checked:fe.has(e.pathHash),onCheckedChange:()=>!ne&&e.contentHash&&$e({stopPropagation:()=>{}},e),disabled:!e.contentHash,className:"rounded-md"})}),t.jsx("span",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-primary/10 text-primary shrink-0",children:ze(e.path)}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("h3",{className:"font-semibold text-card-foreground truncate",children:"folder"!==je||y?e.path:e.path.split("/").pop()}),t.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 mt-1.5 text-xs text-muted-foreground",children:[t.jsx("span",{className:"flex items-center gap-1",children:K(e.size)}),t.jsx(w,{content:q("ui.common.createdAt"),side:"top",delay:300,children:t.jsxs("span",{className:"hidden sm:flex items-center gap-1",children:[t.jsx($,{className:"h-3.5 w-3.5"}),r(new Date(e.ctime),"yyyy-MM-dd HH:mm")]})}),t.jsx(w,{content:q("ui.common.updatedAt"),side:"top",delay:300,children:t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(L,{className:"h-3.5 w-3.5"}),r(new Date(e.mtime),"yyyy-MM-dd HH:mm")]})})]})]})]}),t.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[!y&&t.jsx(w,{content:q("ui.common.delete"),side:"top",delay:200,children:t.jsx(c,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-xl text-muted-foreground hover:text-destructive",onClick:s=>((e,s)=>{e.stopPropagation(),ae(q("ui.file.deleteFileConfirm",{title:s.path}),"confirm",()=>{Y(x,s.path,s.pathHash,()=>{Ue()})})})(s,e),children:t.jsx(_,{className:"h-4 w-4"})})}),y&&t.jsx(w,{content:q("ui.common.restore"),side:"top",delay:200,children:t.jsx(c,{variant:"ghost",size:"icon",disabled:!e.contentHash,className:"h-8 w-8 rounded-xl text-muted-foreground hover:text-green-600",onClick:s=>((e,s)=>{e.stopPropagation(),s.contentHash&&ae(q("ui.file.restoreFileConfirm",{title:s.path}),"confirm",()=>{Z(x,s.path,s.pathHash,()=>{Ue()})})})(s,e),children:t.jsx(M,{className:"h-4 w-4"})})})]})]})},`file-${e.pathHash}`))]})}):t.jsx("div",{className:"rounded-xl border border-border bg-card p-12 text-center text-muted-foreground",children:q("ui.file.noFiles")}),re.length>0&&t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center sm:justify-between gap-4 pt-2 shrink-0",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[t.jsxs("span",{children:[q("ui.common.of")," ",ie," ",q("ui.file.results")]}),t.jsxs(u,{value:W.toString(),onValueChange:e=>{const s=parseInt(e);O(s),I(1)},children:[t.jsx(p,{className:"h-8 w-25 rounded-xl",children:t.jsx(f,{placeholder:W.toString()})}),t.jsx(g,{className:"rounded-xl",children:[10,20,50,100].map(e=>t.jsxs(j,{value:e.toString(),className:"rounded-xl",children:[e," ",q("ui.common.perPage")]},e))})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(c,{variant:"outline",size:"sm",onClick:()=>Le(C-1),disabled:1===C||ne,className:"rounded-xl",children:[t.jsx(B,{className:"h-4 w-4"}),q("ui.common.previous")]}),t.jsxs("span",{className:"text-sm font-medium px-2",children:[C," / ",Ee]}),t.jsxs(c,{variant:"outline",size:"sm",onClick:()=>Le(C+1),disabled:C===Ee||ne,className:"rounded-xl",children:[q("ui.common.next"),t.jsx(U,{className:"h-4 w-4"})]})]})]}),Pe&&t.jsx(G,{file:Pe,url:He,onClose:()=>{Ie(null),Ae("")}},He)]})}function J({vault:a,onVaultChange:r,onNavigateToVaults:o,isRecycle:n=!1}){const{t:l}=s(),[i,d]=e.useState([]),m=e.useRef(!1),[h,u]=e.useState(1),[p,f]=e.useState(()=>{const e=localStorage.getItem("filePageSize");return e?parseInt(e,10):10}),[g,j]=e.useState("");e.useEffect(()=>{localStorage.setItem("filePageSize",p.toString())},[p]);const{handleVaultList:b}=x();return e.useEffect(()=>{b(e=>{d(e),m.current=!0})},[b]),e.useEffect(()=>{u(1)},[a]),m.current&&0===i.length?t.jsxs("div",{className:"rounded-xl border border-border bg-card p-12 flex flex-col items-center justify-center",children:[t.jsx(W,{className:"h-16 w-16 text-muted-foreground/30 mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:l("ui.file.noVaults")}),t.jsx("p",{className:"text-muted-foreground mb-6 text-center",children:l("ui.file.createVaultFirst")}),t.jsx(c,{onClick:()=>{o&&o()},className:"rounded-xl",children:l("ui.note.goToVaultManagement")})]}):t.jsx(O,{vault:a,vaults:i,onVaultChange:r,isRecycle:n,page:h,setPage:u,pageSize:p,setPageSize:f,searchKeyword:g,setSearchKeyword:j})}export{J as FileManager};
