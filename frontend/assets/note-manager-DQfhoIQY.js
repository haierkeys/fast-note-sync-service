const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vditor-editor-BLZof686.js","assets/vendor-CePkgVYi.js","assets/vendor-vditor-xmyhtb0-.js","assets/vendor-vditor-BLa3Bhig.css","assets/index-DRy0ZgO3.js","assets/vendor-ui-BwPMR9gB.js","assets/vendor-icons-krzRIBpi.js","assets/vendor-lottie-Cgk9p7OH.js","assets/vendor-animation-Cs3gejBo.js","assets/index-Dhv9glaV.css","assets/vditor-editor-BCE5LhgC.css"])))=>i.map(i=>d[i]);
import{r as e,j as s,w as t,B as a,R as n}from"./vendor-CePkgVYi.js";import{c as r,b as o,g as l,e as i,a as c,t as d,D as m,d as h,f as x,h as u,i as p,B as f,L as g,_ as j,I as N,u as w,j as v,k as b,l as y,m as k,n as C,o as S}from"./index-DRy0ZgO3.js";import{R,P as H,C as $,T as z,D as E,a as M,A as T,O as A}from"./vendor-ui-BwPMR9gB.js";import{T as P,a as D,b as L,c as I,d as U,e as V}from"./table-CgdF1ZCx.js";import{C as F}from"./checkbox-Du7osQ6U.js";import{H as _,g as O,h as B,F as G,R as K,j as J,s as Z,t as q,u as Q,v as W,w as Y,x as X,y as ee,z as se,J as te,K as ae,N as ne,Q as re,X as oe,U as le,V as ie,Y as ce,Z as de,i as me,_ as he,$ as xe,a0 as ue,a1 as pe,a2 as fe,a3 as ge,a4 as je,D as Ne}from"./vendor-icons-krzRIBpi.js";import{T as we}from"./tooltip-DDCnAs3x.js";import{S as ve,a as be,b as ye,c as ke,d as Ce}from"./select-DsD1lKsM.js";import"./vendor-lottie-Cgk9p7OH.js";import"./vendor-animation-Cs3gejBo.js";const Se=R,Re=H,He=e.forwardRef(({className:e,...t},a)=>s.jsx(A,{className:r("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:a}));He.displayName=A.displayName;const $e=e.forwardRef(({className:e,...t},a)=>s.jsxs(Re,{children:[s.jsx(He,{}),s.jsx($,{ref:a,className:r("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));$e.displayName=$.displayName;const ze=({className:e,...t})=>s.jsx("div",{className:r("flex flex-col space-y-2 text-center sm:text-left",e),...t});ze.displayName="AlertDialogHeader";const Ee=({className:e,...t})=>s.jsx("div",{className:r("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Ee.displayName="AlertDialogFooter";const Me=e.forwardRef(({className:e,...t},a)=>s.jsx(z,{ref:a,className:r("text-lg font-semibold",e),...t}));Me.displayName=z.displayName;const Te=e.forwardRef(({className:e,...t},a)=>s.jsx(E,{ref:a,className:r("text-sm text-muted-foreground",e),...t}));Te.displayName=E.displayName;const Ae=e.forwardRef(({className:e,...t},a)=>s.jsx(T,{ref:a,className:r(o(),e),...t}));Ae.displayName=T.displayName;const Pe=e.forwardRef(({className:e,...t},a)=>s.jsx(M,{ref:a,className:r(o({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));function De(){const s=localStorage.getItem("token"),t=e.useCallback(()=>({"Content-Type":"application/json",Authorization:`Bearer ${s}`,Domain:window.location.origin,Lang:l()}),[s]),a=e.useCallback(async(e,s,a,n="",r=!1,o="path",l=!1,m="mtime",h="desc",x)=>{try{const u=Math.floor(s).toString(),p=Math.floor(a).toString();let f=`${i.API_URL}/api/notes?vault=${encodeURIComponent(e)}&page=${u}&pageSize=${p}`;n&&(f+=`&keyword=${encodeURIComponent(n)}`),r&&(f+="&isRecycle=1"),o&&"path"!==o&&(f+=`&searchMode=${o}`),l&&(f+="&searchContent=1"),m&&"mtime"!==m&&(f+=`&sortBy=${m}`),h&&"desc"!==h&&(f+=`&sortOrder=${h}`);const g=await fetch(c(f),{method:"GET",headers:t()});if(!g.ok)throw new Error("Network response was not ok");const j=await g.json();if(j.code>0&&j.code<=200){const e=j.data||{list:[],pager:{page:1,pageSize:a,totalRows:0}};e.list||(e.list=[]),x(e)}else d.error(j.message)}catch(u){d.error(u instanceof Error?u.message:String(u))}},[t]),n=e.useCallback(async(e,s,a,n=!1,r)=>{try{let o=`${i.API_URL}/api/note?vault=${encodeURIComponent(e)}&path=${encodeURIComponent(s)}`;a&&(o+=`&pathHash=${a}`),n&&(o+="&isRecycle=1");const l=await fetch(c(o),{method:"GET",headers:t()});if(!l.ok)throw new Error("Network response was not ok");const m=await l.json();m.code>0&&m.code<=200&&m.data?r(m.data):m.code>0&&m.code<=200||d.error(m.message)}catch(o){d.error(o instanceof Error?o.message:String(o))}},[t]),r=e.useCallback(async(e,s,a,n={},r,o,l=!1)=>{try{const m={vault:e,path:s,content:a,...n},h=await fetch(c(`${i.API_URL}/api/note`),{method:"POST",body:JSON.stringify(m),headers:t()});if(!h.ok)throw new Error("Network response was not ok");const x=await h.json();if(x.code>0&&x.code<=200)l||d.success(x.message),r();else{const e=x.message+(x.details?": "+x.details.join(", "):"");d.error(e),o&&o(e)}}catch(m){const e=m instanceof Error?m.message:String(m);d.error(e),o&&o(e)}},[t]),o=e.useCallback(async(e,s,a,n)=>{try{const r={vault:e,path:s,pathHash:a},o=await fetch(c(`${i.API_URL}/api/note`),{method:"DELETE",body:JSON.stringify(r),headers:t()});if(!o.ok)throw new Error("Network response was not ok");const l=await o.json();l.code>0&&l.code<=200?(d.success(l.message),n()):d.error(l.message+(l.details?": "+l.details.join(", "):""))}catch(r){d.error(r instanceof Error?r.message:String(r))}},[t]),m=e.useCallback(async(e,s,a,n)=>{try{const r={vault:e,path:s,pathHash:a},o=await fetch(c(`${i.API_URL}/api/note/restore`),{method:"PUT",body:JSON.stringify(r),headers:t()});if(!o.ok)throw new Error("Network response was not ok");const l=await o.json();l.code>0&&l.code<=200?(d.success(l.message),n()):d.error(l.message+(l.details?": "+l.details.join(", "):""))}catch(r){d.error(r instanceof Error?r.message:String(r))}},[t]),h=e.useCallback(async(e,s,a,n,r,o=!1,l)=>{try{const m=Math.floor(n).toString(),h=Math.floor(r).toString();let x=`${i.API_URL}/api/note/histories?vault=${encodeURIComponent(e)}&path=${encodeURIComponent(s)}&page=${m}&pageSize=${h}`;a&&(x+=`&pathHash=${a}`),o&&(x+="&isRecycle=1");const u=await fetch(c(x),{method:"GET",headers:t()});if(!u.ok)throw new Error("Network response was not ok");const p=await u.json();if(p.code>0&&p.code<=200){const e=p.data||{list:[],pager:{page:1,pageSize:r,totalRows:0}};e.list||(e.list=[]),l(e)}else d.error(p.message)}catch(m){d.error(m instanceof Error?m.message:String(m))}},[t]),x=e.useCallback(async(e,s,a)=>{try{const n=await fetch(c(`${i.API_URL}/api/note/history?vault=${encodeURIComponent(e)}&id=${s}`),{method:"GET",headers:t()});if(!n.ok)throw new Error("Network response was not ok");const r=await n.json();r.code>0&&r.code<=200&&r.data?a(r.data):d.error(r.message)}catch(n){d.error(n instanceof Error?n.message:String(n))}},[t]),u=e.useCallback(async(e,s,a)=>{try{const n={vault:e,historyId:s},r=await fetch(c(`${i.API_URL}/api/note/history/restore`),{method:"PUT",body:JSON.stringify(n),headers:t()});if(!r.ok)throw new Error("Network response was not ok");const o=await r.json();o.code>0&&o.code<=200?(d.success(o.message),a()):d.error(o.message+(o.details?": "+o.details.join(", "):""))}catch(n){d.error(n instanceof Error?n.message:String(n))}},[t]),p=e.useCallback(async(e,s="",a="",n)=>{try{let r=`${i.API_URL}/api/folders?vault=${encodeURIComponent(e)}`;s&&(r+=`&path=${encodeURIComponent(s)}`),a&&(r+=`&path_hash=${encodeURIComponent(a)}`);const o=await fetch(c(r),{method:"GET",headers:t()});if(!o.ok)throw new Error("Network response was not ok");const l=await o.json();l.code>0&&l.code<=200?n(l.data||[]):d.error(l.message)}catch(r){d.error(r instanceof Error?r.message:String(r))}},[t]),f=e.useCallback(async(e,s="",a="",n,r,o="mtime",l="desc",m)=>{try{const h=Math.floor(n).toString(),x=Math.floor(r).toString();let u=`${i.API_URL}/api/folder/notes?vault=${encodeURIComponent(e)}&page=${h}&pageSize=${x}`;s&&(u+=`&path=${encodeURIComponent(s)}`),a&&(u+=`&path_hash=${encodeURIComponent(a)}`),o&&(u+=`&sortBy=${o}`),l&&(u+=`&sortOrder=${l}`);const p=await fetch(c(u),{method:"GET",headers:t()});if(!p.ok)throw new Error("Network response was not ok");const f=await p.json();if(f.code>0&&f.code<=200){const e=f.data||{list:[],pager:{page:n,pageSize:r,totalRows:0}};e.list||(e.list=[]),m(e)}else d.error(f.message)}catch(h){d.error(h instanceof Error?h.message:String(h))}},[t]);return e.useMemo(()=>({handleNoteList:a,handleFolderList:p,handleFolderNotes:f,handleGetNote:n,handleSaveNote:r,handleDeleteNote:o,handleRestoreNote:m,handleNoteHistoryList:h,handleNoteHistoryDetail:x,handleRestoreFromHistory:u}),[a,p,f,n,r,o,m,h,x,u])}Pe.displayName=M.displayName;const Le=({className:e})=>s.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:e,children:s.jsx("path",{d:"M0 3.449L9.75 2.1V11.7H0V3.449zm0 17.1L9.75 21.9V12.3H0v8.249zM10.5 2V11.7H24V0L10.5 2zm0 19.9l13.5 2V12.3H10.5v9.6z"})}),Ie=({className:e})=>s.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:e,children:s.jsx("path",{d:"M17.523 15.3414C17.0709 15.3414 16.7042 14.9747 16.7042 14.5226C16.7042 14.0705 17.0709 13.7038 17.523 13.7038C17.9751 13.7038 18.3418 14.0705 18.3418 14.5226C18.3418 14.9747 17.9751 15.3414 17.523 15.3414ZM6.47702 15.3414C6.02492 15.3414 5.65823 14.9747 5.65823 14.5226C5.65823 14.0705 6.02492 13.7038 6.47702 13.7038C6.92911 13.7038 7.29581 14.0705 7.29581 14.5226C7.29581 14.9747 6.92911 15.3414 6.47702 15.3414ZM17.8465 10.925L19.4975 8.06544C19.648 7.80481 19.5588 7.47196 19.2982 7.32145C19.0375 7.17094 18.7047 7.26017 18.5542 7.52081L16.8529 10.4677C15.4269 9.81534 13.8052 9.42997 12 9.42997C10.1948 9.42997 8.57307 9.81534 7.14713 10.4677L5.44577 7.52081C5.29527 7.26017 4.96245 7.17094 4.70181 7.32145C4.44116 7.47196 4.35194 7.80481 4.50244 8.06544L6.15347 10.925C3.06456 12.6015 1 15.7725 1 19.4673H23C23 15.7725 20.9354 12.6015 17.8465 10.925Z"})});function Ue({isOpen:n,onClose:r,vault:o,notePath:l,pathHash:i,isRecycle:c=!1,onRestoreSuccess:d}){const{t:j}=t(),{handleNoteHistoryList:N,handleNoteHistoryDetail:w,handleRestoreFromHistory:v}=De(),[b,y]=e.useState([]),[k,C]=e.useState(1),[S,R]=e.useState(0),[H,$]=e.useState(!1),[z,E]=e.useState(null),[M,T]=e.useState(!1),[A,X]=e.useState(!1),[ee,se]=e.useState(!1),[te,ae]=e.useState(!1),[ne,re]=e.useState(!1),[oe,le]=e.useState(!1);e.useEffect(()=>{var e;n&&(e=k,$(!0),N(o,l,i,e,5,c,e=>{e?(y(e.list||[]),e.pager&&R(e.pager.totalRows||0)):(y([]),R(0)),$(!1)}),E(null),se(!1))},[n,k,o,l]);const ie=e=>{T(!0),ae(!1),w(o,e,e=>{E(e),T(!1)})},ce=(e="")=>{const t=String(e||"").toLowerCase();return t.includes("web")?s.jsx(q,{className:"h-4 w-4 text-[#4285F4] shrink-0"}):t.includes("mac")||t.includes("apple")?s.jsx(Q,{className:"h-4 w-4 text-[#555555] shrink-0"}):t.includes("win")?s.jsx(Le,{className:"h-3.5 w-3.5 text-[#0078D4] shrink-0 translate-y-[1px]"}):t.includes("ios")||t.includes("iphone")||t.includes("ipad")?s.jsx(W,{className:"h-4 w-4 text-[#555555] shrink-0"}):t.includes("android")?s.jsx(Ie,{className:"h-4 w-4 text-[#3DDC84] shrink-0"}):s.jsx(Y,{className:"h-4 w-4 text-slate-400 shrink-0"})},de=Math.ceil((S||0)/5);return s.jsxs(m,{open:n,onOpenChange:e=>!e&&r(),children:[s.jsxs(h,{className:"max-w-4xl w-[95vw] sm:w-auto max-h-[85vh] sm:max-h-[90vh] flex flex-col p-4 sm:p-6 rounded-lg sm:rounded-xl",children:[s.jsxs(x,{children:[s.jsxs(u,{className:"flex items-center gap-2 font-normal overflow-hidden text-sm sm:text-base",children:[s.jsx(_,{className:"h-4 w-4 shrink-0 text-muted-foreground opacity-70"}),s.jsxs("span",{className:"hidden sm:inline shrink-0 text-muted-foreground",children:[j("ui.history.title"),":"]}),s.jsx("span",{className:"truncate text-foreground font-medium",children:String(l||"").replace(/\.md$/,"")})]}),s.jsx(p,{className:"sr-only",children:j("ui.history.description")})]}),s.jsx("div",{className:"flex-1 overflow-auto py-2 sm:py-4 custom-scrollbar",children:s.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[s.jsxs("div",{className:"border rounded-md overflow-hidden",children:[s.jsx("div",{className:"hidden sm:block",children:s.jsxs(P,{children:[s.jsx(D,{children:s.jsxs(L,{children:[s.jsx(I,{className:"w-[80px]",children:j("ui.history.versionLabel")}),s.jsx(I,{children:j("ui.history.clientSource")}),s.jsx(I,{children:j("ui.common.updatedAt")}),s.jsx(I,{className:"text-right pr-7",children:j("ui.common.viewDetail")})]})}),s.jsx(U,{children:H?s.jsx(L,{children:s.jsx(V,{colSpan:4,className:"text-center py-8 text-muted-foreground",children:j("ui.history.loading")})}):!Array.isArray(b)||Array.isArray(b)&&0===b.length?s.jsx(L,{children:s.jsx(V,{colSpan:4,className:"text-center py-8 text-muted-foreground",children:j("ui.history.noHistory")})}):b.filter(e=>null!==e).map(e=>s.jsxs(L,{className:"hover:bg-muted/50 transition-colors "+((null==z?void 0:z.id)===e.id?"bg-blue-50":""),children:[s.jsxs(V,{className:"font-mono",children:["v",e.version]}),s.jsx(V,{className:"text-muted-foreground",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{children:e.clientName||"Unknown"}),ce(e.clientName)]})}),s.jsx(V,{className:"text-muted-foreground",children:e.createdAt?a(new Date(e.createdAt),"yyyy-MM-dd HH:mm:ss"):"-"}),s.jsx(V,{className:"text-right",children:s.jsx(f,{variant:"ghost",size:"sm",onClick:()=>ie(e.id),children:j("ui.common.view")})})]},e.id))})]})}),s.jsx("div",{className:"sm:hidden divide-y",children:H?s.jsx("div",{className:"text-center py-8 text-muted-foreground",children:j("ui.history.loading")}):Array.isArray(b)&&0!==b.length?b.filter(e=>null!==e).map(e=>s.jsxs("div",{className:"p-3 "+((null==z?void 0:z.id)===e.id?"bg-blue-50":""),onClick:()=>ie(e.id),children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsxs("span",{className:"font-mono font-medium",children:["v",e.version]}),s.jsxs("div",{className:"flex items-center gap-1.5 text-muted-foreground text-xs",children:[ce(e.clientName),s.jsx("span",{children:e.clientName||"Unknown"})]})]}),s.jsx("div",{className:"text-xs text-muted-foreground",children:e.createdAt?a(new Date(e.createdAt),"yyyy-MM-dd HH:mm:ss"):"-"})]},e.id)):s.jsx("div",{className:"text-center py-8 text-muted-foreground",children:j("ui.history.noHistory")})})]}),de>1&&s.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-2 px-2",children:[s.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:j("ui.history.count",{count:S})}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs(f,{variant:"outline",size:"sm",onClick:()=>C(e=>Math.max(1,e-1)),disabled:1===k||H,className:"h-8 px-2 sm:px-3",children:[s.jsx(O,{className:"h-4 w-4"}),s.jsx("span",{className:"hidden sm:inline ml-1",children:j("ui.common.previous")})]}),s.jsxs("span",{className:"text-xs sm:text-sm font-medium",children:[k," / ",de]}),s.jsxs(f,{variant:"outline",size:"sm",onClick:()=>C(e=>Math.min(de,e+1)),disabled:k===de||H,className:"h-8 px-2 sm:px-3",children:[s.jsx("span",{className:"hidden sm:inline mr-1",children:j("ui.common.next")}),s.jsx(B,{className:"h-4 w-4"})]})]})]}),z&&s.jsxs("div",{className:"mt-4 sm:mt-6 border-t pt-4 sm:pt-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3 mb-4",children:[s.jsxs("h3",{className:"text-base sm:text-lg font-semibold flex items-baseline gap-2",children:[s.jsx(G,{className:"h-4 w-4 self-center"}),s.jsx("span",{children:j("ui.history.diffDetails",{version:z.version})}),s.jsxs("div",{className:"flex items-baseline gap-2 ml-2 text-[10px] font-normal uppercase tracking-wider",children:[s.jsx("span",{className:"px-1.5 py-0 rounded bg-green-100 text-muted-foreground/60 border border-green-200/50 leading-tight",children:j("ui.history.diffLegendAdd")}),s.jsx("span",{className:"px-1.5 py-0 rounded bg-red-100 text-muted-foreground/60 border border-red-200/50 leading-tight",children:j("ui.history.diffLegendDel")})]})]}),s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[!c&&s.jsxs(f,{variant:"outline",size:"sm",onClick:()=>re(!0),className:"h-8 px-3 text-blue-600 border-blue-200 hover:bg-blue-50 hover:border-blue-300",children:[s.jsx(K,{className:"h-3.5 w-3.5 mr-1.5"}),j("ui.history.restoreToVersion")]}),s.jsxs("div",{className:"flex items-center space-x-2 bg-slate-100 px-2 sm:px-3 py-1.5 rounded-lg border border-slate-200 shadow-sm",children:[s.jsx(F,{id:"showDiffOnly",checked:A,onCheckedChange:e=>{const s=!!e;X(s),s&&se(!1)}}),s.jsx(g,{htmlFor:"showDiffOnly",className:"text-xs sm:text-sm font-medium leading-none cursor-pointer text-slate-700",children:j("ui.history.showDiffOnly")})]}),s.jsxs("div",{className:"flex items-center space-x-2 bg-slate-100 px-2 sm:px-3 py-1.5 rounded-lg border border-slate-200 shadow-sm",children:[s.jsx(F,{id:"showOriginalContent",checked:ee,onCheckedChange:e=>{const s=!!e;se(s),s&&X(!1)}}),s.jsx(g,{htmlFor:"showOriginalContent",className:"text-xs sm:text-sm font-medium leading-none cursor-pointer text-slate-700",children:j("ui.history.showOriginalContent")})]})]})]}),M?s.jsx("div",{className:"py-8 text-center text-muted-foreground",children:j("loadingHistory")}):ee?s.jsxs("div",{className:"relative group",children:[(e=>{if(!e)return null;const t=`\n            <div class="diff-line-row flex items-start group h-7">\n                <div class="line-number w-10 shrink-0 text-right pr-3 select-none text-transparent font-mono text-[11px] border-r border-transparent mr-3 leading-7">\n                    -\n                </div>\n                <div class="line-content flex-1 py-0 text-slate-300 font-mono text-[11px] select-text cursor-text min-h-[28px] leading-7 h-7">${l}</div>\n            </div>\n        `+e.replace(/\r\n/g,"\n").replace(/\n$/,"").split("\n").map((e,s)=>`\n                <div class="diff-line-row flex items-start group h-7">\n                    <div class="line-number w-10 shrink-0 text-right pr-3 select-none text-slate-300 font-mono text-[11px] border-r border-slate-100 mr-3 group-hover:text-slate-400 transition-colors leading-7">\n                        ${s+1}\n                    </div>\n                    <div class="line-content flex-1 py-0 min-h-[28px] leading-7 h-7">${e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")||"&nbsp;"}</div>\n                </div>\n            `).join("");return s.jsx("div",{className:"diff-content overflow-auto max-h-[500px] p-6 bg-slate-50 rounded-xl border border-slate-200 font-mono text-[13px] leading-7 shadow-inner text-slate-700 select-text selection:bg-blue-100 selection:text-blue-900",dangerouslySetInnerHTML:{__html:t}})})(z.content),s.jsx(f,{variant:"secondary",size:te?"sm":"icon",className:`absolute top-2 right-2 h-8 ${te?"w-auto px-3":"w-8"} transition-all shadow-sm bg-white/80 hover:bg-white backdrop-blur-sm border border-slate-200 z-10 flex items-center gap-1`,onClick:()=>{z.content&&(navigator.clipboard.writeText(z.content),ae(!0),setTimeout(()=>ae(!1),2e3))},title:j("ui.note.copyNote"),children:te?s.jsxs("div",{className:"flex items-center gap-1 text-green-600 animate-in fade-in zoom-in duration-200",children:[s.jsx(J,{className:"h-3.5 w-3.5"}),s.jsx("span",{className:"text-xs font-medium",children:j("ui.common.copied")})]}):s.jsx(Z,{className:"h-4 w-4 text-slate-500"})})]}):(e=>{if(!e||!Array.isArray(e))return null;let t=0;const a=[];let n=[];const r=()=>{let e="-";n.every(e=>-1===e.Type)||(t++,e=t.toString()),a.push({lineNum:e,segments:[...n]}),n=[]};e.forEach(e=>{if(!e||null===e.Text||void 0===e.Text)return;const s=String(e.Text).split("\n");s.forEach((t,a)=>{n.push({Type:e.Type,Text:t}),a<s.length-1&&r()})}),n.length>0&&r();const o=A?a.filter(e=>e.segments&&e.segments.some(e=>0!==e.Type)):a,i=`\n            <div class="diff-line-row flex items-start group h-7">\n                <div class="line-number w-10 shrink-0 text-right pr-3 select-none text-transparent font-mono text-[11px] border-r border-transparent mr-3 leading-7">\n                    -\n                </div>\n                <div class="line-content flex-1 py-0 text-slate-300 font-mono text-[11px] select-text cursor-text min-h-[28px] leading-7 h-7">${l}</div>\n            </div>\n        `+o.map(e=>{if(!e.segments)return"";const s=e.segments.map(e=>{const s=String(e.Text||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return 1===e.Type?`<ins class="bg-green-100 text-green-900 no-underline px-0.5 rounded-sm border-b border-green-300 font-bold">${s}</ins>`:-1===e.Type?`<del class="bg-red-100 text-red-900 line-through decoration-red-400 px-0.5 rounded-sm opacity-70">${s}</del>`:`<span>${s}</span>`}).join("");return`\n                <div class="diff-line-row flex items-start group h-7">\n                    <div class="line-number w-10 shrink-0 text-right pr-3 select-none text-slate-300 font-mono text-[11px] border-r border-slate-100 mr-3 group-hover:text-slate-400 transition-colors leading-7">\n                        ${e.lineNum}\n                    </div>\n                    <div class="line-content flex-1 py-0 min-h-[28px] leading-7 h-7">${s||"&nbsp;"}</div>\n                </div>\n            `}).join("");return s.jsx("div",{className:"diff-content overflow-auto max-h-[500px] p-6 bg-slate-50 rounded-xl border border-slate-200 font-mono text-[13px] leading-7 shadow-inner text-slate-700 select-text selection:bg-blue-100 selection:text-blue-900",dangerouslySetInnerHTML:{__html:i||`<div class="text-center py-4 opacity-50 italic">${j("ui.history.noHistory")}</div>`}})})(z.diffs)]})]})})]}),s.jsx(Se,{open:ne,onOpenChange:re,children:s.jsxs($e,{children:[s.jsxs(ze,{children:[s.jsx(Me,{children:j("ui.history.restoreConfirmTitle")}),s.jsx(Te,{children:j("ui.history.restoreConfirmDesc",{version:null==z?void 0:z.version})})]}),s.jsxs(Ee,{children:[s.jsx(Pe,{disabled:oe,children:j("ui.common.cancel")}),s.jsx(Ae,{onClick:()=>{z&&(le(!0),v(o,z.id,()=>{le(!1),re(!1),r(),null==d||d()}),setTimeout(()=>le(!1),5e3))},disabled:oe,children:j(oe?"ui.common.restoring":"ui.common.confirm")})]})]})})]})}function Ve(e){let s=0;if(0===e.length)return"0";for(let t=0;t<e.length;t++){s=(s<<5)-s+e.charCodeAt(t),s|=0}return s.toString()}const Fe=e.lazy(()=>j(()=>import("./vditor-editor-BLZof686.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])).then(e=>({default:e.VditorEditor}))),_e=()=>s.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),s.jsx("span",{children:"加载编辑器..."})]})});function Oe({vault:n,note:r,onBack:o,onSaveSuccess:l,onViewHistory:i,isMaximized:c=!1,onToggleMaximize:m,isRecycle:h=!1,initialPreviewMode:x=!1}){const{t:u}=t(),{handleGetNote:p,handleSaveNote:g}=De(),j=e.useRef(null),w=e.useRef(null),v=e.useRef(null),[b,y]=e.useState(""),[k,C]=e.useState(""),[S,R]=e.useState(!1),[H,$]=e.useState(!1),[z,E]=e.useState(null),[M,T]=e.useState(!1),[A,P]=e.useState(""),[D,L]=e.useState(null),[I,U]=e.useState(!1),[V,F]=e.useState(x),O=e.useRef(null);e.useEffect(()=>{F(x)},[x,null==r?void 0:r.id]);const B=!r,G=e.useRef(""),K=e.useCallback(()=>{r?(y(r.path.replace(/\.md$/,"")),R(!0),p(n,r.path,r.pathHash,h,e=>{E(e),C(e.content),R(!1)})):(y(""),C(""),E(null))},[r,n,p,h]);e.useEffect(()=>{const e=r?`${r.id}-${r.pathHash}-${r.path}`:"new-note";e!==G.current&&(G.current=e,K())},[r,K]),e.useEffect(()=>()=>{w.current&&clearTimeout(w.current)},[]);const Z=e.useCallback(()=>{v.current&&(document.fullscreenElement?document.exitFullscreen():v.current.requestFullscreen().catch(()=>{}))},[]);e.useEffect(()=>{const e=()=>{U(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>{document.removeEventListener("fullscreenchange",e)}},[]);const q=e.useCallback((e,s,t=!1)=>{if(!e||h)return;const a=e.endsWith(".md")?e:e+".md",r={pathHash:Ve(a),contentHash:Ve(s)};z&&(r.srcPath=z.path,r.srcPathHash=Ve(z.path)),$(!0),g(n,a,s,r,()=>{$(!1),L(new Date),z&&z.path!==a&&E(e=>e?{...e,path:a}:null),l(a,r.pathHash||"")},()=>{$(!1)},t)},[n,z,g,l,h]),Q=e.useCallback(e=>{C(e),B&&!b||h||(w.current&&clearTimeout(w.current),w.current=setTimeout(()=>{q(b,e,!0)},1e3))},[b,B,h,q]),W=e.useCallback(()=>{h||(P(b),T(!0),setTimeout(()=>{var e;return null==(e=O.current)?void 0:e.focus()},0))},[b,h]),Y=e.useCallback(()=>{T(!1),P("")},[]),ie=e.useCallback(()=>{var e;const s=A.replace(/[<>:"\\|?*]/g,"").split("").filter(e=>e.charCodeAt(0)>=32).join("");if(!s)return void Y();const t=b;if(y(s),T(!1),s!==t){const t=(null==(e=j.current)?void 0:e.getValue())||k;q(s,t,!0)}},[A,b,k,q,Y]),ce=e.useCallback(e=>{"Enter"===e.key?(e.preventDefault(),ie()):"Escape"===e.key&&Y()},[ie,Y]),de=e.useCallback(e=>{const s=e.target.value.replace(/[<>:"\\|?*]/g,"").split("").filter(e=>e.charCodeAt(0)>=32).join("");y(s)},[]),me=e.useCallback(()=>{var e;if(!b)return void d.error(u("ui.note.noteTitleRequired"));const s=(null==(e=j.current)?void 0:e.getValue())||k;q(b,s,!0)},[b,k,q,u]),{folder:he,filename:xe}=(e=>{const s=e.lastIndexOf("/");return-1===s?{folder:"",filename:e}:{folder:e.substring(0,s),filename:e.substring(s+1)}})(b);return s.jsxs("div",{ref:v,className:"w-full h-full flex flex-col "+(I?"bg-background p-2 sm:p-4":""),children:[s.jsxs("div",{className:"flex items-center justify-between gap-1 sm:gap-4 mb-1 sm:mb-4",children:[s.jsxs("div",{className:"flex items-center gap-1 sm:gap-3 min-w-0 flex-1",children:[s.jsx(f,{variant:"ghost",size:"icon",onClick:o,className:"shrink-0 rounded-lg sm:rounded-xl h-7 w-7 sm:h-10 sm:w-10",children:s.jsx(X,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),B?s.jsxs("div",{className:"flex items-center gap-1 flex-1 min-w-0",children:[s.jsx(N,{value:b,onChange:de,onKeyDown:e=>"Enter"===e.key&&me(),placeholder:null==(ue=u("ui.note.noteTitlePlaceholder"))?void 0:ue.replace(" (e.g., note.md)","").replace(" (例如: note.md)",""),className:"font-bold text-sm sm:text-lg border-none shadow-none focus-visible:ring-0 px-1 sm:px-2 flex-1 h-7 sm:h-auto",autoFocus:!0}),s.jsx(f,{variant:"ghost",size:"icon-sm",className:"self-center h-6 w-6 sm:h-7 sm:w-7 shrink-0",onClick:me,disabled:!b||H,children:s.jsx(J,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})})]}):M?s.jsxs("div",{className:"flex items-center gap-1 flex-1 min-w-0",children:[he&&s.jsxs("div",{className:"hidden sm:flex items-center gap-2 shrink-0",children:[s.jsx(re,{className:"h-4 w-4 text-muted-foreground"}),s.jsx("span",{className:"text-muted-foreground truncate max-w-37.5",children:he}),s.jsx("span",{className:"text-muted-foreground",children:"/"})]}),s.jsx(N,{ref:O,value:A,onChange:e=>P(e.target.value),onKeyDown:ce,onBlur:ie,className:"font-bold text-sm sm:text-lg border-none shadow-none focus-visible:ring-0 px-1 h-7 sm:h-auto py-0 flex-1"}),s.jsx(f,{variant:"ghost",size:"icon",className:"h-6 w-6 sm:h-7 sm:w-7 shrink-0",onClick:ie,children:s.jsx(J,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})}),s.jsx(f,{variant:"ghost",size:"icon",className:"h-6 w-6 sm:h-7 sm:w-7 shrink-0",onClick:Y,children:s.jsx(oe,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})})]}):s.jsxs("div",{className:"flex items-center gap-1 min-w-0 flex-1",children:[s.jsxs("div",{className:"flex items-center gap-1 min-w-0 text-sm sm:text-lg "+(h?"":"cursor-pointer hover:bg-muted/50 rounded px-1 py-0.5 -mx-1 -my-0.5 transition-colors"),onClick:W,children:[he&&s.jsxs("div",{className:"hidden sm:flex items-center gap-2 shrink-0",children:[s.jsx(re,{className:"h-4 w-4 text-muted-foreground"}),s.jsx("span",{className:"text-muted-foreground truncate max-w-37.5",children:he}),s.jsx("span",{className:"text-muted-foreground",children:"/"})]}),s.jsx("span",{className:"font-bold truncate",children:xe})]}),!h&&s.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground shrink-0",children:[void 0!==(null==z?void 0:z.version)&&z.version>0&&s.jsx(we,{content:u("ui.history.title"),side:"bottom",delay:200,children:s.jsxs("span",{className:"flex items-center gap-0.5 px-1 py-0.5 rounded bg-muted/50 text-muted-foreground hover:bg-muted cursor-default",children:[s.jsx(_,{className:"h-3 w-3"}),s.jsxs("span",{children:["v",z.version]})]})}),H?s.jsxs(s.Fragment,{children:[s.jsx(le,{className:"h-3 w-3 sm:h-3.5 sm:w-3.5 animate-pulse"}),s.jsx("span",{className:"hidden sm:inline",children:u("ui.common.saving")})]}):D?s.jsxs(s.Fragment,{children:[s.jsx(le,{className:"h-3 w-3 sm:h-3.5 sm:w-3.5 text-green-500"}),s.jsx("span",{children:a(D,"HH:mm:ss")})]}):(null==z?void 0:z.mtime)?s.jsxs(s.Fragment,{children:[s.jsx(le,{className:"h-3 w-3 sm:h-3.5 sm:w-3.5 text-muted-foreground/50"}),s.jsx("span",{className:"hidden xs:inline",children:a(new Date(z.mtime),"MM-dd HH:mm")})]}):null]})]})]}),s.jsxs("div",{className:"flex items-center gap-0.5 sm:gap-2 shrink-0",children:[r&&s.jsx(we,{content:u("ui.common.refresh"),side:"bottom",delay:200,children:s.jsx(f,{onClick:K,variant:"outline",size:"icon",className:"rounded-lg sm:rounded-xl h-7 w-7 sm:h-10 sm:w-10",children:s.jsx(ee,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 "+(S?"animate-spin":"")})})}),r&&s.jsx(we,{content:u(V?"ui.note.editNote":"ui.note.viewNote"),side:"bottom",delay:200,children:s.jsx(f,{onClick:()=>F(!V),variant:"outline",size:"icon",className:"rounded-lg sm:rounded-xl h-7 w-7 sm:h-10 sm:w-10",children:V?s.jsx(se,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"}):s.jsx(te,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})})}),r&&i&&s.jsx(we,{content:u("ui.history.title"),side:"bottom",delay:200,children:s.jsx(f,{onClick:i,variant:"outline",size:"icon",className:"rounded-lg sm:rounded-xl h-7 w-7 sm:h-10 sm:w-10",children:s.jsx(_,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})})}),s.jsx(we,{content:u(I?"ui.note.exitFullscreen":"ui.note.fullscreen"),side:"bottom",delay:200,children:s.jsx(f,{onClick:Z,variant:"outline",size:"icon",className:"rounded-lg sm:rounded-xl h-7 w-7 sm:h-10 sm:w-10",children:I?s.jsx(ae,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"}):s.jsx(ne,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})})})]})]}),s.jsx("div",{className:"flex-1 min-h-0",children:S?s.jsx("div",{className:"flex items-center justify-center h-full rounded-xl border border-border bg-card",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-primary border-t-transparent"})}):s.jsx("div",{className:"h-full overflow-visible rounded-xl border border-border bg-card",children:s.jsx(e.Suspense,{fallback:s.jsx(_e,{}),children:s.jsx(Fe,{ref:j,value:k,onChange:Q,readOnly:h||V,placeholder:u("ui.note.noteContentPlaceholder"),vault:n,fileLinks:null==z?void 0:z.fileLinks,initialMode:V?"preview":"sv"},`${null==r?void 0:r.id}-${V}`)})})})]});var ue}function Be({vault:r,vaults:o,onVaultChange:l,onSelectNote:i,onCreateNote:c,page:d,setPage:m,pageSize:h,setPageSize:x,onViewHistory:u,isRecycle:p=!1,searchKeyword:g,setSearchKeyword:j}){const{t:S}=t(),{handleNoteList:R,handleDeleteNote:H,handleRestoreNote:$,handleFolderList:z,handleFolderNotes:E}=De(),{openConfirmDialog:M}=w(),[T,A]=e.useState([]),[P,D]=e.useState(!1),[L,I]=e.useState(0),[U,V]=e.useState(g),[J,Z]=e.useState("path"),[q,Q]=e.useState(null),[W,Y]=e.useState("mtime"),[X,ee]=e.useState("desc"),[ae,ne]=e.useState(new Set),[le,Ne]=e.useState("folder"),[Se,Re]=e.useState(""),[He,$e]=e.useState(""),[ze,Ee]=e.useState([]),{trashType:Me,setModule:Te}=v();e.useEffect(()=>{const e=setTimeout(()=>{V(g)},500);return()=>clearTimeout(e)},[g]),e.useEffect(()=>{if("regex"===J&&g)try{new RegExp(g),Q(null)}catch{Q(S("ui.note.invalidRegex"))}else Q(null)},[g,J,S]);const Ae=(e=d,s=h,t=U)=>{"regex"===J&&q||(D(!0),"folder"!==le||p?R(r,e,s,t,p,J,!1,W,X,e=>{var s;let a=(null==e?void 0:e.list)||[];if("regex"===J&&t&&a.length>0)try{const e=new RegExp(t,"i");a=a.filter(s=>e.test(s.path))}catch{}A(a),I((null==(s=null==e?void 0:e.pager)?void 0:s.totalRows)||0),D(!1)}):z(r,Se,He,t=>{Ee(t||[]),E(r,Se,He,e,s,W,X,e=>{var s;A((null==e?void 0:e.list)||[]),I((null==(s=null==e?void 0:e.pager)?void 0:s.totalRows)||0),D(!1)})}))};e.useEffect(()=>{Ae(d,h,U),ne(new Set)},[r,d,h,U,p,J,W,X,le,Se]),e.useEffect(()=>{U&&Ne("flat")},[U,Se,le,m]);const Pe=e=>{e>=1&&e<=Math.ceil(L/h)&&m(e)},Le=Math.ceil(L/h);return s.jsxs("div",{className:"w-full flex flex-col space-y-4",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 py-1",children:[s.jsx("div",{className:"flex items-center gap-3",children:o&&l&&s.jsxs(ve,{value:r,onValueChange:l,children:[s.jsx(be,{className:"w-auto min-w-45 rounded-xl",children:s.jsx(ye,{placeholder:"Select Vault"})}),s.jsx(ke,{className:"rounded-xl",children:o.map(e=>s.jsx(Ce,{value:e.vault,className:"rounded-xl",children:e.vault},e.id))})]})}),s.jsxs("div",{className:"flex flex-col gap-2 w-full sm:w-auto",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:"relative flex-1 sm:w-64 group",children:[s.jsx(ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none"}),s.jsx(N,{type:"text",placeholder:S("ui.note.searchPlaceholder"),className:"pl-9 pr-14 rounded-xl "+(q?"border-destructive":""),value:g,onChange:e=>j(e.target.value)}),s.jsxs("div",{className:"absolute right-1 top-1/2 -translate-y-1/2 flex items-center gap-0.5",children:[g&&s.jsx("button",{className:"p-1.5 text-muted-foreground hover:text-foreground transition-colors",onClick:()=>j(""),children:s.jsx(oe,{className:"h-4 w-4"})}),s.jsxs(b,{children:[s.jsx(y,{asChild:!0,children:s.jsxs("button",{className:"flex items-center gap-1 px-1.5 py-1 text-xs font-medium text-muted-foreground hover:text-foreground hover:bg-muted/80 rounded-lg transition-colors",children:["path"===J&&s.jsx(ce,{className:"h-3.5 w-3.5"}),"content"===J&&s.jsx(G,{className:"h-3.5 w-3.5"}),"regex"===J&&s.jsx(de,{className:"h-3.5 w-3.5"}),s.jsx(me,{className:"h-3 w-3"})]})}),s.jsxs(k,{align:"end",className:"rounded-xl min-w-32",children:[s.jsx(C,{onClick:()=>Z("path"),className:"rounded-lg flex items-center justify-between "+("path"===J?"bg-accent":""),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ce,{className:"h-4 w-4"}),s.jsx("span",{children:S("ui.note.searchPath")})]})}),s.jsx(C,{onClick:()=>Z("content"),className:"rounded-lg flex items-center justify-between "+("content"===J?"bg-accent":""),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(G,{className:"h-4 w-4"}),s.jsx("span",{children:S("ui.note.searchContentMode")})]})}),s.jsx(C,{onClick:()=>Z("regex"),className:"rounded-lg flex items-center justify-between "+("regex"===J?"bg-accent":""),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(de,{className:"h-4 w-4"}),s.jsx("span",{children:S("ui.note.searchRegex")})]})})]})]})]})]}),s.jsx(f,{variant:"outline",size:"icon",onClick:()=>Ae(),disabled:P,className:"rounded-xl shrink-0",children:s.jsx(he,{className:"h-4 w-4 "+(P?"animate-spin":"")})}),!p&&s.jsxs(f,{onClick:c,className:"rounded-xl shrink-0",children:[s.jsx(xe,{className:"h-4 w-4 sm:mr-2"}),s.jsx("span",{className:"hidden sm:inline",children:S("ui.note.newNote")})]})]}),q&&s.jsx("div",{className:"flex items-center gap-2 px-1",children:s.jsx("span",{className:"text-xs text-destructive",children:q})})]})]}),!p&&s.jsxs("div",{className:"flex flex-wrap items-center gap-4 py-2 px-2 bg-muted/30 rounded-xl border border-border/50",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("div",{className:"flex items-center h-8 rounded-lg border border-border overflow-hidden bg-background shadow-sm",children:[s.jsx("button",{className:"px-4 h-full text-xs font-medium transition-colors "+("folder"===le?"bg-primary text-primary-foreground":"hover:bg-muted"),onClick:()=>{j(""),V(""),Ne("folder")},children:S("ui.note.viewFolder")}),s.jsx("button",{className:"px-4 h-full text-xs font-medium transition-colors border-l border-border "+("flat"===le?"bg-primary text-primary-foreground":"hover:bg-muted"),onClick:()=>Ne("flat"),children:S("ui.note.viewFlat")})]}),s.jsxs("span",{className:"text-sm font-medium text-muted-foreground mr-2",children:[L," ",S("ui.note.note")]})]}),s.jsxs("div",{className:"flex items-center h-8 rounded-xl border border-border overflow-hidden bg-background shadow-sm ml-auto",children:[s.jsxs("button",{className:"px-3 h-full text-xs flex items-center gap-1.5 transition-colors "+("mtime"===W?"bg-accent text-accent-foreground":"hover:bg-muted"),onClick:()=>Y("mtime"),children:[s.jsx(ue,{className:"h-3.5 w-3.5"}),S("ui.note.sortByMtime")]}),s.jsxs("button",{className:"px-3 h-full text-xs flex items-center gap-1.5 transition-colors border-l border-border "+("ctime"===W?"bg-accent text-accent-foreground":"hover:bg-muted"),onClick:()=>Y("ctime"),children:[s.jsx(pe,{className:"h-3.5 w-3.5"}),S("ui.note.sortByCtime")]}),s.jsxs("button",{className:"px-3 h-full text-xs flex items-center gap-1.5 transition-colors border-l border-border "+("path"===W?"bg-accent text-accent-foreground":"hover:bg-muted"),onClick:()=>Y("path"),children:[s.jsx(G,{className:"h-3.5 w-3.5"}),S("ui.note.sortByPath")]}),s.jsx(we,{content:S("desc"===X?"ui.note.sortDesc":"ui.note.sortAsc"),side:"top",delay:200,children:s.jsx("button",{className:"px-2.5 h-full text-xs flex items-center transition-colors border-l border-border hover:bg-muted",onClick:()=>ee("desc"===X?"asc":"desc"),children:"desc"===X?s.jsx(fe,{className:"h-3.5 w-3.5"}):s.jsx(ge,{className:"h-3.5 w-3.5"})})})]})]}),p&&s.jsxs("div",{className:"flex flex-wrap items-center gap-4 py-2 px-2 bg-muted/30 rounded-xl border border-border/50",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("div",{className:"flex items-center h-8 rounded-lg border border-border overflow-hidden bg-background shadow-sm",children:[s.jsx("button",{className:"px-4 h-full text-xs font-medium transition-colors "+("notes"===Me?"bg-primary text-primary-foreground":"hover:bg-muted"),onClick:()=>Te("trash","notes"),children:S("ui.note.note")}),s.jsx("button",{className:"px-4 h-full text-xs font-medium transition-colors border-l border-border "+("files"===Me?"bg-primary text-primary-foreground":"hover:bg-muted"),onClick:()=>Te("trash","files"),children:S("ui.file.file")})]}),s.jsxs("span",{className:"text-sm font-medium text-muted-foreground mr-2",children:[L," ",S("ui.nav.menuTrash"),S("ui.note.note")]})]}),T.length>0&&s.jsxs("div",{className:"flex items-center gap-3 pl-4 border-l border-border/60",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(F,{id:"select-all",checked:ae.size===T.length&&T.length>0,onCheckedChange:()=>{ae.size===T.length&&T.length>0?ne(new Set):ne(new Set(T.map(e=>e.pathHash)))},className:"rounded-md"}),s.jsx("label",{htmlFor:"select-all",className:"text-xs font-medium cursor-pointer text-muted-foreground hover:text-foreground transition-colors",children:S("ui.common.selectAll")})]}),ae.size>0&&s.jsxs("div",{className:"flex items-center gap-3 animate-in fade-in slide-in-from-left-2 duration-200",children:[s.jsx("span",{className:"text-xs text-primary font-semibold bg-primary/10 px-2 py-0.5 rounded-full",children:S("ui.file.selectedCount",{count:ae.size})}),s.jsxs(f,{variant:"outline",size:"sm",onClick:()=>{0!==ae.size&&M(S("ui.file.batchRestoreConfirm",{count:ae.size}),"confirm",async()=>{D(!0);const e=T.filter(e=>ae.has(e.pathHash));for(const s of e)await new Promise(e=>{$(r,s.path,s.pathHash,()=>{e()})});ne(new Set),Ae()})},className:"h-8 rounded-lg text-green-600 border-green-200 hover:bg-green-50 hover:text-green-700 hover:border-green-300 shadow-sm",children:[s.jsx(K,{className:"h-3.5 w-3.5 mr-1.5"}),S("ui.file.batchRestore")]})]})]}),s.jsxs("div",{className:"flex items-center h-8 rounded-xl border border-border overflow-hidden bg-background shadow-sm ml-auto",children:[s.jsxs("button",{className:"px-3 h-full text-xs flex items-center gap-1.5 transition-colors "+("mtime"===W?"bg-accent text-accent-foreground":"hover:bg-muted"),onClick:()=>Y("mtime"),children:[s.jsx(ue,{className:"h-3.5 w-3.5"}),S("ui.note.sortByMtime")]}),s.jsxs("button",{className:"px-3 h-full text-xs flex items-center gap-1.5 transition-colors border-l border-border "+("ctime"===W?"bg-accent text-accent-foreground":"hover:bg-muted"),onClick:()=>Y("ctime"),children:[s.jsx(pe,{className:"h-3.5 w-3.5"}),S("ui.note.sortByCtime")]}),s.jsxs("button",{className:"px-3 h-full text-xs flex items-center gap-1.5 transition-colors border-l border-border "+("path"===W?"bg-accent text-accent-foreground":"hover:bg-muted"),onClick:()=>Y("path"),children:[s.jsx(G,{className:"h-3.5 w-3.5"}),S("ui.note.sortByPath")]}),s.jsx(we,{content:S("desc"===X?"ui.note.sortDesc":"ui.note.sortAsc"),side:"top",delay:200,children:s.jsx("button",{className:"px-2.5 h-full text-xs flex items-center transition-colors border-l border-border hover:bg-muted",onClick:()=>ee("desc"===X?"asc":"desc"),children:"desc"===X?s.jsx(fe,{className:"h-3.5 w-3.5"}):s.jsx(ge,{className:"h-3.5 w-3.5"})})})]})]}),"folder"===le&&!p&&Se&&s.jsxs("div",{className:"flex items-center gap-2 px-1 text-sm text-muted-foreground overflow-x-auto whitespace-nowrap scrollbar-hide",children:[s.jsx("button",{className:"hover:text-primary transition-colors flex items-center",onClick:()=>{Re(""),$e(""),m(1)},children:r}),Se.split("/").filter(Boolean).map((e,t,a)=>s.jsxs(n.Fragment,{children:[s.jsx(B,{className:"h-4 w-4 shrink-0"}),s.jsx("button",{className:"transition-colors "+(t===a.length-1?"text-foreground font-medium pointer-events-none":"hover:text-primary"),onClick:()=>{const e=a.slice(0,t+1).join("/");Re(e),$e(""),m(1)},children:e})]},`breadcrumb-${t}`))]}),P?s.jsxs("div",{className:"rounded-xl border border-border bg-card p-12 text-center text-muted-foreground",children:[s.jsx(he,{className:"h-6 w-6 animate-spin mx-auto mb-2"}),S("ui.common.loading")]}):Array.isArray(T)&&0!==T.length||Array.isArray(ze)&&0!==ze.length&&"flat"!==le?s.jsx("div",{className:"-mx-2 px-2",children:s.jsxs("div",{className:"grid grid-cols-1 gap-3 py-1",children:["folder"===le&&!p&&ze.map(e=>s.jsx("article",{className:"rounded-xl border border-border bg-card p-4 cursor-pointer transition-all duration-200 hover:shadow-md hover:border-primary/30",onClick:()=>{Re(e.path),$e(e.pathHash),m(1)},children:s.jsxs("div",{className:"flex items-center justify-between gap-4",children:[s.jsxs("div",{className:"flex items-start gap-3 min-w-0 flex-1",children:[s.jsx("span",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-blue-500/10 text-blue-500 shrink-0",children:s.jsx(re,{className:"h-5 w-5 fill-current opacity-70"})}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("h3",{className:"font-semibold text-card-foreground truncate",children:e.path.split("/").pop()}),s.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 mt-1.5 text-xs text-muted-foreground",children:[s.jsx(we,{content:S("ui.common.createdAt"),side:"top",delay:300,children:s.jsxs("span",{className:"hidden sm:flex items-center gap-1",children:[s.jsx(pe,{className:"h-3.5 w-3.5"}),a(new Date(e.ctime),"yyyy-MM-dd HH:mm")]})}),s.jsx(we,{content:S("ui.common.updatedAt"),side:"top",delay:300,children:s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(ue,{className:"h-3.5 w-3.5"}),a(new Date(e.mtime),"yyyy-MM-dd HH:mm")]})})]})]})]}),s.jsx("div",{className:"shrink-0",children:s.jsx(B,{className:"h-5 w-5 text-muted-foreground"})})]})},`folder-${e.pathHash}`)),Array.isArray(T)&&T.map(e=>{var t;return s.jsx("article",{className:"rounded-xl border border-border bg-card p-4 cursor-pointer transition-all duration-200 hover:shadow-md hover:border-primary/30",onClick:()=>i(e,!0),children:s.jsxs("div",{className:"flex items-center justify-between gap-4",children:[s.jsxs("div",{className:"flex items-start gap-3 min-w-0 flex-1",children:[p&&s.jsx("div",{className:"flex items-center self-center",onClick:s=>((e,s)=>{e.stopPropagation();const t=new Set(ae);t.has(s)?t.delete(s):t.add(s),ne(t)})(s,e.pathHash),children:s.jsx(F,{checked:ae.has(e.pathHash),className:"rounded-md"})}),s.jsx("span",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-primary/10 text-primary shrink-0",children:s.jsx(G,{className:"h-5 w-5"})}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("h3",{className:"font-semibold text-card-foreground truncate",children:null==(t="folder"!==le||p?e.path:e.path.split("/").pop())?void 0:t.replace(/\.md$/,"")}),s.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 mt-1.5 text-xs text-muted-foreground",children:[s.jsx(we,{content:S("ui.common.createdAt"),side:"top",delay:300,children:s.jsxs("span",{className:"hidden sm:flex items-center gap-1",children:[s.jsx(pe,{className:"h-3.5 w-3.5"}),a(new Date(e.ctime),"yyyy-MM-dd HH:mm")]})}),s.jsx(we,{content:S("ui.common.updatedAt"),side:"top",delay:300,children:s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(ue,{className:"h-3.5 w-3.5"}),a(new Date(e.mtime),"yyyy-MM-dd HH:mm")]})}),e.version>0&&s.jsx(we,{content:S("ui.history.title"),side:"top",delay:300,children:s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(_,{className:"h-3.5 w-3.5"}),"v",e.version]})})]})]})]}),s.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[s.jsx(we,{content:S("ui.note.viewNote"),side:"top",delay:200,children:s.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-xl text-muted-foreground hover:text-primary",onClick:s=>{s.stopPropagation(),i(e,!0)},children:s.jsx(te,{className:"h-4 w-4"})})}),s.jsx(we,{content:S("ui.note.editNote"),side:"top",delay:200,children:s.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-xl text-muted-foreground hover:text-blue-600",onClick:s=>{s.stopPropagation(),i(e,!1)},children:s.jsx(se,{className:"h-4 w-4"})})}),s.jsx(we,{content:S("ui.history.title"),side:"top",delay:200,children:s.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-xl text-muted-foreground hover:text-purple-600",onClick:s=>{s.stopPropagation(),u(e)},children:s.jsx(_,{className:"h-4 w-4"})})}),!p&&s.jsx(we,{content:S("ui.common.delete"),side:"top",delay:200,children:s.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-xl text-muted-foreground hover:text-destructive",onClick:s=>((e,s)=>{e.stopPropagation();const t=s.path.replace(/\.md$/,"");M(S("ui.note.deleteNoteConfirm",{title:t}),"confirm",()=>{H(r,s.path,s.pathHash,()=>{Ae()})})})(s,e),children:s.jsx(je,{className:"h-4 w-4"})})}),p&&s.jsx(we,{content:S("ui.common.restore"),side:"top",delay:200,children:s.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-xl text-muted-foreground hover:text-green-600",onClick:s=>((e,s)=>{e.stopPropagation();const t=s.path.replace(/\.md$/,"");M(S("ui.note.restoreNoteConfirm",{title:t}),"confirm",()=>{$(r,s.path,s.pathHash,()=>{Ae()})})})(s,e),children:s.jsx(K,{className:"h-4 w-4"})})})]})]})},`note-${e.pathHash}`)})]})}):s.jsx("div",{className:"rounded-xl border border-border bg-card p-12 text-center text-muted-foreground",children:S("ui.note.noNotes")}),T.length>0&&s.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center sm:justify-between gap-4 pt-2 shrink-0",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[s.jsxs("span",{children:[S("ui.common.of")," ",L," ",S("ui.note.results")]}),s.jsxs(ve,{value:h.toString(),onValueChange:e=>{const s=parseInt(e);x(s),m(1)},children:[s.jsx(be,{className:"h-8 w-25 rounded-xl",children:s.jsx(ye,{placeholder:h.toString()})}),s.jsx(ke,{className:"rounded-xl",children:[10,20,50,100].map(e=>s.jsxs(Ce,{value:e.toString(),className:"rounded-xl",children:[e," ",S("ui.common.perPage")]},e))})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(f,{variant:"outline",size:"sm",onClick:()=>Pe(d-1),disabled:1===d||P,className:"rounded-xl",children:[s.jsx(O,{className:"h-4 w-4"}),S("ui.common.previous")]}),s.jsxs("span",{className:"text-sm font-medium px-2",children:[d," / ",Le]}),s.jsxs(f,{variant:"outline",size:"sm",onClick:()=>Pe(d+1),disabled:d===Le||P,className:"rounded-xl",children:[S("ui.common.next"),s.jsx(B,{className:"h-4 w-4"})]})]})]})]})}function Ge({vault:a,onVaultChange:n,onNavigateToVaults:r,isMaximized:o=!1,onToggleMaximize:l,isRecycle:i=!1}){const{t:c}=t(),[d,m]=e.useState("list"),[h,x]=e.useState(void 0),[u,p]=e.useState(!1),[g,j]=e.useState([]),[N,w]=e.useState(!1),[v,b]=e.useState(null),y=e.useRef(!1),[k,C]=e.useState(1),[R,H]=e.useState(()=>{const e=localStorage.getItem("notePageSize");return e?parseInt(e,10):10}),[$,z]=e.useState("");e.useEffect(()=>{localStorage.setItem("notePageSize",R.toString())},[R]);const{handleVaultList:E}=S();e.useEffect(()=>{E(e=>{j(e),y.current=!0})},[E]),e.useEffect(()=>{C(1)},[a]);const M=(e,s=!1)=>{x(e),p(s),m("editor")},T=()=>{x(void 0),p(!1),m("editor")},A=()=>{m("list"),x(void 0)},P=(e,s)=>{h||x({id:Date.now(),path:e,pathHash:s,mtime:Date.now(),ctime:Date.now(),version:0})},D=e=>{b(e),w(!0)};if(y.current&&0===g.length)return s.jsxs("div",{className:"rounded-xl border border-border bg-card p-12 flex flex-col items-center justify-center",children:[s.jsx(Ne,{className:"h-16 w-16 text-muted-foreground/30 mb-4"}),s.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:c("ui.note.noVaults")}),s.jsx("p",{className:"text-muted-foreground mb-6 text-center",children:c("ui.note.createVaultFirst")}),s.jsx(f,{onClick:()=>{r&&r()},className:"rounded-xl",children:c("ui.note.goToVaultManagement")})]});let L;return L="editor"===d?s.jsx(Oe,{vault:a,note:h,onBack:A,onSaveSuccess:P,onViewHistory:()=>h&&D(h),isMaximized:o,onToggleMaximize:l,isRecycle:i,initialPreviewMode:u}):s.jsx(Be,{vault:a,vaults:g,onVaultChange:n,onSelectNote:M,onCreateNote:T,page:k,setPage:C,pageSize:R,setPageSize:H,searchKeyword:$,setSearchKeyword:z,onViewHistory:D,isRecycle:i}),s.jsxs(s.Fragment,{children:[L,v&&s.jsx(Ue,{isOpen:N,onClose:()=>{w(!1),b(null)},vault:a,notePath:v.path,pathHash:v.pathHash,isRecycle:i,onRestoreSuccess:()=>{h&&v&&h.pathHash===v.pathHash&&x({...h,version:(h.version||0)+1})}})]})}export{Ge as NoteManager};
