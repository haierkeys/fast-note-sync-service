import{w as e,r as t,j as s}from"./vendor-CePkgVYi.js";import{u as a,a as r,D as o,c as n,S as i,r as l,b as d,s as c,K as u,T as m,P as x,d as h,C as g}from"./vendor-dnd-BnJl5flH.js";import{o as p,u as f,t as v,e as j,I as N,B as w,D as b,d as y,f as C,h as k}from"./index-BEFD5UPy.js";import{T as S}from"./tooltip-BULUqi89.js";import{V as E,X as I,_ as z,$ as T,D as A,j as D,m as P,E as R,at as B,a0 as F,z as V,a4 as $}from"./vendor-icons-JH9TotLT.js";import"./vendor-ui-BwPMR9gB.js";import"./vendor-lottie-Cgk9p7OH.js";import"./vendor-animation-Cs3gejBo.js";function O({vault:e,editingId:t,editingName:a,setEditingName:r,startEdit:o,saveEdit:n,cancelEdit:i,handleDelete:l,onViewConfig:d,onNavigateToNotes:c,onNavigateToAttachments:u,formatBytes:m,t:x}){const{attributes:p,listeners:f,setNodeRef:v,transform:j,transition:b,isDragging:y}=h({id:e.id}),C={transform:g.Transform.toString(j),transition:b,opacity:y?.5:1};return s.jsxs("article",{ref:v,style:C,className:"relative flex flex-col gap-4 rounded-xl border border-border bg-card p-5 transition-all duration-200 hover:shadow-md hover:border-primary/30 cursor-pointer",onClick:()=>t!==e.id&&c&&c(e.vault),children:[s.jsxs("header",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-primary/10 text-primary shrink-0",children:s.jsx(A,{className:"h-5 w-5"})}),t===e.id?s.jsx("div",{className:"flex items-center gap-2 flex-1",onClick:e=>e.stopPropagation(),children:s.jsx(N,{value:a,onChange:e=>r(e.target.value),className:"flex-1 rounded-xl",autoFocus:!0,onKeyDown:t=>{"Enter"===t.key&&n(e),"Escape"===t.key&&i()}})}):s.jsxs(s.Fragment,{children:[s.jsx("h3",{className:"text-lg font-bold truncate flex-1",children:e.vault}),s.jsx("button",{...p,...f,className:"p-2 rounded-xl text-muted-foreground/50 hover:text-muted-foreground hover:bg-muted/50 cursor-grab active:cursor-grabbing touch-none shrink-0",onClick:e=>e.stopPropagation(),children:s.jsx(B,{className:"h-5 w-5 md:h-4 md:w-4"})})]})]}),s.jsxs("dl",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{className:"flex flex-col rounded-lg border border-border/70 bg-background/80 p-3 hover:bg-primary/5 hover:border-primary/30 transition-colors group/stat",onClick:s=>{t!==e.id&&c&&(s.stopPropagation(),c(e.vault))},children:[s.jsx("dt",{className:"text-xs text-muted-foreground group-hover/stat:text-primary transition-colors",children:x("ui.vault.note")}),s.jsxs("dd",{className:"text-xl font-semibold flex items-center justify-between gap-1",children:[s.jsx("span",{children:e.noteCount}),void 0!==e.noteSize&&s.jsx("span",{className:"text-[10px] font-normal text-muted-foreground/50",children:m(e.noteSize)})]})]}),s.jsxs("div",{className:"flex flex-col rounded-lg border border-border/70 bg-background/80 p-3 hover:bg-primary/5 hover:border-primary/30 transition-colors group/stat",onClick:s=>{t!==e.id&&u&&(s.stopPropagation(),u(e.vault))},children:[s.jsx("dt",{className:"text-xs text-muted-foreground group-hover/stat:text-primary transition-colors",children:x("ui.vault.attachmentCount")}),s.jsxs("dd",{className:"text-xl font-semibold flex items-center justify-between gap-1",children:[s.jsx("span",{children:e.fileCount||"0"}),void 0!==e.fileSize&&s.jsx("span",{className:"text-[10px] font-normal text-muted-foreground/50",children:m(e.fileSize)})]})]})]}),s.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[s.jsx("span",{children:x("ui.vault.totalSize",{size:m(e.size)})}),s.jsxs("div",{className:"flex items-center gap-3",children:[e.createdAt&&s.jsx(S,{content:x("ui.common.createdAt"),side:"top",delay:300,children:s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(F,{className:"h-3 w-3"}),e.createdAt]})}),e.updatedAt&&s.jsx(S,{content:x("ui.common.updatedAt"),side:"top",delay:300,children:s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(z,{className:"h-3 w-3"}),e.updatedAt]})})]})]}),s.jsx("div",{className:"flex items-center justify-end gap-1 pt-2 border-t border-border",children:t===e.id?s.jsxs(s.Fragment,{children:[s.jsx(S,{content:x("ui.common.save"),side:"top",delay:200,children:s.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-xl text-green-600 hover:text-green-700 hover:bg-green-50",onClick:t=>{t.stopPropagation(),n(e)},children:s.jsx(D,{className:"h-4 w-4"})})}),s.jsx(S,{content:x("ui.common.cancel"),side:"top",delay:200,children:s.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-xl text-muted-foreground hover:text-foreground",onClick:e=>{e.stopPropagation(),i()},children:s.jsx(I,{className:"h-4 w-4"})})})]}):s.jsxs(s.Fragment,{children:[s.jsx(S,{content:x("ui.vault.authTokenConfig"),side:"top",delay:200,children:s.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-xl text-muted-foreground hover:text-purple-600",onClick:t=>d(e.vault,t),children:s.jsx(P,{className:"h-4 w-4"})})}),s.jsx(S,{content:x("ui.vault.edit"),side:"top",delay:200,children:s.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-xl text-muted-foreground hover:text-green-600",onClick:t=>o(e,t),children:s.jsx(V,{className:"h-4 w-4"})})}),s.jsx(S,{content:x("ui.vault.delete"),side:"top",delay:200,children:s.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-xl text-muted-foreground hover:text-destructive",onClick:t=>{t.stopPropagation(),l(e.id)},children:s.jsx($,{className:"h-4 w-4"})})})]})})]})}const U="vault-sort-order";function L({onNavigateToNotes:h,onNavigateToAttachments:g}){const{t:B}=e(),[F,V]=t.useState([]),[$,L]=t.useState(null),[K,J]=t.useState(""),[_,q]=t.useState(!1),[M,G]=t.useState(""),[H,Q]=t.useState(""),[W,X]=t.useState(!1),[Y,Z]=t.useState(!1),[ee,te]=t.useState(""),[se,ae]=t.useState(!1),{handleVaultList:re,handleVaultDelete:oe,handleVaultUpdate:ne}=p(),{openConfirmDialog:ie}=f(),le=a(r(x,{activationConstraint:{distance:8}}),r(m,{activationConstraint:{delay:200,tolerance:5}}),r(u,{coordinateGetter:c})),de=t.useCallback((e=!1)=>{e&&ae(!0),re(t=>{const s=localStorage.getItem(U);if(s)try{const e=JSON.parse(s),a=[...t].sort((t,s)=>{const a=e.indexOf(t.id),r=e.indexOf(s.id);return-1===a?1:-1===r?-1:a-r});V(a)}catch{V(t)}else V(t);e&&(ae(!1),v.success(B("ui.common.refreshSuccess")))})},[re,B]);t.useEffect(()=>{de()},[de]);const ce=t.useMemo(()=>{if(!H.trim())return F;const e=H.toLowerCase();return F.filter(t=>t.vault.toLowerCase().includes(e))},[F,H]),ue=async e=>{ie(B("ui.vault.confirmDelete"),"confirm",async()=>{await oe(e),V(F.filter(t=>t.id!==e))})},me=(e,t)=>{t.stopPropagation(),L(e.id),J(e.vault)},xe=e=>{K.trim()?ne({...e,vault:K.trim()},()=>{L(null),de()}):v.error(B("ui.vault.nameRequired"))},he=()=>{L(null),J("")},ge=()=>{M.trim()?ne({vault:M.trim()},()=>{q(!1),G(""),de()}):v.error(B("ui.vault.nameRequired"))},pe=e=>{if(null==e||""===e)return"0 B";const t="string"==typeof e?parseInt(e):e;if(isNaN(t)||0===t)return"0 B";if(t<1024)return`${t} B`;if(t<1048576)return`${(t/1024).toFixed(2)} KB`;return`${(t/1048576).toFixed(2)} MB`},fe=(e,t)=>{t.stopPropagation(),te(e),Z(!1),X(!0)},ve=t.useCallback(e=>JSON.stringify({api:j.API_URL,apiToken:localStorage.getItem("token")||"",...e?{vault:e}:{}},null,2),[]),je=t.useCallback(e=>{const t=j.API_URL,s=localStorage.getItem("token")||"",a=e||ee;return`obsidian://fast-note-sync/sso?pushApi=${encodeURIComponent(t)}&pushApiToken=${encodeURIComponent(s)}&pushVault=${encodeURIComponent(a)}`},[ee]);return s.jsxs("div",{className:"w-full space-y-4",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 py-1",children:[s.jsx("div",{className:"flex items-center gap-3",children:s.jsxs("span",{className:"text-sm text-muted-foreground",children:[B("ui.vault.count",{count:ce.length}),H&&F.length!==ce.length&&s.jsxs("span",{className:"ml-1",children:["/ ",B("ui.vault.count",{count:F.length})]})]})}),s.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[s.jsxs("div",{className:"relative flex-1 sm:w-64",children:[s.jsx(E,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),s.jsx(N,{type:"text",placeholder:B("ui.vault.searchPlaceholder"),className:"pl-9 pr-8 rounded-xl",value:H,onChange:e=>Q(e.target.value)}),H&&s.jsx("button",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",onClick:()=>Q(""),children:s.jsx(I,{className:"h-4 w-4"})})]}),s.jsx(S,{content:B("ui.common.refresh"),side:"bottom",delay:200,children:s.jsx(w,{variant:"outline",size:"icon",onClick:()=>de(!0),className:"h-9 w-9 rounded-xl shrink-0",disabled:se,children:s.jsx(z,{className:"h-4 w-4 "+(se?"animate-spin":"")})})}),s.jsxs(w,{onClick:()=>q(!0),className:"rounded-xl shrink-0",disabled:_,children:[s.jsx(T,{className:"h-4 w-4 sm:mr-2"}),s.jsx("span",{className:"hidden sm:inline",children:B("ui.vault.add")})]})]})]}),_&&s.jsx("div",{className:"rounded-xl border border-primary bg-card p-5",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-primary/10 text-primary shrink-0",children:s.jsx(A,{className:"h-5 w-5"})}),s.jsx(N,{value:M,onChange:e=>G(e.target.value),placeholder:B("ui.vault.name"),className:"flex-1 rounded-xl",autoFocus:!0,onKeyDown:e=>{"Enter"===e.key&&ge(),"Escape"===e.key&&(q(!1),G(""))}}),s.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-xl text-green-600 hover:text-green-700 hover:bg-green-50",onClick:ge,children:s.jsx(D,{className:"h-4 w-4"})}),s.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-xl text-muted-foreground hover:text-foreground",onClick:()=>{q(!1),G("")},children:s.jsx(I,{className:"h-4 w-4"})})]})}),0!==ce.length||_?s.jsx(o,{sensors:le,collisionDetection:n,onDragEnd:e=>{const{active:t,over:s}=e;s&&t.id!==s.id&&V(e=>{const a=e.findIndex(e=>e.id===t.id),r=e.findIndex(e=>e.id===s.id),o=d(e,a,r),n=o.map(e=>e.id);return localStorage.setItem(U,JSON.stringify(n)),o})},children:s.jsx(i,{items:ce.map(e=>e.id),strategy:l,children:s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-1",children:ce.map(e=>s.jsx(O,{vault:e,editingId:$,editingName:K,setEditingName:J,startEdit:me,saveEdit:xe,cancelEdit:he,handleDelete:ue,onViewConfig:fe,onNavigateToNotes:h,onNavigateToAttachments:g,formatBytes:pe,t:B},e.id))})})}):s.jsxs("div",{className:"rounded-xl border border-border bg-card p-12 text-center space-y-4",children:[s.jsx("p",{className:"text-muted-foreground",children:B(H?"ui.common.noSearchResults":"ui.vault.noVaults")}),!H&&s.jsx("div",{className:"flex flex-col items-center gap-4",children:s.jsxs(w,{variant:"outline",className:"w-full sm:w-auto rounded-xl bg-sky-700 hover:bg-sky-900 text-white hover:text-white transition-colors border-none shadow-sm",onClick:e=>fe("",e),children:[s.jsx(P,{className:"h-4 w-4 mr-2"}),B("ui.vault.oneClickImport")]})})]}),s.jsx(b,{open:W,onOpenChange:X,children:s.jsxs(y,{className:"w-[calc(100vw-2rem)] max-w-2xl mx-auto rounded-lg sm:rounded-xl",children:[s.jsx(C,{children:s.jsxs(k,{className:"text-base sm:text-lg truncate pr-8",children:[B(Y?"ui.vault.copyConfigError":"ui.vault.authTokenConfig"),ee&&` - ${ee}`]})}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("pre",{className:"p-3 sm:p-4 rounded-xl bg-muted text-xs sm:text-sm overflow-x-auto max-h-48 sm:max-h-64 font-mono whitespace-pre-wrap break-all",children:ve(ee)}),s.jsxs("div",{className:"flex flex-col-reverse sm:flex-row justify-end gap-2 text-nowrap",children:[s.jsx(w,{variant:"outline",onClick:()=>X(!1),className:"w-full sm:w-auto rounded-xl",children:B("ui.common.close")}),s.jsxs(w,{className:"w-full sm:w-auto rounded-xl bg-sky-700 hover:bg-sky-900 text-white transition-colors border-none shadow-sm",onClick:()=>{window.location.href=je()},children:[s.jsx(R,{className:"h-4 w-4 mr-2"}),B("ui.vault.oneClickImport")]}),s.jsxs(w,{onClick:()=>{const e=ve(ee);navigator.clipboard?navigator.clipboard.writeText(e).then(()=>{v.success(B("ui.vault.copyConfigSuccess"))}).catch(e=>{v.error(B("ui.common.error")+e)}):v.error(B("ui.vault.copyConfigError"))},className:"w-full sm:w-auto rounded-xl",children:[s.jsx(P,{className:"h-4 w-4 mr-2"}),B("ui.common.copy")]})]})]})]})})]})}export{L as VaultList};
