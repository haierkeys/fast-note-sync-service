import{r as e,w as s,j as t}from"./vendor-CePkgVYi.js";import{a as r,e as a,g as n,j as o,B as i,t as l,k as d,l as c,m,p as u,q as x,n as h,I as p,L as g}from"./index-DHyPd5JQ.js";import{C as f}from"./checkbox-Di5UuRS9.js";import{I as j,aa as N,ab as v,_ as y,ac as b,b as w,E as k,L as S,ad as T,ae as C,af as I,ag as L,ah as _,a2 as D,ai as E,aj as M,ak as U,al as A,C as F,am as P,an as V,S as K,ao as R,l as $,a0 as B,ap as z,aq as H,ar as G,a4 as O,as as Z}from"./vendor-icons-JH9TotLT.js";import{T as q}from"./tooltip-COlAQA9V.js";import"./vendor-ui-BwPMR9gB.js";import"./vendor-lottie-Cgk9p7OH.js";import"./vendor-animation-Cs3gejBo.js";function W({showUpgrade:d=!0}){const{t:c}=s(),{versionInfo:m,isLoading:u}=function(){const{t:t}=s(),{setVersionInfo:i}=o(),[l,d]=e.useState(null),[c,m]=e.useState(!1),[u,x]=e.useState(null);return e.useEffect(()=>{(async()=>{m(!0),x(null);try{const e=await fetch(r(a.API_URL+"/api/version"),{method:"GET",headers:{"Content-Type":"application/json",Domain:window.location.origin,Lang:n()}});if(!e.ok)throw new Error("Network response was not ok");const s=await e.json();s.code<100&&s.code>0&&s.data?(d(s.data),i(s.data)):x(s.message||t("getVersionError"))}catch(e){x(t("getVersionError"))}finally{m(!1)}})()},[i,t]),{versionInfo:l,isLoading:c,error:u}}(),{checkUpdate:x,isChecking:h,updateResult:p}=function(){const[s,t]=e.useState(!1),[o,i]=e.useState(null),[l,d]=e.useState(null);return{checkUpdate:e.useCallback(async e=>{if(!e)return i("Current version is unknown"),null;t(!0),i(null);try{const e=await fetch(r(a.API_URL+"/api/version"),{headers:{"Content-Type":"application/json",Domain:window.location.origin,Lang:n()}});if(!e.ok)throw new Error(`GitHub API error: ${e.status}`);const s=await e.json();if(s.code>=100||s.code<=0||!s.data)throw new Error(s.message||"Failed to get version info");const t=s.data,o={hasUpdate:t.versionIsNew||!1,latestVersion:(t.versionIsNew?t.versionNewName:t.version)||t.gitTag,releaseUrl:t.versionNewLink,releaseNotes:t.versionNewChangelog,releaseNotesContent:t.versionNewChangelogContent,publishedAt:t.buildTime};return d(o),o}catch(s){const e=s instanceof Error?s.message:"Failed to check for updates";return i(e),null}finally{t(!1)}},[]),isChecking:s,error:o,updateResult:l}}(),[g,f]=e.useState(!1);return t.jsxs("div",{className:"rounded-xl border border-border bg-card p-6 space-y-5 custom-shadow",children:[t.jsxs("h2",{className:"text-lg font-bold text-card-foreground flex items-center gap-2",children:[t.jsx(j,{className:"h-5 w-5"}),c("ui.system.versionInfo")]}),t.jsxs("div",{className:"flex items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(N,{className:"h-5 w-5 text-muted-foreground"}),t.jsx("span",{className:"text-sm font-medium",children:c("ui.system.repo")})]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[t.jsx("a",{href:"https://github.com/haierkeys/fast-note-sync-service",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline truncate max-w-[150px] sm:max-w-none",children:c("ui.system.githubRepo")}),t.jsx("span",{className:"text-muted-foreground",children:"/"}),t.jsx("a",{href:"https://cnb.cool/haierkeys/fast-note-sync-service",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline truncate max-w-[150px] sm:max-w-none",children:c("ui.system.cnbMirror")})]})]}),t.jsxs("div",{className:"flex items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(v,{className:"h-5 w-5 text-muted-foreground"}),t.jsx("span",{className:"text-sm font-medium",children:c("ui.system.currentVersion")})]}),t.jsx("div",{className:"flex items-center gap-2",children:u?t.jsx("code",{className:"text-sm font-mono text-muted-foreground",children:c("ui.common.loading")}):t.jsx(t.Fragment,{children:(null==m?void 0:m.versionNewLink)?t.jsx("a",{href:m.versionNewLink,target:"_blank",rel:"noopener noreferrer",className:"text-sm font-mono text-primary hover:underline",children:m.version}):t.jsx("code",{className:"text-sm font-mono text-muted-foreground",children:(null==m?void 0:m.version)||c("ui.common.unknown")})})})]}),t.jsx("div",{className:"border-t border-border"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(y,{className:"h-5 w-5 text-muted-foreground "+(h?"animate-spin":"")}),t.jsx("span",{className:"text-sm font-medium",children:c("ui.system.checkUpdate")})]}),t.jsx(i,{variant:"outline",size:"sm",onClick:async()=>{if(null==m?void 0:m.version){const e=await x(m.version);e&&l.success(e.hasUpdate?c("ui.system.newVersionAvailable"):c("ui.system.alreadyLatest"))}},disabled:h||u||!(null==m?void 0:m.version),className:"rounded-xl",children:c(h?"ui.system.checking":"ui.system.checkNow")})]}),p||(null==m?void 0:m.versionIsNew)?t.jsx("div",{className:"rounded-xl p-4 "+((null==p?void 0:p.hasUpdate)||(null==m?void 0:m.versionIsNew)?"bg-primary/10 border border-primary/20":"bg-muted/50"),children:t.jsxs("div",{className:"flex-1 space-y-2",children:[t.jsxs("div",{className:"flex items-start gap-3",children:[(null==p?void 0:p.hasUpdate)||(null==m?void 0:m.versionIsNew)?t.jsx(b,{className:"h-5 w-5 text-primary shrink-0 mt-0.5"}):t.jsx(w,{className:"h-5 w-5 text-green-500 shrink-0 mt-0.5"}),t.jsxs("div",{className:"flex-1 flex items-center justify-between",children:[t.jsx("span",{className:"text-sm font-medium",children:(null==p?void 0:p.hasUpdate)||(null==m?void 0:m.versionIsNew)?c("ui.system.newVersionAvailable"):c("ui.system.alreadyLatest")}),t.jsxs("div",{className:"flex items-center gap-2",children:[((null==p?void 0:p.latestVersion)||(null==m?void 0:m.versionNewName)||(null==m?void 0:m.version))&&t.jsx("code",{className:"text-xs font-mono bg-background px-2 py-0.5 rounded",children:(null==p?void 0:p.latestVersion)||(null==m?void 0:m.versionNewName)||(null==m?void 0:m.version)}),((null==p?void 0:p.hasUpdate)||(null==m?void 0:m.versionIsNew))&&((null==p?void 0:p.releaseUrl)||(null==m?void 0:m.versionNewLink))&&t.jsxs("a",{href:(null==p?void 0:p.releaseUrl)||(null==m?void 0:m.versionNewLink),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-xs text-primary hover:underline",children:[c("ui.system.viewRelease")," ",t.jsx(k,{className:"h-3 w-3"})]}),d&&((null==p?void 0:p.hasUpdate)||(null==m?void 0:m.versionIsNew))&&t.jsxs(i,{variant:"ghost",size:"sm",disabled:g,onClick:async()=>{const e=localStorage.getItem("token");if(e){f(!0);try{const s=await fetch(r(a.API_URL+"/api/admin/upgrade?version=latest"),{headers:{Authorization:`Bearer ${e}`,Lang:n()}}),t=await s.json();0===t.code||t.code<100&&t.code>0?(l.success(c("ui.system.upgradeSuccess")),setTimeout(()=>{window.location.reload()},2e3)):(l.error(t.message||c("ui.system.upgradeFailed")),f(!1))}catch{l.error(c("ui.system.upgradeFailed")),f(!1)}}},className:"h-6 px-2 text-xs text-primary hover:bg-primary/10 rounded-md gap-1 ml-1 relative group transition-all duration-300",children:[g?t.jsx(S,{className:"h-3 w-3 animate-spin"}):t.jsx(T,{className:"h-3 w-3 group-hover:scale-110 transition-transform duration-300"}),t.jsxs("span",{className:"relative",children:[c(g?"ui.system.upgrading":"ui.system.upgradeNow"),!g&&t.jsxs("span",{className:"absolute -top-1 -right-1.5 flex h-1.5 w-1.5",children:[t.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),t.jsx("span",{className:"relative inline-flex rounded-full h-1.5 w-1.5 bg-red-500 border border-background"})]})]})]})]})]})]}),t.jsx("div",{className:"space-y-2",children:((null==p?void 0:p.releaseNotesContent)||(null==m?void 0:m.versionNewChangelogContent))&&t.jsx("div",{className:"text-xs text-muted-foreground bg-background/50 p-3 rounded-lg border border-border/50 max-h-40 overflow-y-auto whitespace-pre-wrap leading-relaxed",children:(null==p?void 0:p.releaseNotesContent)||(null==m?void 0:m.versionNewChangelogContent)})})]})}):null]})]})}function J(){const{t:o}=s(),{supportList:l,isLoading:p,refresh:g}=function(){const[s,t]=e.useState([]),[o,i]=e.useState(!1),[l,d]=e.useState(null);return{supportList:s,isLoading:o,error:l,refresh:e.useCallback(async()=>{i(!0),d(null);try{const e=await fetch(r(a.API_URL+"/api/support"),{method:"GET",headers:{"Content-Type":"application/json",Lang:n()}});if(!e.ok)throw new Error("Network response was not ok");const s=await e.json();0===s.code||s.code<100&&s.code>0?t(s.data||[]):d(s.message||"Failed to get support records")}catch(e){d("Failed to get support records")}finally{i(!1)}},[])}}(),[f,j]=e.useState("amount"),[N,v]=e.useState("desc");e.useEffect(()=>{g()},[g]);const b=e.useMemo(()=>[...l].sort((e,s)=>{let t=e[f]||"",r=s[f]||"";return"amount"===f&&(t=parseFloat(String(e.amount||"0").replace(/,/g,""))||0,r=parseFloat(String(s.amount||"0").replace(/,/g,""))||0),t<r?"asc"===N?-1:1:t>r?"asc"===N?1:-1:0}),[l,f,N]),w=(e,s)=>{j(e),v(s)};return p&&0===l.length?t.jsxs("div",{className:"flex flex-col items-center justify-center p-12 h-full",children:[t.jsx(S,{className:"h-8 w-8 animate-spin text-muted-foreground mb-4"}),t.jsx("span",{className:"text-sm text-muted-foreground",children:o("ui.common.loading")})]}):t.jsxs("div",{className:"flex flex-col h-full space-y-1.5 focus-visible:outline-none",children:[t.jsxs("div",{className:"flex items-center justify-between pb-0.5",children:[t.jsxs("h2",{className:"text-lg font-bold text-card-foreground flex items-center gap-2",children:[t.jsx(C,{className:"h-5 w-5 text-red-500 fill-red-500/10"}),o("ui.support.title")]}),t.jsx(i,{variant:"ghost",size:"icon",onClick:g,disabled:p,className:"h-6 w-6 rounded-full hover:bg-muted",children:t.jsx(y,{className:"h-3 w-3 "+(p?"animate-spin":"")})})]}),t.jsx("p",{className:"text-xs leading-relaxed text-muted-foreground bg-muted/30 p-2.5 rounded-lg border border-border/40",children:o("ui.support.supportRequest")}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 pb-2",children:[t.jsxs("a",{href:"https://ko-fi.com/haierkeys",target:"_blank",rel:"noopener noreferrer",className:"group relative flex flex-col items-center justify-center p-3 rounded-xl bg-orange-500/5 border border-orange-500/10 hover:bg-orange-500/10 hover:border-orange-500/30 transition-all cursor-pointer overflow-hidden",children:[t.jsx("div",{className:"absolute top-1 right-1 opacity-0 group-hover:opacity-40 transition-opacity",children:t.jsx(k,{className:"h-2.5 w-2.5 text-orange-600"})}),t.jsx("img",{src:"/static/images/kofi.png",alt:"Ko-fi",className:"h-16 w-auto object-contain mb-2 transition-transform group-hover:scale-105"}),t.jsxs("div",{className:"flex items-center gap-1.5 text-[11px] font-bold text-orange-600/80",children:[t.jsx(I,{className:"h-3.5 w-3.5"}),o("ui.support.buyMeACoffee")]})]}),t.jsx("div",{className:"group relative flex flex-col items-center justify-center p-3 rounded-xl bg-green-500/5 border border-green-500/10 hover:bg-green-500/10 hover:border-green-500/30 transition-all overflow-hidden",children:t.jsx(q,{content:t.jsx("img",{src:"/static/images/wxds.png",alt:"WeChat Pay",className:"w-56 h-auto rounded"}),side:"top",className:"p-1.5 bg-white border-0 shadow-2xl",children:t.jsxs("div",{className:"flex flex-col items-center justify-center w-full h-full cursor-help",children:[t.jsx("img",{src:"/static/images/wxds.png",alt:"WeChat Pay",className:"h-16 w-auto object-contain mb-2 rounded-sm opacity-90 group-hover:opacity-100 transition-all group-hover:scale-105"}),t.jsxs("div",{className:"flex items-center gap-1.5 text-[11px] font-bold text-green-600/80",children:[t.jsx(L,{className:"h-3.5 w-3.5"}),o("ui.support.wechatReward")]})]})})})]}),t.jsxs("div",{className:"flex items-center justify-between pl-1 pt-1 pb-1",children:[t.jsxs("h3",{className:"text-xs font-bold text-muted-foreground/80 flex items-center gap-1.5",children:[t.jsx(_,{className:"h-3.5 w-3.5"}),o("ui.support.listTitle")]}),t.jsxs(d,{children:[t.jsx(c,{asChild:!0,children:t.jsxs(i,{variant:"ghost",size:"sm",className:"h-6 px-2 text-[11px] gap-1 hover:bg-muted text-muted-foreground",children:[t.jsx(D,{className:"h-3.5 w-3.5"}),o("amount"===f?"ui.support.sortDefault":"ui.support.sortTime")]})}),t.jsxs(m,{align:"end",className:"text-[11px] min-w-[120px]",children:[t.jsx(u,{className:"text-[10px] opacity-50 px-2 py-1",children:o("ui.support.sort")}),t.jsx(x,{}),t.jsx(h,{className:"px-2 py-1.5 cursor-pointer "+("amount"===f?"bg-primary/10 text-primary font-bold":""),onClick:()=>w("amount","desc"),children:o("ui.support.sortDefault")}),t.jsx(h,{className:"px-2 py-1.5 cursor-pointer "+("time"===f?"bg-primary/10 text-primary font-bold":""),onClick:()=>w("time","desc"),children:o("ui.support.sortTime")})]})]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto border border-border/40 rounded-lg bg-card/10 custom-scrollbar relative min-h-[120px]",children:0===b.length?t.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground space-y-2 opacity-60 py-8",children:[t.jsx(_,{className:"h-6 w-6 stroke-[1.5]"}),t.jsx("span",{className:"text-xs italic",children:o("ui.support.noData")})]}):t.jsx("div",{className:"divide-y divide-border/20",children:b.map((e,s)=>{const r=`${e.name||"Anonymous"}: ${e.message||e.item}`;return t.jsx(q,{side:"left",delay:300,content:r,className:"max-w-[300px] whitespace-normal",children:t.jsxs("div",{className:"grid grid-cols-[80px_1fr_80px] gap-2 px-3 py-2 items-center hover:bg-primary/5 transition-colors cursor-default text-[11px]",children:[t.jsx("div",{className:"text-muted-foreground font-mono tabular-nums whitespace-nowrap overflow-hidden text-ellipsis opacity-70",children:(e.time||"").split(" ")[0]||"N/A"}),t.jsxs("div",{className:"flex items-center gap-1.5 min-w-0 overflow-hidden",children:[t.jsx(E,{className:"h-3 w-3 text-primary/60 flex-shrink-0"}),t.jsx("span",{className:"font-medium shrink-0 max-w-[80px] truncate",children:e.name||"Anonymous"}),e.message&&t.jsx("span",{className:"text-muted-foreground truncate text-[10px] opacity-70 border-l border-border/50 pl-1.5",children:e.message})]}),t.jsxs("div",{className:"text-right font-bold text-primary tabular-nums",children:[e.amount," ",t.jsx("span",{className:"text-[9px] opacity-70 font-normal ml-0.5",children:e.unit})]})]})},s)})})}),t.jsx("div",{className:"pt-0.5 text-[10px] text-center text-muted-foreground italic opacity-40",children:o("ui.support.thanks")})]})}function Q(e){if(0===e)return"0 B";const s=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,s)*100)/100+" "+["B","KB","MB","GB","TB"][s]}function X(){const{t:o}=s(),{systemInfo:l,isLoading:d,refresh:c}=function(){const[s,t]=e.useState(null),[o,i]=e.useState(!1),[l,d]=e.useState(null),c=localStorage.getItem("token"),m=e.useCallback(async()=>{if(c){i(!0),d(null);try{const e=await fetch(r(a.API_URL+"/api/admin/systeminfo"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`,Lang:n()}});if(!e.ok)throw new Error("Network response was not ok");const s=await e.json();0===s.code||s.code<100&&s.code>0?t(s.data):d(s.message||"Failed to get system info")}catch(e){d("Failed to get system info")}finally{i(!1)}}},[c]);return e.useEffect(()=>{m()},[m]),{systemInfo:s,isLoading:o,error:l,refresh:m}}();return d&&!l?t.jsxs("div",{className:"flex items-center justify-center p-12 bg-card rounded-xl border border-border",children:[t.jsx(S,{className:"h-6 w-6 animate-spin text-muted-foreground mr-2"}),t.jsx("span",{className:"text-sm text-muted-foreground",children:o("ui.common.loading")})]}):l?t.jsxs("div",{className:"rounded-xl border border-border bg-card p-6 space-y-5 custom-shadow",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h2",{className:"text-lg font-bold text-card-foreground flex items-center gap-2",children:[t.jsx(M,{className:"h-5 w-5"}),o("ui.system.serviceInfo")]}),t.jsx(i,{variant:"ghost",size:"icon",onClick:c,disabled:d,className:"h-8 w-8 rounded-full hover:bg-muted",children:t.jsx(y,{className:"h-4 w-4 "+(d?"animate-spin":"")})})]}),t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm font-bold text-primary",children:[t.jsx(U,{className:"h-4 w-4"}),o("ui.system.runtimeInfo")]}),t.jsxs("div",{className:"grid grid-cols-2 gap-y-2 text-xs",children:[t.jsxs("div",{className:"text-muted-foreground",children:[o("ui.system.goVersion")," / ",o("ui.system.goroutines")," / ",o("ui.system.numGc")]}),t.jsxs("div",{className:"text-right font-medium text-[11px] sm:text-xs",children:[l.host.os,"/",l.host.arch,t.jsx("span",{className:"text-muted-foreground mx-1.5 opacity-50",children:"|"}),t.jsx("span",{className:"font-mono",children:l.runtimeStatus.numGoroutine}),t.jsx("span",{className:"text-muted-foreground mx-1.5 opacity-50",children:"|"}),t.jsx("span",{className:"font-mono",children:l.runtimeStatus.numGc})]}),t.jsxs("div",{className:"text-muted-foreground",children:[o("ui.system.startTime")," / ",o("ui.system.serviceUptime")]}),t.jsxs("div",{className:"text-right text-[11px] font-medium whitespace-nowrap",children:[t.jsx("span",{children:(()=>{var e;const s=new Date(l.startTime);return`${s.toLocaleString()} (${(null==(e=new Intl.DateTimeFormat(void 0,{timeZoneName:"shortOffset"}).formatToParts(s).find(e=>"timeZoneName"===e.type))?void 0:e.value)||""})`})()}),t.jsx("span",{className:"text-muted-foreground mx-1.5 opacity-50",children:"|"}),t.jsxs("span",{className:"text-muted-foreground",children:[Math.floor(l.uptime/3600),"h",Math.floor(l.uptime%3600/60),"m",Math.floor(l.uptime%60),"s"]})]}),t.jsxs("div",{className:"col-span-2 space-y-2 mt-1",children:[t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsx("span",{className:"text-muted-foreground",children:o("ui.system.heapMemory")}),t.jsxs("span",{className:"font-medium",children:[Q(l.runtimeStatus.memAlloc)," / ",Q(l.runtimeStatus.memSys)]})]}),t.jsx("div",{className:"h-1.5 w-full bg-secondary/50 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-primary transition-all duration-700 ease-out",style:{width:`${Math.min(100,l.runtimeStatus.memAlloc/l.runtimeStatus.memSys*100)}%`}})})]})]})]}),t.jsx("div",{className:"border-t border-border/50"}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm font-bold text-primary",children:[t.jsx(A,{className:"h-4 w-4"}),o("ui.system.hostInfo")]}),t.jsxs("div",{className:"grid grid-cols-2 gap-y-2 text-xs",children:[t.jsx("div",{className:"text-muted-foreground",children:o("ui.system.systemTime")}),t.jsx("div",{className:"text-right font-medium",children:(()=>{var e;const s=new Date(l.host.currentTime);return`${s.toLocaleString()} (${(null==(e=new Intl.DateTimeFormat(void 0,{timeZoneName:"shortOffset"}).formatToParts(s).find(e=>"timeZoneName"===e.type))?void 0:e.value)||""})`})()}),t.jsxs("div",{className:"text-muted-foreground",children:[o("ui.system.os")," / ",o("ui.system.kernelVersion")]}),t.jsxs("div",{className:"text-right font-medium text-[10px] sm:text-xs truncate",title:`${l.host.osPretty} (${l.host.kernelVersion})`,children:[l.host.osPretty,t.jsx("span",{className:"text-muted-foreground mx-1.5 opacity-50",children:"|"}),t.jsx("span",{className:"font-mono",children:l.host.kernelVersion})]})]}),t.jsx("div",{className:"space-y-2",children:t.jsxs("div",{className:"grid grid-cols-2 gap-y-1.5 text-xs",children:[t.jsx("div",{className:"text-muted-foreground",children:o("ui.system.modelName")}),t.jsx("div",{className:"font-medium truncate text-right",title:l.cpu.modelName,children:l.cpu.modelName}),t.jsxs("div",{className:"text-muted-foreground",children:[o("ui.system.physicalCores")," / ",o("ui.system.cpuLoad")]}),t.jsxs("div",{className:"text-right font-medium",children:[l.cpu.logicalCores,"/",l.cpu.physicalCores,t.jsx("span",{className:"text-muted-foreground mx-1.5 opacity-50",children:"|"}),l.cpu.loadAvg.load1.toFixed(2)," ",l.cpu.loadAvg.load5.toFixed(2)," ",l.cpu.loadAvg.load15.toFixed(2)]})]})}),t.jsx("div",{className:"space-y-2.5",children:t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsxs("span",{className:"text-muted-foreground",children:[o("ui.system.memoryUsage")," / ",o("ui.system.usedMemory")," / ",o("ui.system.totalMemory")]}),t.jsxs("span",{className:"font-medium",children:[t.jsxs("span",{className:"font-semibold",children:[l.memory.usedPercent.toFixed(1),"%"]}),t.jsx("span",{className:"text-muted-foreground mx-1.5 opacity-50",children:"|"}),Q(l.memory.used)," / ",Q(l.memory.total)]})]}),t.jsx("div",{className:"h-1.5 w-full bg-secondary rounded-full overflow-hidden shadow-inner",children:t.jsx("div",{className:"h-full transition-all duration-700 ease-out fill-mode-forwards "+(l.memory.usedPercent>85?"bg-destructive":l.memory.usedPercent>65?"bg-orange-500":"bg-primary"),style:{width:`${l.memory.usedPercent}%`}})})]})})]})]})]}):t.jsxs("div",{className:"flex flex-col items-center justify-center p-12 bg-card rounded-xl border border-border space-y-2",children:[t.jsx(b,{className:"h-8 w-8 text-destructive opacity-50"}),t.jsx("div",{className:"text-sm text-destructive",children:o("ui.common.error")})]})}function Y({onBack:o,isDashboard:d=!1}){const{t:c}=s(),[m,u]=e.useState(null),[x,h]=e.useState(!0),[j,v]=e.useState(!1),y=localStorage.getItem("token"),b=e.useCallback(e=>{u(s=>s?{...s,...e}:null)},[]);return e.useEffect(()=>{(async()=>{if(d)h(!1);else{h(!0);try{const e=await fetch(r(a.API_URL+"/api/admin/config"),{headers:{Authorization:`Bearer ${y}`,Lang:n()}}),s=await e.json();0===s.code||s.code<100&&s.code>0?u(s.data):(l.error(s.message||c("ui.common.error")),m||null==o||o())}catch{l.error(c("ui.common.error")),m||null==o||o()}finally{h(!1)}}})()},[o,c,y,d]),x?t.jsx("div",{className:"p-8 text-center",children:c("ui.common.loading")}):m||d?t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pb-24 md:pb-4",children:[t.jsxs("div",{className:"flex flex-col gap-4",children:[t.jsx(W,{showUpgrade:!d}),!d&&t.jsx(X,{}),d&&t.jsxs("div",{className:"rounded-xl border border-border bg-card p-6 space-y-4 custom-shadow",children:[t.jsxs("h2",{className:"text-lg font-bold text-card-foreground flex items-center gap-2",children:[t.jsx(F,{className:"h-5 w-5"}),c("ui.common.helpAndSupport")]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[t.jsxs("a",{href:"https://github.com/haierkeys/fast-note-sync-service/issues/new",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-3 rounded-xl bg-muted/30 hover:bg-primary/5 border border-border/50 hover:border-primary/20 transition-all group",children:[t.jsx("div",{className:"p-2 rounded-lg bg-background border border-border group-hover:border-primary/20 transition-colors",children:t.jsx(P,{className:"h-5 w-5 text-muted-foreground group-hover:text-primary transition-colors"})}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("p",{className:"text-sm font-medium truncate",children:c("ui.common.githubIssue")}),t.jsx("p",{className:"text-xs text-muted-foreground truncate",children:c("ui.common.githubIssueDesc")})]})]}),t.jsxs("a",{href:"https://t.me/obsidian_users",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-3 rounded-xl bg-muted/30 hover:bg-primary/5 border border-border/50 hover:border-primary/20 transition-all group",children:[t.jsx("div",{className:"p-2 rounded-lg bg-background border border-border group-hover:border-primary/20 transition-colors",children:t.jsx(V,{className:"h-5 w-5 text-muted-foreground group-hover:text-primary transition-colors"})}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("p",{className:"text-sm font-medium truncate",children:c("ui.common.telegramGroup")}),t.jsx("p",{className:"text-xs text-muted-foreground truncate",children:c("ui.common.telegramGroupDesc")})]})]})]})]})]}),t.jsx("div",{className:"flex flex-col gap-4",children:d?t.jsx("div",{className:"rounded-xl border border-border bg-card p-4 custom-shadow",children:t.jsx(J,{})}):m?t.jsx(t.Fragment,{children:t.jsxs("div",{className:"rounded-xl border border-border bg-card p-6 space-y-5 custom-shadow",children:[t.jsxs("h2",{className:"text-lg font-bold text-card-foreground flex items-center gap-2",children:[t.jsx(K,{className:"h-5 w-5"}),c("ui.settings.systemConfig")]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(R,{className:"h-5 w-5 text-muted-foreground"}),t.jsx("span",{className:"text-sm font-medium",children:c("ui.settings.fontSet")})]}),t.jsx(p,{value:m.fontSet,onChange:e=>b({fontSet:e.target.value}),placeholder:"e.g. /static/fonts/font.css",className:"rounded-xl"}),t.jsx("p",{className:"text-xs text-muted-foreground whitespace-pre-line",dangerouslySetInnerHTML:{__html:c("ui.settings.fontSetDesc")}})]}),t.jsx("div",{className:"border-t border-border"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx($,{className:"h-5 w-5 text-muted-foreground"}),t.jsx("span",{className:"text-sm font-medium",children:c("ui.settings.authTokenKey")})]}),t.jsx(p,{value:m.authTokenKey,onChange:e=>b({authTokenKey:e.target.value}),placeholder:"e.g. token",className:"rounded-xl"}),t.jsx("p",{className:"text-xs text-muted-foreground whitespace-pre-line",dangerouslySetInnerHTML:{__html:c("ui.settings.authTokenKeyDesc")}})]}),t.jsx("div",{className:"border-t border-border"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(B,{className:"h-5 w-5 text-muted-foreground"}),t.jsx("span",{className:"text-sm font-medium",children:c("ui.settings.tokenExpiry")})]}),t.jsx(p,{value:m.tokenExpiry,onChange:e=>b({tokenExpiry:e.target.value}),placeholder:"e.g. 365d, 24h, 30m",className:"rounded-xl"}),t.jsx("p",{className:"text-xs text-muted-foreground whitespace-pre-line",dangerouslySetInnerHTML:{__html:c("ui.settings.tokenExpiryDesc")}})]}),t.jsx("div",{className:"border-t border-border"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(z,{className:"h-5 w-5 text-muted-foreground"}),t.jsx("span",{className:"text-sm font-medium",children:c("ui.settings.shareTokenKey")})]}),t.jsx(p,{value:m.shareTokenKey,onChange:e=>b({shareTokenKey:e.target.value}),placeholder:"e.g. fns",className:"rounded-xl"}),t.jsx("p",{className:"text-xs text-muted-foreground whitespace-pre-line",dangerouslySetInnerHTML:{__html:c("ui.settings.shareTokenKeyDesc")}})]}),t.jsx("div",{className:"border-t border-border"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(B,{className:"h-5 w-5 text-muted-foreground"}),t.jsx("span",{className:"text-sm font-medium",children:c("ui.settings.shareTokenExpiry")})]}),t.jsx(p,{value:m.shareTokenExpiry,onChange:e=>b({shareTokenExpiry:e.target.value}),placeholder:"e.g. 30d, 24h, 30m",className:"rounded-xl"}),t.jsx("p",{className:"text-xs text-muted-foreground whitespace-pre-line",dangerouslySetInnerHTML:{__html:c("ui.settings.shareTokenExpiryDesc")}})]}),t.jsx("div",{className:"border-t border-border"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(H,{className:"h-5 w-5 text-muted-foreground"}),t.jsx("span",{className:"text-sm font-medium",children:c("ui.settings.registerIsEnable")})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(f,{id:"registerIsEnable",checked:m.registerIsEnable,onCheckedChange:e=>b({registerIsEnable:!!e})}),t.jsx(g,{htmlFor:"registerIsEnable",className:"text-sm",children:m.registerIsEnable?c("ui.common.isEnabled"):c("ui.common.close")})]}),t.jsx("p",{className:"text-xs text-muted-foreground whitespace-pre-line",dangerouslySetInnerHTML:{__html:c("ui.settings.registerIsEnableDesc")}})]}),t.jsx("div",{className:"border-t border-border"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(z,{className:"h-5 w-5 text-muted-foreground"}),t.jsx("span",{className:"text-sm font-medium",children:c("ui.settings.adminUid")})]}),t.jsx(p,{type:"number",value:m.adminUid,onChange:e=>b({adminUid:parseInt(e.target.value)||0}),placeholder:"e.g. 1",className:"rounded-xl"}),t.jsx("p",{className:"text-xs text-muted-foreground whitespace-pre-line",dangerouslySetInnerHTML:{__html:c("ui.settings.adminUidDesc")}})]}),t.jsx("div",{className:"border-t border-border"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(G,{className:"h-5 w-5 text-muted-foreground"}),t.jsx("span",{className:"text-sm font-medium",children:c("ui.settings.fileChunkSize")})]}),t.jsx(p,{value:m.fileChunkSize,onChange:e=>b({fileChunkSize:e.target.value}),placeholder:"e.g. 1MB, 512KB",className:"rounded-xl"}),t.jsx("p",{className:"text-xs text-muted-foreground whitespace-pre-line",dangerouslySetInnerHTML:{__html:c("ui.settings.fileChunkSizeDesc")}})]}),t.jsx("div",{className:"border-t border-border"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(O,{className:"h-5 w-5 text-muted-foreground"}),t.jsx("span",{className:"text-sm font-medium",children:c("ui.settings.softDeleteRetentionTime")})]}),t.jsx(p,{value:m.softDeleteRetentionTime,onChange:e=>b({softDeleteRetentionTime:e.target.value}),placeholder:"e.g. 30d, 24h",className:"rounded-xl"}),t.jsx("p",{className:"text-xs text-muted-foreground whitespace-pre-line",dangerouslySetInnerHTML:{__html:c("ui.settings.softDeleteRetentionTimeDesc")}})]}),t.jsx("div",{className:"border-t border-border"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(B,{className:"h-5 w-5 text-muted-foreground"}),t.jsx("span",{className:"text-sm font-medium",children:c("ui.settings.uploadSessionTimeout")})]}),t.jsx(p,{value:m.uploadSessionTimeout,onChange:e=>b({uploadSessionTimeout:e.target.value}),placeholder:"e.g. 1h, 30m",className:"rounded-xl"}),t.jsx("p",{className:"text-xs text-muted-foreground whitespace-pre-line",dangerouslySetInnerHTML:{__html:c("ui.settings.uploadSessionTimeoutDesc")}})]}),t.jsx("div",{className:"border-t border-border"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(N,{className:"h-5 w-5 text-muted-foreground"}),t.jsx("span",{className:"text-sm font-medium",children:c("ui.settings.historyKeepVersions")})]}),t.jsx(p,{type:"number",min:"100",value:m.historyKeepVersions,onChange:e=>b({historyKeepVersions:parseInt(e.target.value)||100}),placeholder:"e.g. 100",className:"rounded-xl"}),t.jsx("p",{className:"text-xs text-muted-foreground whitespace-pre-line",dangerouslySetInnerHTML:{__html:c("ui.settings.historyKeepVersionsDesc")}})]}),t.jsx("div",{className:"border-t border-border"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(B,{className:"h-5 w-5 text-muted-foreground"}),t.jsx("span",{className:"text-sm font-medium",children:c("ui.settings.historySaveDelay")})]}),t.jsx(p,{value:m.historySaveDelay,onChange:e=>b({historySaveDelay:e.target.value}),placeholder:"e.g. 10s, 1m",className:"rounded-xl"}),t.jsx("p",{className:"text-xs text-muted-foreground whitespace-pre-line",dangerouslySetInnerHTML:{__html:c("ui.settings.historySaveDelayDesc")}})]}),t.jsx("div",{className:"border-t border-border"}),t.jsx(i,{onClick:async()=>{if(m)if(m.historyKeepVersions<100)l.error(c("ui.settings.historyKeepVersionsMinError"));else{if(m.historySaveDelay){const e=(e=>{if(!e)return null;const s=e.match(/^(\d+)(s|m|h|d)$/);if(!s)return null;const t=parseInt(s[1]);switch(s[2]){case"s":return t;case"m":return 60*t;case"h":return 3600*t;case"d":return 86400*t;default:return null}})(m.historySaveDelay);if(null===e)return void l.error(c("ui.settings.historySaveDelayFormatError"));if(e<10)return void l.error(c("ui.settings.historySaveDelayMinError"))}v(!0);try{const e=await fetch(r(a.API_URL+"/api/admin/config"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${y}`,Lang:n()},body:JSON.stringify(m)}),s=await e.json();0===s.code||s.code<100&&s.code>0?l.success(c("ui.settings.saveSuccess")):l.error(s.message||c("ui.settings.saveFailed"))}catch{l.error(c("ui.settings.saveFailed"))}finally{v(!1)}}},disabled:j,className:"w-full rounded-xl",children:j?t.jsxs(t.Fragment,{children:[t.jsx(S,{className:"h-4 w-4 mr-2 animate-spin"}),c("ui.auth.submitting")]}):t.jsxs(t.Fragment,{children:[t.jsx(Z,{className:"h-4 w-4 mr-2"}),c("ui.settings.saveSettings")]})})]})}):null})]}):t.jsx("div",{className:"p-8 text-center text-destructive",children:c("ui.common.error")})}export{Y as SystemSettings};
